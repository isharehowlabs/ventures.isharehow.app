(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,90815,(e,t,n)=>{"use strict";var i=e.r(78509);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(21506)),s=e.r(91398);n.default=(0,r.default)((0,s.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96M3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4z"}),"CloudOff")},75297,(e,t,n)=>{"use strict";var i=e.r(78509);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(21506)),s=e.r(91398);n.default=(0,r.default)((0,s.jsx)("path",{d:"M2 4h20v16H2z"}),"Rectangle")},11730,(e,t,n)=>{"use strict";var i=e.r(78509);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(21506)),s=e.r(91398);n.default=(0,r.default)((0,s.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle")},28519,(e,t,n)=>{"use strict";var i=e.r(78509);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(21506)),s=e.r(91398);n.default=(0,r.default)((0,s.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove")},61661,(e,t,n)=>{"use strict";var i=e.r(78509);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(21506)),s=e.r(91398);n.default=(0,r.default)((0,s.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo")},33008,(e,t,n)=>{"use strict";var i=e.r(78509);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(21506)),s=e.r(91398);n.default=(0,r.default)((0,s.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"Redo")},26907,(e,t,n)=>{"use strict";var i=e.r(78509);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(21506)),s=e.r(91398);n.default=(0,r.default)((0,s.jsx)("circle",{cx:"12",cy:"12",r:"8"}),"FiberManualRecord")},55429,e=>{"use strict";let t,n,i,r,s,o,a,l,h,c,u,d,p,f,m,g,_,v,y,b;var w,C,I,T,E,k=e.i(91398),S=e.i(91788),x=e.i(3828),P=e.i(17563),R=e.i(5553),N=e.i(56119),A=e.i(64056),O=e.i(21627),D=e.i(77882),L=e.i(7856),M=e.i(46026),F=e.i(21432),j=e.i(74266),U=e.i(62999),B=e.i(19696),W=e.i(12057),q=e.i(90815),z=e.i(99246),$=e.i(50461);let H=function(e,t){if(!e)throw V(t)},V=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},K=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},G=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},Y={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,c=(3&r)<<4|o>>4,u=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(u=64)),i.push(n[h],n[c],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(K(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):G(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new J;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class J extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let X=function(e){let t=K(e);return Y.encodeByteArray(t,!0)},Q=function(e){return X(e).replace(/\./g,"")},Z=function(e){try{return Y.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},ee=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===$.default||void 0===$.default.env)return;let e=$.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&Z(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},et=e=>ee()?.emulatorHosts?.[e],en=()=>ee()?.config,ei=e=>ee()?.[`_${e}`];class er{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function es(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function eo(e){return(await fetch(e,{credentials:"include"})).ok}let ea={},el=!1;function eh(e,t){if("undefined"==typeof window||"undefined"==typeof document||!es(window.location.host)||ea[e]===t||ea[e]||el)return;function n(e){return`__firebase__banner__${e}`}ea[e]=t;let i="__firebase__banner",r=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(ea))ea[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(i),t=!1,e||((e=document.createElement("div")).setAttribute("id",i),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;el=!0,(e=document.getElementById(i))&&e.remove()},e);u.setAttribute("width","24"),u.setAttribute("id",c),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px",t.append(u,a,h,n),document.body.appendChild(t)}r?(a.innerText="Preview backend disconnected.",u.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(u.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function ec(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function eu(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ec())}function ed(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function ep(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ef(){return false}class em extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,em.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,eg.prototype.create)}}class eg{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,i=r,n.replace(e_,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new em(s,l,r)}}let e_=/\{\$([^}]+)}/g;function ev(e){return JSON.parse(e)}function ey(e){return JSON.stringify(e)}let eb=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=ev(Z(s[0])||""),n=ev(Z(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},ew=function(e){let t=eb(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},eC=function(e){let t=eb(e).claims;return"object"==typeof t&&!0===t.admin};function eI(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eT(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eE(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ek(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function eS(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(ex(n)&&ex(s)){if(!eS(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function ex(e){return null!==e&&"object"==typeof e}function eP(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function eR(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function eN(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class eA{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class eO{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=eD),void 0===i.error&&(i.error=eD),void 0===i.complete&&(i.complete=eD);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eD(){}function eL(e,t){return`${e} failed: ${t} argument `}let eM=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;H(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eF=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function ej(e){return e&&e._delegate?e._delegate:e}class eU{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eB="[DEFAULT]";class eW{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new er;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eB})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eB){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eB){return this.instances.has(e)}getOptions(e=eB){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);let r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eB?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=eB){return this.component?this.component.multipleInstances?e:eB:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eq{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eW(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let ez=[];(w=T||(T={}))[w.DEBUG=0]="DEBUG",w[w.VERBOSE=1]="VERBOSE",w[w.INFO=2]="INFO",w[w.WARN=3]="WARN",w[w.ERROR=4]="ERROR",w[w.SILENT=5]="SILENT";let e$={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},eH=T.INFO,eV={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},eK=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=eV[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class eG{constructor(e){this.name=e,this._logLevel=eH,this._logHandler=eK,this._userLogHandler=null,ez.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in T))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?e$[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...e),this._logHandler(this,T.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...e),this._logHandler(this,T.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,T.INFO,...e),this._logHandler(this,T.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,T.WARN,...e),this._logHandler(this,T.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,T.ERROR,...e),this._logHandler(this,T.ERROR,...e)}}let eY=new WeakMap,eJ=new WeakMap,eX=new WeakMap,eQ=new WeakMap,eZ=new WeakMap,e0={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eJ.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eX.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return e1(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function e1(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(e1(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eY.set(t,e)}).catch(()=>{}),eZ.set(t,e),t}if(eQ.has(e))return eQ.get(e);let i=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(e2(this),t),e1(eY.get(this))}:function(...t){return e1(e.apply(e2(this),t))}:function(t,...n){let i=e.call(e2(this),t,...n);return eX.set(i,t.sort?t.sort():[t]),e1(i)};return e instanceof IDBTransaction&&function(e){if(eJ.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});eJ.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,e0):e}(e);return i!==e&&(eQ.set(e,i),eZ.set(i,e)),i}let e2=e=>eZ.get(e),e6=["get","getKey","getAll","getAllKeys","count"],e3=["put","add","delete","clear"],e5=new Map;function e4(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(e5.get(t))return e5.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=e3.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||e6.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return e5.set(t,s),s}e0={...b=e0,get:(e,t,n)=>e4(e,t)||b.get(e,t,n),has:(e,t)=>!!e4(e,t)||b.has(e,t)};class e8{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let e7="@firebase/app",e9="0.14.6",te=new eG("@firebase/app"),tt="[DEFAULT]",tn={[e7]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ti=new Map,tr=new Map,ts=new Map;function to(e,t){try{e.container.addComponent(t)}catch(n){te.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ta(e,t){e.container.addOrOverwriteComponent(t)}function tl(e){let t=e.name;if(ts.has(t))return te.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(ts.set(t,e),ti.values()))to(n,e);for(let t of tr.values())to(t,e);return!0}function th(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function tc(e,t,n=tt){th(e,t).clearInstance(n)}function tu(e){return void 0!==e.options}function td(e){return!tu(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tp(e){return null!=e&&void 0!==e.settings}function tf(){ts.clear()}let tm=new eg("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tg{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eU("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tm.create("app-deleted",{appName:this._name})}}function t_(e,t){let n=Z(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tv extends tg{constructor(e,t,n,i){const r=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:r};void 0!==e.apiKey?super(e,s,i):super(e.options,s,i),this._serverConfig={automaticDataCollectionEnabled:r,...t},this._serverConfig.authIdToken&&t_(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&t_(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tE(e7,e9,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tT(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tm.create("server-app-deleted")}}let ty="12.6.0";function tb(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i={name:tt,automaticDataCollectionEnabled:!0,...t},r=i.name;if("string"!=typeof r||!r)throw tm.create("bad-app-name",{appName:String(r)});if(n||(n=en()),!n)throw tm.create("no-options");let s=ti.get(r);if(s)if(eS(n,s.options)&&eS(i,s.config))return s;else throw tm.create("duplicate-app",{appName:r});let o=new eq(r);for(let e of ts.values())o.addComponent(e);let a=new tg(n,i,o);return ti.set(r,a),a}function tw(e,t={}){let n;if(("undefined"!=typeof window||ed())&&!ed())throw tm.create("invalid-server-app-environment");let i=t||{};if(e&&(tu(e)?n=e.options:td(e)?i=e:n=e),void 0===i.automaticDataCollectionEnabled&&(i.automaticDataCollectionEnabled=!0),n||(n=en()),!n)throw tm.create("no-options");let r={...i,...n};if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==i.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw tm.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(r)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=tr.get(s);if(o)return o.incRefCount(i.releaseOnDeref),o;let a=new eq(s);for(let e of ts.values())a.addComponent(e);let l=new tv(n,i,s,a);return tr.set(s,l),l}function tC(e=tt){let t=ti.get(e);if(!t&&e===tt&&en())return tb();if(!t)throw tm.create("no-app",{appName:e});return t}function tI(){return Array.from(ti.values())}async function tT(e){let t=!1,n=e.name;ti.has(n)?(t=!0,ti.delete(n)):tr.has(n)&&0>=e.decRefCount()&&(tr.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tE(e,t,n){let i=tn[e]??e;n&&(i+=`-${n}`);let r=i.match(/\s|\//),s=t.match(/\s|\//);if(r||s){let e=[`Unable to register library "${i}" with version "${t}":`];r&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),te.warn(e.join(" "));return}tl(new eU(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function tk(e,t){if(null!==e&&"function"!=typeof e)throw tm.create("invalid-log-argument");for(let n of ez){let i=null;t&&t.level&&(i=e$[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...r)=>{let s=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(i??t.logLevel)&&e({level:T[n].toLowerCase(),message:s,args:r,type:t.name})}}}function tS(e){ez.forEach(t=>{t.setLogLevel(e)})}let tx="firebase-heartbeat-store",tP=null;function tR(){return tP||(tP=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=e1(o);return i&&o.addEventListener("upgradeneeded",e=>{i(e1(o.result),e.oldVersion,e.newVersion,e1(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tx)}catch(e){console.warn(e)}}}).catch(e=>{throw tm.create("idb-open",{originalErrorMessage:e.message})})),tP}async function tN(e){try{let t=(await tR()).transaction(tx),n=await t.objectStore(tx).get(tO(e));return await t.done,n}catch(e){if(e instanceof em)te.warn(e.message);else{let t=tm.create("idb-get",{originalErrorMessage:e?.message});te.warn(t.message)}}}async function tA(e,t){try{let n=(await tR()).transaction(tx,"readwrite"),i=n.objectStore(tx);await i.put(t,tO(e)),await n.done}catch(e){if(e instanceof em)te.warn(e.message);else{let t=tm.create("idb-set",{originalErrorMessage:e?.message});te.warn(t.message)}}}function tO(e){return`${e.name}!${e.options.appId}`}class tD{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tM(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tL();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){te.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tL(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tF(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tF(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=Q(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return te.warn(e),""}}}function tL(){return new Date().toISOString().substring(0,10)}class tM{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tN(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tA(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tA(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tF(e){return Q(JSON.stringify({version:2,heartbeats:e})).length}tl(new eU("platform-logger",e=>new e8(e),"PRIVATE")),tl(new eU("heartbeat",e=>new tD(e),"PRIVATE")),tE(e7,e9,""),tE(e7,e9,"esm2020"),tE("fire-js",""),e.s(["SDK_VERSION",()=>ty,"_DEFAULT_ENTRY_NAME",()=>tt,"_addComponent",()=>to,"_addOrOverwriteComponent",()=>ta,"_apps",()=>ti,"_clearComponents",()=>tf,"_components",()=>ts,"_getProvider",()=>th,"_isFirebaseApp",()=>tu,"_isFirebaseServerApp",()=>tp,"_isFirebaseServerAppSettings",()=>td,"_registerComponent",()=>tl,"_removeServiceInstance",()=>tc,"_serverApps",()=>tr,"deleteApp",()=>tT,"getApp",()=>tC,"getApps",()=>tI,"initializeApp",()=>tb,"initializeServerApp",()=>tw,"onLog",()=>tk,"registerVersion",()=>tE,"setLogLevel",()=>tS],75984),tE("firebase","12.6.0","app"),e.i(75984);let tj="@firebase/database",tU="1.1.0",tB="";class tW{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),ey(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:ev(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class tq{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eI(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let tz=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new tW(t)}}catch(e){}return new tq},t$=tz("localStorage"),tH=tz("sessionStorage"),tV=new eG("@firebase/database"),tK=(_=1,function(){return _++}),tG=function(e){let t=eM(e),n=new eA;n.update(t);let i=n.digest();return Y.encodeByteArray(i)},tY=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=tY.apply(null,i):"object"==typeof i?t+=ey(i):t+=i,t+=" "}return t},tJ=null,tX=!0,tQ=function(e,t){H(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(tV.logLevel=T.VERBOSE,tJ=tV.log.bind(tV),t&&tH.set("logging_enabled",!0)):"function"==typeof e?tJ=e:(tJ=null,tH.remove("logging_enabled"))},tZ=function(...e){if(!0===tX&&(tX=!1,null===tJ&&!0===tH.get("logging_enabled")&&tQ(!0)),tJ){let t=tY.apply(null,e);tJ(t)}},t0=function(e){return function(...t){tZ(e,...t)}},t1=function(...e){let t="FIREBASE INTERNAL ERROR: "+tY(...e);tV.error(t)},t2=function(...e){let t=`FIREBASE FATAL ERROR: ${tY(...e)}`;throw tV.error(t),Error(t)},t6=function(...e){let t="FIREBASE WARNING: "+tY(...e);tV.warn(t)},t3=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&t6("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},t5=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},t4=function(e){if(ef()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},t8="[MIN_NAME]",t7="[MAX_NAME]",t9=function(e,t){if(e===t)return 0;{if(e===t8||t===t7)return -1;if(t===t8||e===t7)return 1;let n=na(e),i=na(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},ne=function(e,t){return e===t?0:e<t?-1:1},nt=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+ey(t))},nn=function(e){if("object"!=typeof e||null===e)return ey(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=ey(t[i]),n+=":",n+=nn(e[t[i]]);return n+"}"},ni=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function nr(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let ns=function(e){let t,n,i,r,s;H(!t5(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},no=RegExp("^-?(0*)\\d{1,10}$"),na=function(e){if(no.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},nl=function(e){try{e()}catch(e){setTimeout(()=>{throw t6("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},nh=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class nc{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tp(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){t6(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class nu{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(tZ("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',t6(e)}}class nd{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}nd.OWNER="owner";let np=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,nf="websocket",nm="long_polling";class ng{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=t$.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&t$.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function n_(e,t,n){let i;if(H("string"==typeof t,"typeof type must == string"),H("object"==typeof n,"typeof params must == object"),t===nf)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===nm)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return nr(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class nv{constructor(){this.counters_={}}incrementCounter(e,t=1){eI(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,this.counters_)}}let ny={},nb={};function nw(e){let t=e.toString();return ny[t]||(ny[t]=new nv),ny[t]}class nC{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&nl(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let nI="start";class nT{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=t0(e),this.stats_=nw(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),n_(t,nm,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nC(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),t4(()=>{if(this.isClosed_)return;this.scriptTagHolder=new nE((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===nI)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[nI]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&np.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){nT.forceAllow_=!0}static forceDisallow(){nT.forceDisallow_=!0}static isAvailable(){return!ef()&&(!!nT.forceAllow_||!nT.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=ey(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=ni(X(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ef())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=ey(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class nE{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,ef())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=tK(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=nE.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){tZ("frame writing exception"),e.stack&&tZ(e.stack),tZ(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||tZ("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){ef()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{tZ("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let nk=null;"undefined"!=typeof MozWebSocket?nk=MozWebSocket:"undefined"!=typeof WebSocket&&(nk=WebSocket);class nS{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=t0(this.connId),this.stats_=nw(t),this.connURL=nS.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!ef()&&"undefined"!=typeof location&&location.hostname&&np.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),n_(e,nf,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,t$.set("previous_websocket_failure",!0);try{let e;if(ef()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${tB}/${$.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=$.default.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new nk(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){nS.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==nk&&!nS.forceDisallow_}static previouslyFailed(){return t$.isInMemoryStorage||!0===t$.get("previous_websocket_failure")}markConnectionHealthy(){t$.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=ev(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(H(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=ey(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=ni(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}nS.responsesRequiredToBeHealthy=2,nS.healthyTimeout=3e4;class nx{static get ALL_TRANSPORTS(){return[nT,nS]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=nS&&nS.isAvailable(),n=t&&!nS.previouslyFailed();if(e.webSocketOnly&&(t||t6("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[nS];else{let e=this.transports_=[];for(let t of nx.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);nx.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}nx.globalTransportInitialized_=!1;class nP{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=t0("c:"+this.id+":"),this.transportManager_=new nx(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=nh(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=nt("t",e),n=nt("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=nt("t",e),n=nt("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=nt("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?t1("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):t1("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&t6("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),nh(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):nh(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(t$.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class nR{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class nN{constructor(e){this.allowedEvents_=e,this.listeners_={},H(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){H(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class nA extends nN{static getInstance(){return new nA}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||eu()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return H("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class nO{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function nD(){return new nO("")}function nL(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function nM(e){return e.pieces_.length-e.pieceNum_}function nF(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new nO(e.pieces_,t)}function nj(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function nU(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function nB(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new nO(t,0)}function nW(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof nO)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new nO(n,0)}function nq(e){return e.pieceNum_>=e.pieces_.length}function nz(e,t){let n=nL(e),i=nL(t);if(null===n)return t;if(n===i)return nz(nF(e),nF(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function n$(e,t){if(nM(e)!==nM(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function nH(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(nM(e)>nM(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class nV{constructor(e,t){this.errorPrefix_=t,this.parts_=nU(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eF(this.parts_[e]);nK(this)}}function nK(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+nG(e))}function nG(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class nY extends nN{static getInstance(){return new nY}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return H("visible"===e,"Unknown event type: "+e),[this.visible_]}}class nJ extends nR{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=nJ.nextPersistentConnectionId_++,this.log_=t0("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!ef())throw Error("Auth override specified in options, but not supported on non Node.js platforms");nY.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&nA.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(ey(r)),H(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new er,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),H(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;nJ.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eI(e,"w")){let n=eT(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();t6(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||eC(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=ew(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),H(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+ey(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):t1("Unrecognized action received from server: "+ey(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){H(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+nJ.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){H(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?tZ("getToken() completed but was canceled"):(tZ("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new nP(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{t6(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&t6(e),a())}}}interrupt(e){tZ("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){tZ("Resuming connection for reason: "+e),delete this.interruptReasons_[e],eE(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>nn(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new nO(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){tZ("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){tZ("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";ef()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+tB.replace(/\./g,"-")]=1,eu()?e["framework.cordova"]=1:ep()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=nA.getInstance().currentlyOnline();return eE(this.interruptReasons_)&&e}}nJ.nextPersistentConnectionId_=0,nJ.nextConnectionId_=0;class nX{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new nX(e,t)}}class nQ{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new nX(t8,e),i=new nX(t8,t);return 0!==this.compare(n,i)}minPost(){return nX.MIN}}class nZ extends nQ{static get __EMPTY_NODE(){return i}static set __EMPTY_NODE(e){i=e}compare(e,t){return t9(e.name,t.name)}isDefinedOn(e){throw V("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return nX.MIN}maxPost(){return new nX(t7,i)}makePost(e,t){return H("string"==typeof e,"KeyIndex indexValue must always be a string."),new nX(e,i)}toString(){return".key"}}let n0=new nZ;class n1{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class n2{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:n2.RED,this.left=null!=i?i:n6.EMPTY_NODE,this.right=null!=r?r:n6.EMPTY_NODE}copy(e,t,n,i,r){return new n2(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return n6.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return n6.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,n2.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,n2.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}n2.RED=!0,n2.BLACK=!1;class n6{constructor(e,t=n6.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n6(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,n2.BLACK,null,null))}remove(e){return new n6(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,n2.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new n1(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new n1(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new n1(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new n1(this.root_,null,this.comparator_,!0,e)}}function n3(e,t){return t9(e.name,t.name)}function n5(e,t){return t9(e,t)}n6.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new n2(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let n4=function(e){return"number"==typeof e?"number:"+ns(e):"string:"+e},n8=function(e){if(e.isLeafNode()){let t=e.val();H("string"==typeof t||"number"==typeof t||"object"==typeof t&&eI(t,".sv"),"Priority must be a string or number.")}else H(e===r||e.isEmpty(),"priority of unexpected type.");H(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class n7{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=n7.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,H(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),n8(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n7(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:n7.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return nq(e)?this:".priority"===nL(e)?this.priorityNode_:n7.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:n7.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=nL(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(H(".priority"!==n||1===nM(e),".priority must be the last token in a path"),this.updateImmediateChild(n,n7.__childrenNodeConstructor.EMPTY_NODE.updateChild(nF(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+n4(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=ns(this.value_):e+=this.value_,this.lazyHash_=tG(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n7.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n7.__childrenNodeConstructor?-1:(H(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=n7.VALUE_TYPE_ORDER.indexOf(t),r=n7.VALUE_TYPE_ORDER.indexOf(n);return(H(i>=0,"Unknown leaf type: "+t),H(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}n7.VALUE_TYPE_ORDER=["object","boolean","number","string"];let n9=new class extends nQ{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?t9(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return nX.MIN}maxPost(){return new nX(t7,new n7("[PRIORITY-POST]",a))}makePost(e,t){return new nX(t,new n7("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},ie=Math.log(2);class it{constructor(e){this.count=parseInt(Math.log(e+1)/ie,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let ii=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,o=i-t;if(0===o)return null;if(1===o)return s=e[t],new n2(n?n(s):s,s.node,n2.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,i);return s=e[a],new n2(n?n(s):s,s.node,n2.BLACK,l,h)}};return new n6(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),c=e[s];l(new n2(n?n(c):c,c.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,n2.BLACK):(a(i,n2.BLACK),a(i,n2.RED))}return s}(new it(e.length)))},ir={};class is{static get Default(){return H(ir&&n9,"ChildrenNode.ts has not been loaded"),l=l||new is({".priority":ir},{".priority":n9})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eT(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof n6?t:null}hasIndex(e){return eI(this.indexSet_,e.toString())}addIndex(e,t){let n;H(e!==n0,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(nX.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?ii(i,e.getCompare()):ir;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new is(h,l)}addToIndexes(e,t){return new is(ek(this.indexes_,(n,i)=>{let r=eT(this.indexSet_,i);if(H(r,"Missing index implementation for "+i),n===ir)if(!r.isDefinedOn(e.node))return ir;else{let n=[],i=t.getIterator(nX.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),ii(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new nX(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new is(ek(this.indexes_,n=>{if(n===ir)return n;{let i=t.get(e.name);return i?n.remove(new nX(e.name,i)):n}}),this.indexSet_)}}class io{static get EMPTY_NODE(){return h||(h=new io(new n6(n5),null,is.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&n8(this.priorityNode_),this.children_.isEmpty()&&H(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new io(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=nL(e);return null===t?this:this.getImmediateChild(t).getChild(nF(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(H(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new nX(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new io(n,s,i)}}updateChild(e,t){let n=nL(e);if(null===n)return t;{H(".priority"!==nL(e)||1===nM(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(nF(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(n9,(s,o)=>{t[s]=o.val(e),n++,r&&io.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+n4(this.getPriority().val())+":"),this.forEachChild(n9,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":tG(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new nX(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new nX(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new nX(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,nX.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,nX.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===ia?-1:0}withIndex(e){if(e===n0||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new io(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===n0||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(n9),n=e.getIterator(n9),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===n0?null:this.indexMap_.get(e.toString())}}io.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let ia=new class extends io{constructor(){super(new n6(n5),io.EMPTY_NODE,is.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return io.EMPTY_NODE}isEmpty(){return!1}};function il(e,t=null){if(null===e)return io.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),H(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new n7(e,il(t));if(e instanceof Array){let n=io.EMPTY_NODE;return nr(e,(t,i)=>{if(eI(e,t)&&"."!==t.substring(0,1)){let e=il(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(il(t))}{let n=[],i=!1;if(nr(e,(e,t)=>{if("."!==e.substring(0,1)){let r=il(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new nX(e,r)))}}),0===n.length)return io.EMPTY_NODE;let r=ii(n,n3,e=>e.name,n5);if(!i)return new io(r,il(t),is.Default);{let e=ii(n,n9.getCompare());return new io(r,il(t),new is({".priority":e},{".priority":n9}))}}}Object.defineProperties(nX,{MIN:{value:new nX(t8,io.EMPTY_NODE)},MAX:{value:new nX(t7,ia)}}),nZ.__EMPTY_NODE=io.EMPTY_NODE,n7.__childrenNodeConstructor=io,r=ia,a=ia,o=il;class ih extends nQ{constructor(e){super(),this.indexPath_=e,H(!nq(e)&&".priority"!==nL(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?t9(e.name,t.name):r}makePost(e,t){let n=il(e);return new nX(t,io.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new nX(t7,io.EMPTY_NODE.updateChild(this.indexPath_,ia))}toString(){return nU(this.indexPath_,0).join("/")}}let ic=new class extends nQ{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?t9(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return nX.MIN}maxPost(){return nX.MAX}makePost(e,t){return new nX(t,il(e))}toString(){return".value"}};function iu(e){return{type:"value",snapshotNode:e}}function id(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ip(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function im(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ig{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){H(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(ip(t,o)):H(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(id(t,n)):s.trackChildChange(im(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(n9,(e,i)=>{t.hasChild(e)||n.trackChildChange(ip(e,i))}),t.isLeafNode()||t.forEachChild(n9,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(im(t,i,r))}else n.trackChildChange(id(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?io.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class i_{constructor(e){this.indexedFilter_=new ig(e.getIndex()),this.index_=e.getIndex(),this.startPost_=i_.getStartPost_(e),this.endPost_=i_.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new nX(t,n))||(n=io.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=io.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(io.EMPTY_NODE);let r=this;return t.forEachChild(n9,(e,t)=>{r.matches(new nX(e,t))||(i=i.updateImmediateChild(e,io.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class iv{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new i_(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new nX(t,n))||(n=io.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=io.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=io.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(io.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,io.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();H(e.numChildren()===this.limit_,"");let o=new nX(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),c=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=c&&(c.name===t||e.hasChild(c.name));)c=i.getChildAfterChild(this.index_,c,this.reverse_);let u=null==c?1:s(c,o);if(l&&!n.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(im(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(ip(t,h));let n=e.updateImmediateChild(t,io.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(id(c.name,c.node)),n.updateImmediateChild(c.name,c.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=r&&(r.trackChildChange(ip(a.name,a.node)),r.trackChildChange(id(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,io.EMPTY_NODE)):e:e}}class iy{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=n9}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return H(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(H(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:t8}hasEnd(){return this.endSet_}getIndexEndValue(){return H(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(H(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:t7}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return H(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===n9}copy(){let e=new iy;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ib(e){let t,n={};if(e.isDefault())return n;if(e.index_===n9?t="$priority":e.index_===ic?t="$value":e.index_===n0?t="$key":(H(e.index_ instanceof ih,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=ey(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=ey(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+ey(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=ey(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+ey(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function iw(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==n9&&(t.i=e.index_.toString()),t}class iC extends nR{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(H(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=t0("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=iC.getListenId_(e,n),o={};this.listens_[s]=o;let a=ib(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),eT(this.listens_,s)===o)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=iC.getListenId_(e,t);delete this.listens_[n]}get(e){let t=ib(e._queryParams),n=e._path.toString(),i=new er;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eP(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=ev(o.responseText)}catch(e){t6("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&t6("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class iI{constructor(){this.rootNode_=io.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function iT(){return{value:null,children:new Map}}function iE(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{iE(i,new nO(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class ik{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&nr(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class iS{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ik(e);const n=1e4+2e4*Math.random();nh(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;nr(e,(e,i)=>{i>0&&eI(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),nh(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function ix(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function iP(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function iR(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(C=E||(E={}))[C.OVERWRITE=0]="OVERWRITE",C[C.MERGE=1]="MERGE",C[C.ACK_USER_WRITE=2]="ACK_USER_WRITE",C[C.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class iN{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=E.ACK_USER_WRITE,this.source=ix()}operationForChild(e){if(!nq(this.path))return H(nL(this.path)===e,"operationForChild called for unrelated child."),new iN(nF(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return H(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new nO(e));return new iN(nD(),t,this.revert)}}}class iA{constructor(e,t){this.source=e,this.path=t,this.type=E.LISTEN_COMPLETE}operationForChild(e){return nq(this.path)?new iA(this.source,nD()):new iA(this.source,nF(this.path))}}class iO{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=E.OVERWRITE}operationForChild(e){return nq(this.path)?new iO(this.source,nD(),this.snap.getImmediateChild(e)):new iO(this.source,nF(this.path),this.snap)}}class iD{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=E.MERGE}operationForChild(e){if(!nq(this.path))return H(nL(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new iD(this.source,nF(this.path),this.children);{let t=this.children.subtree(new nO(e));return t.isEmpty()?null:t.value?new iO(this.source,nD(),t.value):new iD(this.source,nD(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class iL{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(nq(e))return this.isFullyInitialized()&&!this.filtered_;let t=nL(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class iM{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function iF(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw V("Should only compare child_ events.");let i=new nX(t.childName,t.snapshotNode),r=new nX(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{var i,o,a;let l=(i=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,i.index_)),o);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function ij(e,t){return{eventCache:e,serverCache:t}}function iU(e,t,n,i){return ij(new iL(t,n,i),e.serverCache)}function iB(e,t,n,i){return ij(e.eventCache,new iL(t,n,i))}function iW(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function iq(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class iz{static fromObject(e){let t=new iz(null);return nr(e,(e,n)=>{t=t.set(new nO(e),n)}),t}constructor(e,t=(!c&&(c=new n6(ne)),c)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:nD(),value:this.value};{if(nq(e))return null;let n=nL(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(nF(e),t);return null!=r?{path:nW(new nO(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(nq(e))return this;{let t=nL(e),n=this.children.get(t);return null!==n?n.subtree(nF(e)):new iz(null)}}set(e,t){if(nq(e))return new iz(t,this.children);{let n=nL(e),i=(this.children.get(n)||new iz(null)).set(nF(e),t),r=this.children.insert(n,i);return new iz(this.value,r)}}remove(e){if(nq(e))if(this.children.isEmpty())return new iz(null);else return new iz(null,this.children);{let t=nL(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(nF(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new iz(null):new iz(this.value,i)}}}get(e){if(nq(e))return this.value;{let t=nL(e),n=this.children.get(t);return n?n.get(nF(e)):null}}setTree(e,t){if(nq(e))return t;{let n,i=nL(e),r=(this.children.get(i)||new iz(null)).setTree(nF(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new iz(this.value,n)}}fold(e){return this.fold_(nD(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(nW(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,nD(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(nq(e))return null;let i=nL(e),r=this.children.get(i);return r?r.findOnPath_(nF(e),nW(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,nD(),t)}foreachOnPath_(e,t,n){if(nq(e))return this;{this.value&&n(t,this.value);let i=nL(e),r=this.children.get(i);return r?r.foreachOnPath_(nF(e),nW(t,i),n):new iz(null)}}foreach(e){this.foreach_(nD(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(nW(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class i${constructor(e){this.writeTree_=e}static empty(){return new i$(new iz(null))}}function iH(e,t,n){if(nq(t))return new i$(new iz(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=nz(r,t);return s=s.updateChild(o,n),new i$(e.writeTree_.set(r,s))}{let i=new iz(n);return new i$(e.writeTree_.setTree(t,i))}}}function iV(e,t,n){let i=e;return nr(n,(e,n)=>{i=iH(i,nW(t,e),n)}),i}function iK(e,t){return nq(t)?i$.empty():new i$(e.writeTree_.setTree(t,new iz(null)))}function iG(e,t){return null!=iY(e,t)}function iY(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(nz(n.path,t)):null}function iJ(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(n9,(e,n)=>{t.push(new nX(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new nX(e,n.value))}),t}function iX(e,t){if(nq(t))return e;{let n=iY(e,t);return new i$(null!=n?new iz(n):e.writeTree_.subtree(t))}}function iQ(e){return e.writeTree_.isEmpty()}function iZ(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(H(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(nW(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(nW(t,".priority"),r)),i}}(nD(),e.writeTree_,t)}function i0(e){return e.visible}function i1(e,t,n){let i=i$.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)nH(n,t)?i=iH(i,e=nz(n,t),s.snap):nH(t,n)&&(e=nz(t,n),i=iH(i,nD(),s.snap.getChild(e)));else if(s.children){if(nH(n,t))i=iV(i,e=nz(n,t),s.children);else if(nH(t,n))if(nq(e=nz(t,n)))i=iV(i,nD(),s.children);else{let t=eT(s.children,nL(e));if(t){let n=t.getChild(nF(e));i=iH(i,nD(),n)}}}else throw V("WriteRecord should have .snap or .children")}}return i}function i2(e,t,n,i,r){if(i||r){let s=iX(e.visibleWrites,t);return!r&&iQ(s)?n:r||null!=n||iG(s,nD())?iZ(i1(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(nH(e.path,t)||nH(t,e.path))},t),n||io.EMPTY_NODE):null}{let i=iY(e.visibleWrites,t);if(null!=i)return i;{let i=iX(e.visibleWrites,t);return iQ(i)?n:null!=n||iG(i,nD())?iZ(i,n||io.EMPTY_NODE):null}}}function i6(e,t,n,i){return i2(e.writeTree,e.treePath,t,n,i)}function i3(e,t){return function(e,t,n){let i=io.EMPTY_NODE,r=iY(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(n9,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return iJ(iX(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=iX(e.visibleWrites,t);return n.forEachChild(n9,(e,t)=>{let n=iZ(iX(r,new nO(e)),t);i=i.updateImmediateChild(e,n)}),iJ(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function i5(e,t,n,i){return function(e,t,n,i,r){H(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=nW(t,n);if(iG(e.visibleWrites,s))return null;{let t=iX(e.visibleWrites,s);return iQ(t)?r.getChild(n):iZ(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function i4(e,t){var n,i;return n=e.writeTree,i=nW(e.treePath,t),iY(n.visibleWrites,i)}function i8(e,t,n){var i,r;let s,o;return i=e.writeTree,r=e.treePath,s=nW(r,t),null!=(o=iY(i.visibleWrites,s))?o:n.isCompleteForChild(t)?iZ(iX(i.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function i7(e,t){return i9(nW(e.treePath,t),e.writeTree)}function i9(e,t){return{treePath:e,writeTree:t}}class re{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;H("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),H(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,im(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,ip(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,id(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,im(n,e.snapshotNode,i.oldSnap));else throw V("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let rt=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class rn{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new iL(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return i8(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:iq(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,o){let a,l=iX(e.visibleWrites,t),h=iY(l,nD());if(null!=h)a=h;else{if(null==n)return[];a=iZ(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function ri(e,t,n,i,r,s){let o=t.eventCache;if(null!=i4(i,n))return t;{let a,l;if(nq(n))if(H(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=iq(t),r=i3(i,n instanceof io?n:io.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=i6(i,iq(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=nL(n);if(".priority"===h){H(1===nM(n),"Can't have a priority with additional path components");let r=o.getNode(),s=i5(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let c,u=nF(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=i5(i,n,o.getNode(),l);c=null!=e?o.getNode().getImmediateChild(h).updateChild(u,e):o.getNode().getImmediateChild(h)}else c=i8(i,h,t.serverCache);a=null!=c?e.filter.updateChild(o.getNode(),h,c,u,r,s):o.getNode()}}return iU(t,a,o.isFullyInitialized()||nq(n),e.filter.filtersNodes())}}function rr(e,t,n,i,r,s,o,a){let l,h=t.serverCache,c=o?e.filter:e.filter.getIndexedFilter();if(nq(n))l=c.updateFullNode(h.getNode(),i,null);else if(c.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=c.updateFullNode(h.getNode(),e,null)}else{let e=nL(n);if(!h.isCompleteForPath(n)&&nM(n)>1)return t;let r=nF(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?c.updatePriority(h.getNode(),s):c.updateChild(h.getNode(),e,s,r,rt,null)}let u=iB(t,l,h.isFullyInitialized()||nq(n),c.filtersNodes()),d=new rn(r,u,s);return ri(e,u,n,r,d,a)}function rs(e,t,n,i,r,s,o){let a,l,h=t.eventCache,c=new rn(r,t,s);if(nq(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=iU(t,l,!0,e.filter.filtersNodes());else{let r=nL(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=iU(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=nF(n),u=h.getNode().getImmediateChild(r);if(nq(l))s=i;else{let e=c.getCompleteChild(r);s=null!=e?".priority"===nj(l)&&e.getChild(nB(l)).isEmpty()?e:e.updateChild(l,i):io.EMPTY_NODE}a=u.equals(s)?t:iU(t,e.filter.updateChild(h.getNode(),r,s,l,c,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function ro(e,t){return e.eventCache.isCompleteForChild(t)}function ra(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function rl(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=nq(n)?i:new iz(null).setTree(n,i);let c=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(c.hasChild(n)){let l=ra(e,t.serverCache.getNode().getImmediateChild(n),i);h=rr(e,h,new nO(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!c.hasChild(n)&&!l){let l=ra(e,t.serverCache.getNode().getImmediateChild(n),i);h=rr(e,h,new nO(n),l,r,s,o,a)}}),h}class rh{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new ig(n.getIndex()),r=function(e){return e.loadsAllData()?new ig(e.getIndex()):e.hasLimit()?new iv(e):new i_(e)}(n);this.processor_={filter:r};const s=t.serverCache,o=t.eventCache,a=i.updateFullNode(io.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(io.EMPTY_NODE,o.getNode(),null),h=new iL(a,s.isFullyInitialized(),i.filtersNodes()),c=new iL(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=ij(c,h),this.eventGenerator_=new iM(this.query_)}get query(){return this.query_}}function rc(e){return 0===e.eventRegistrations_.length}function ru(e,t,n){let i=[];if(n){H(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function rd(e,t,n,i){var r,s;t.type===E.MERGE&&null!==t.source.queryId&&(H(iq(e.viewCache_),"We should always have a full cache before handling merges"),H(iW(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){var s,o,a,l,h,c,u,d,p,f,m,g;let _,v,y=new re;if(n.type===E.OVERWRITE)n.source.fromUser?_=rs(e,t,n.path,n.snap,i,r,y):(H(n.source.fromServer,"Unknown source."),v=n.source.tagged||t.serverCache.isFiltered()&&!nq(n.path),_=rr(e,t,n.path,n.snap,i,r,v,y));else if(n.type===E.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=i,c=r,u=y,d=o,l.foreach((e,t)=>{let n=nW(a,e);ro(o,nL(n))&&(d=rs(s,d,n,t,h,c,u))}),l.foreach((e,t)=>{let n=nW(a,e);ro(o,nL(n))||(d=rs(s,d,n,t,h,c,u))}),_=d):(H(n.source.fromServer,"Unknown source."),v=n.source.tagged||t.serverCache.isFiltered(),_=rl(e,t,n.path,n.children,i,r,v,y))}else if(n.type===E.ACK_USER_WRITE)_=n.revert?function(e,t,n,i,r,s){let o;if(null!=i4(i,n))return t;{let a,l=new rn(i,t,r),h=t.eventCache.getNode();if(nq(n)||".priority"===nL(n)){let n;if(t.serverCache.isFullyInitialized())n=i6(i,iq(t));else{let e=t.serverCache.getNode();H(e instanceof io,"serverChildren would be complete if leaf node"),n=i3(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=nL(n),c=i8(i,r,t.serverCache);null==c&&t.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),(a=null!=c?e.filter.updateChild(h,r,c,nF(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,io.EMPTY_NODE,nF(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=i6(i,iq(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=i4(i,nD()),iU(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,y):function(e,t,n,i,r,s,o){if(null!=i4(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(nq(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return rr(e,t,n,l.getNode().getChild(n),r,s,a,o);else{if(!nq(n))return t;let i=new iz(null);return l.getNode().forEachChild(n0,(e,t)=>{i=i.set(new nO(e),t)}),rl(e,t,n,i,r,s,a,o)}{let h=new iz(null);return i.foreach((e,t)=>{let i=nW(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),rl(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,y);else if(n.type===E.LISTEN_COMPLETE){let r;d=e,p=t,f=n.path,m=i,g=y,r=p.serverCache,_=ri(d,iB(p,r.getNode(),r.isFullyInitialized()||nq(f),r.isFiltered()),f,m,rt,g)}else throw V("Unknown operation type: "+n.type);let b=y.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=iW(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(iu(iW(t)))}}(t,_,b),{viewCache:_,changes:b}}(e.processor_,o,t,n,i);return r=e.processor_,H((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),H(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),H(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,rp(e,a.changes,a.viewCache.eventCache.getNode(),null)}function rp(e,t,n,i){var r;let s,o,a=i?[i]:e.eventRegistrations_;return r=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),iF(r,s,"child_removed",t,a,n),iF(r,s,"child_added",t,a,n),iF(r,s,"child_moved",o,a,n),iF(r,s,"child_changed",t,a,n),iF(r,s,"value",t,a,n),s}class rf{constructor(){this.views=new Map}}function rm(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return H(null!=s,"SyncTree gave us an op for an invalid query."),rd(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(rd(s,t,n,i));return r}}function rg(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function r_(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=iq(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!nq(t)&&!n.getImmediateChild(nL(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function rv(e,t){if(t._queryParams.loadsAllData())return rb(e);{let n=t._queryIdentifier;return e.views.get(n)}}function ry(e){return null!=rb(e)}function rb(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let rw=1;class rC{constructor(e){this.listenProvider_=e,this.syncPointTree_=new iz(null),this.pendingWriteTree_={visibleWrites:i$.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function rI(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,H(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=iH(s.visibleWrites,t,n)),s.lastWriteId=i,r)?rP(e,new iO(ix(),t,n)):[]}function rT(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);H(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=i&&function(e,t){if(e.snap)return nH(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&nH(nW(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:nH(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=i1(n.allWrites,i0,nD()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=iK(e.visibleWrites,r.path):nr(r.children,t=>{e.visibleWrites=iK(e.visibleWrites,nW(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new iz(null);return null!=i.snap?t=t.set(nD(),!0):nr(i.children,e=>{t=t.set(new nO(e),!0)}),rP(e,new iN(i.path,t,n))}}function rE(e,t,n){return rP(e,new iO(iP(),t,n))}function rk(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=rv(o,t))){let c=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=ry(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(ru(r,n,i)),rc(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(ru(t,n,i)),rc(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!ry(e)&&s.push(new(H(u,"Reference.ts has not been loaded"),u)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=c.removed;if(a=c.events,!r){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>ry(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&ry(t))return[rb(t)];{let e=[];return t&&(e=rg(t)),nr(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=rR(e,i);e.listenProvider_.startListening(rM(r),rN(e,r),s.hashFn,s.onComplete)}}}r||!(d.length>0)||i||(n?e.listenProvider_.stopListening(rM(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(rA(t));e.listenProvider_.stopListening(rM(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=rA(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function rS(e,t,n,i=!1){var r;let s,o,a,l,h=t._path,c=null,u=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=nz(e,h);c=c||r_(t,n),u=u||ry(t)});let d=e.syncPointTree_.get(h);d?(u=u||ry(d),c=c||r_(d,nD())):(d=new rf,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=c?s=!0:(s=!1,c=io.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=r_(t,nD());n&&(c=c.updateImmediateChild(e,n))}));let p=null!=rv(d,t);if(!p&&!t._queryParams.loadsAllData()){let n=rA(t);H(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=rw++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let f=i9(h,e.pendingWriteTree_),m=(o=function(e,t,n,i,r){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=i6(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof io?i3(n,i):io.EMPTY_NODE,s=!1),new rh(t,ij(new iL(e,s,!1),new iL(i,r,!1)))}return o}(r=d,t,f,c,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(n9,(e,t)=>{l.push(id(e,t))}),a.isFullyInitialized()&&l.push(iu(a.getNode())),rp(o,l,a.getNode(),n));if(!p&&!u&&!i){let n=rv(d,t);m=m.concat(function(e,t,n){let i=t._path,r=rN(e,t),s=rR(e,n),o=e.listenProvider_.startListening(rM(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)H(!ry(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!nq(e)&&t&&ry(t))return[rb(t).query];{let e=[];return t&&(e=e.concat(rg(t).map(e=>e.query))),nr(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(rM(i),rN(e,i))}}return o}(e,t,n))}return m}function rx(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=r_(n,nz(e,t));if(i)return i});return i2(i,t,r,n,!0)}function rP(e,t){var n;return function e(t,n,i,r){if(nq(t.path))return function e(t,n,i,r){let s=n.get(nD());null==i&&null!=s&&(i=r_(s,nD()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=i7(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(rm(s,t,r,i))),o}(t,n,i,r);{let s=n.get(nD());null==i&&null!=s&&(i=r_(s,nD()));let o=[],a=nL(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=i7(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(rm(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,i9(nD(),n)))}function rR(e,t){let n=t.query,i=rN(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||io.EMPTY_NODE).hash(),onComplete:t=>{var r;if("ok"===t)if(i)return function(e,t,n){let i=rO(e,n);if(!i)return[];{let n=rD(i),r=n.path,s=n.queryId,o=nz(r,t);return rL(e,r,new iA(iR(s),o))}}(e,n._path,i);else return r=n._path,rP(e,new iA(iP(),r));{let i,r,s=(i="Unknown Error","too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(r=Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),r);return rk(e,n,null,s)}}}}function rN(e,t){let n=rA(t);return e.queryToTagMap.get(n)}function rA(e){return e._path.toString()+"$"+e._queryIdentifier}function rO(e,t){return e.tagToQueryMap.get(t)}function rD(e){let t=e.indexOf("$");return H(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new nO(e.substr(0,t))}}function rL(e,t,n){let i=e.syncPointTree_.get(t);return H(i,"Missing sync point for query tag that we're tracking"),rm(i,n,i9(t,e.pendingWriteTree_),null)}function rM(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(H(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class rF{constructor(e){this.node_=e}getImmediateChild(e){return new rF(this.node_.getImmediateChild(e))}node(){return this.node_}}class rj{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=nW(this.path_,e);return new rj(this.syncTree_,t)}node(){return rx(this.syncTree_,this.path_)}}let rU=function(e,t,n){return e&&"object"==typeof e?(H(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?rB(e[".sv"],t,n):"object"==typeof e[".sv"]?rW(e[".sv"],t):void H(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},rB=function(e,t,n){if("timestamp"===e)return n.timestamp;H(!1,"Unexpected server value: "+e)},rW=function(e,t,n){e.hasOwnProperty("increment")||H(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&H(!1,"Unexpected increment value: "+i);let r=t.node();if(H(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},rq=function(e,t,n){return rz(e,new rF(t),n)};function rz(e,t,n){let i,r=rU(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new n7(r))),e.forEachChild(n9,(e,r)=>{let s=rz(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=rU(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new n7(i,il(r)):e}}class r${constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function rH(e,t){let n=t instanceof nO?t:new nO(t),i=e,r=nL(n);for(;null!==r;){let e=eT(i.node.children,r)||{children:{},childCount:0};i=new r$(r,i,e),r=nL(n=nF(n))}return i}function rV(e){return e.node.value}function rK(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===rV(i)&&!rG(i),s=eI(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function rG(e){return e.node.childCount>0}function rY(e,t){nr(e.node.children,(n,i)=>{t(new r$(n,e,i))})}function rJ(e){return new nO(null===e.parent?e.name:rJ(e.parent)+"/"+e.name)}let rX=/[\[\].#$\/\u0000-\u001F\u007F]/,rQ=/[\[\].#$\u0000-\u001F\u007F]/,rZ=function(e){return"string"==typeof e&&0!==e.length&&!rX.test(e)},r0=function(e){return"string"==typeof e&&0!==e.length&&!rQ.test(e)},r1=function(e,t,n,i){i&&void 0===t||r2(eL(e,"value"),t,n)},r2=function(e,t,n){let i=n instanceof nO?new nV(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+nG(i));if("function"==typeof t)throw Error(e+"contains a function "+nG(i)+" with contents = "+t.toString());if(t5(t))throw Error(e+"contains "+t.toString()+" "+nG(i));if("string"==typeof t&&t.length>3495253.3333333335&&eF(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+nG(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(nr(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!rZ(t)))throw Error(e+" contains an invalid key ("+t+") "+nG(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=eF(t),nK(i),r2(e,s,i),o=i.parts_.pop(),i.byteLength_-=eF(o),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+nG(i)+" in addition to actual children.")}},r6=function(e,t,n,i){if((!i||void 0!==n)&&!r0(n))throw Error(eL(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},r3=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),r6(e,t,n,i)},r5=function(e,t){if(".info"===nL(t))throw Error(e+" failed = Can't modify data under /.info/")},r4=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!rZ(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!r0(n)))throw Error(eL(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class r8{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function r7(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||n$(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function r9(e,t,n){r7(e,n),st(e,e=>n$(e,t))}function se(e,t,n){r7(e,n),st(e,e=>nH(e,t)||nH(t,e))}function st(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();tJ&&tZ("event: "+n.toString()),nl(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class sn{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new r8,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=iT(),this.transactionQueueTree_=new r$,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function si(e){let t=e.infoData_.getNode(new nO(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function sr(e){var t;return(t=t={timestamp:si(e)}).timestamp=t.timestamp||new Date().getTime(),t}function ss(e,t,n,i,r){e.dataUpdateCount++;let s=new nO(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){let t=ek(n,e=>il(e));o=function(e,t,n,i){let r=rO(e,i);if(!r)return[];{let i=rD(r),s=i.path,o=i.queryId,a=nz(s,t),l=iz.fromObject(n);return rL(e,s,new iD(iR(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=il(n);o=function(e,t,n,i){let r=rO(e,i);if(null==r)return[];{let i=rD(r),s=i.path,o=i.queryId,a=nz(s,t);return rL(e,s,new iO(iR(o),a,n))}}(e.serverSyncTree_,s,t,r)}else if(i){var a;let t,i=ek(n,e=>il(e));a=e.serverSyncTree_,t=iz.fromObject(i),o=rP(a,new iD(iP(),s,t))}else{let t=il(n);o=rE(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=sd(e,s)),se(e.eventQueue_,l,o)}function so(e,t){var n;let i,r,s;sa(e,"connected",t),!1===t&&(sc(n=e,"onDisconnectEvents"),i=sr(n),r=iT(),iE(n.onDisconnect_,nD(),(e,t)=>{var s;let o=(s=n.serverSyncTree_,rz(t,new rj(s,e),i));!function e(t,n,i){if(nq(n))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,i);else{let r=nL(n);t.children.has(r)||t.children.set(r,iT()),e(t.children.get(r),n=nF(n),i)}}(r,e,o)}),s=[],iE(r,nD(),(e,t)=>{s=s.concat(rE(n.serverSyncTree_,e,t));let i=sg(n,e);sd(n,i)}),n.onDisconnect_=iT(),se(n.eventQueue_,nD(),s))}function sa(e,t,n){let i=new nO("/.info/"+t),r=il(n);e.infoData_.updateSnapshot(i,r);let s=rE(e.infoSyncTree_,i,r);se(e.eventQueue_,i,s)}function sl(e){return e.nextWriteId_++}function sh(e,t,n){let i;i=".info"===nL(t._path)?rk(e.infoSyncTree_,t,n):rk(e.serverSyncTree_,t,n),r9(e.eventQueue_,t._path,i)}function sc(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),tZ(n,...t)}function su(e,t,n){return rx(e.serverSyncTree_,t,n)||io.EMPTY_NODE}function sd(e,t){let n=sp(e,t),i=rJ(n),r=sf(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=nz(n,a.path),h=!1,c;if(H(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,c=a.abortReason,r=r.concat(rT(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,c="maxretry",r=r.concat(rT(e.serverSyncTree_,a.currentWriteId,!0));else{let n=su(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){r2("transaction failed: Data returned ",i,a.path);let t=il(i);"object"==typeof i&&null!=i&&eI(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=rq(t,n,sr(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=sl(e),s.splice(s.indexOf(o),1),r=(r=r.concat(rI(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(rT(e.serverSyncTree_,o,!0))}else h=!0,c="nodata",r=r.concat(rT(e.serverSyncTree_,a.currentWriteId,!0))}se(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===c?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(c),!1,null))))}sm(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)nl(i[e]);!function e(t,n=t.transactionQueueTree_){if(n||sm(t,n),rV(n)){let i=sf(t,n);H(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=su(t,n,i.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<i.length;e++){let t=i[e];H(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=nz(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,r=>{sc(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(rT(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();sm(t,rH(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),se(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)nl(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{t6("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}sd(t,n)}},o)}(t,rJ(n),i)}else rG(n)&&rY(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,r,i),i}function sp(e,t){let n,i=e.transactionQueueTree_;for(n=nL(t);null!==n&&void 0===rV(i);)i=rH(i,n),n=nL(t=nF(t));return i}function sf(e,t){let n=[];return function e(t,n,i){let r=rV(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);rY(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function sm(e,t){let n=rV(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,rK(t,n.length>0?n:void 0)}rY(t,t=>{sm(e,t)})}function sg(e,t){let n=rJ(sp(e,t)),i=rH(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{s_(e,t)}),s_(e,i),!function e(t,n,i,r){i&&!r&&n(t),rY(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{s_(e,t)}),n}function s_(e,t){let n=rV(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(H(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(H(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(rT(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?rK(t,void 0):n.length=s+1,se(e.eventQueue_,rJ(t),r);for(let e=0;e<i.length;e++)nl(i[e])}}let sv=function(e,t){let n=sy(e),i=n.namespace;"firebase.com"===n.domain&&t2(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||t2("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||t3();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new ng(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new nO(n.pathString)}},sy=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let c=e.indexOf("/");-1===c&&(c=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(c,u)),c<u&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(c,u)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):t6(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let p=t.slice(0,h);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},sb="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",sw=(v=0,y=[],function(e){let t,n=e===v;v=e;let i=Array(8);for(t=7;t>=0;t--)i[t]=sb.charAt(e%64),e=Math.floor(e/64);H(0===e,"Cannot push at time == 0");let r=i.join("");if(n){for(t=11;t>=0&&63===y[t];t--)y[t]=0;y[t]++}else for(t=0;t<12;t++)y[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)r+=sb.charAt(y[t]);return H(20===r.length,"nextPushId: Length should be 20."),r});class sC{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+ey(this.snapshot.exportVal())}}class sI{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class sT{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return H(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class sE{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return nq(this._path)?null:nj(this._path)}get ref(){return new sk(this._repo,this._path)}get _queryIdentifier(){let e=nn(iw(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return iw(this._queryParams)}isEqual(e){if(!((e=ej(e))instanceof sE))return!1;let t=this._repo===e._repo,n=n$(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class sk extends sE{constructor(e,t){super(e,t,new iy,!1)}get parent(){let e=nB(this._path);return null===e?null:new sk(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class sS{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new nO(e),n=sP(this.ref,e);return new sS(this._node.getChild(t),n,n9)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new sS(n,sP(this.ref,t),n9)))}hasChild(e){let t=new nO(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function sx(e,t){return(e=ej(e))._checkNotDeleted("ref"),void 0!==t?sP(e._root,t):e._root}function sP(e,t){return null===nL((e=ej(e))._path)?r3("child","path",t,!1):r6("child","path",t,!1),new sk(e._repo,nW(e._path,t))}function sR(e,t){let n;r5("push",(e=ej(e))._path),r1("push",t,e._path,!0);let i=sw(si(e._repo)),r=sP(e,i),s=sP(e,i);return r.then=(n=null!=t?sN(s,t).then(()=>s):Promise.resolve(s)).then.bind(n),r.catch=n.then.bind(n,void 0),r}function sN(e,t){var n,i,r;let s,o,a,l,h,c;r5("set",(e=ej(e))._path),r1("set",t,e._path,!1);let u=new er;return n=e._repo,i=e._path,r=u.wrapCallback(()=>{}),sc(n,"set",{path:i.toString(),value:t,priority:null}),s=sr(n),a=rq(o=il(t,null),rx(n.serverSyncTree_,i),s),l=sl(n),h=rI(n.serverSyncTree_,i,a,l,!0),r7(n.eventQueue_,h),n.server_.put(i.toString(),o.val(!0),(e,t)=>{var s,o,a;let h="ok"===e;h||t6("set at "+i+" failed: "+e);let c=rT(n.serverSyncTree_,l,!h);se(n.eventQueue_,i,c),s=r,o=e,a=t,s&&nl(()=>{if("ok"===o)s(null);else{let e=(o||"error").toUpperCase(),t=e;a&&(t+=": "+a);let n=Error(t);n.code=e,s(n)}})}),c=sg(n,i),sd(n,c),se(n.eventQueue_,c,[]),u.promise}class sA{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new sC("value",this,new sS(e.snapshotNode,new sk(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sI(this,e,t):null}matches(e){return e instanceof sA&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class sO{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sI(this,e,t):null}createEvent(e,t){H(null!=e.childName,"Child events should have a childName.");let n=sP(new sk(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new sC(e.type,this,new sS(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof sO&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function sD(e,t,n,i){return function(e,t,n,i,r){var s;let o,a;if("object"==typeof i&&(o=void 0,r=i),"function"==typeof i&&(o=i),r&&r.onlyOnce){let t=n,i=(n,i)=>{sh(e._repo,e,h),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}let l=new sT(n,o||void 0),h="value"===t?new sA(l):new sO(t,l);return s=e._repo,a=".info"===nL(e._path)?rS(s.infoSyncTree_,e,h):rS(s.serverSyncTree_,e,h),r9(s.eventQueue_,e._path,a),()=>sh(e._repo,e,h)}(e,"value",t,n,i)}H(!u,"__referenceConstructor has already been defined"),u=sk,H(!d,"__referenceConstructor has already been defined"),d=sk;let sL={};class sM{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var i;let r;if(e.stats_=nw(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new iC(e.repoInfo_,(t,n,i,r)=>{ss(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>so(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{ey(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new nJ(e.repoInfo_,t,(t,n,i,r)=>{ss(e,t,n,i,r)},t=>{so(e,t)},t=>{var n;n=e,nr(t,(e,t)=>{sa(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),i=e.repoInfo_,nb[r=i.toString()]||(nb[r]=(()=>new iS(e.stats_,e.server_))()),e.statsReporter_=nb[r],e.infoData_=new iI,e.infoSyncTree_=new rC({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=rE(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),sa(e,"connected",!1),e.serverSyncTree_=new rC({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);se(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new sk(this._repo,nD())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=sL[t=this.app.name])&&n[e.key]===e||t2(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&t2("Cannot call "+e+" on a deleted database.")}}function sF(e=tC(),t){let n=th(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let e=(e=>{let t=et(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})("database");e&&function(e,t,n,i={}){var r;let s,o,a;(e=ej(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eS(i,h.repoInfo_.emulatorOptions))return;t2("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(i.mockUserToken&&t2('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new nd(nd.OWNER)):i.mockUserToken&&(s=new nd("string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...e};return[Q(JSON.stringify({alg:"none",type:"JWT"})),Q(JSON.stringify(s)),""].join(".")}(i.mockUserToken,e.app.options.projectId))),es(t)&&(eo(t),eh("Database",!0)),r=s,o=l.lastIndexOf(":"),a=es(l.substring(0,o)),h.repoInfo_=new ng(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,i),r&&(h.authTokenProvider_=r)}(n,...e)}return n}function sj(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}nJ.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},nJ.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},tB=ty,tl(new eU("database",(e,{instanceIdentifier:t})=>{var n,i,r,s;let o,a,l,h,c,u,d,p=e.getProvider("app").getImmediate(),f=e.getProvider("auth-internal"),m=e.getProvider("app-check-internal");return void 0===(l=t||p.options.databaseURL)&&(p.options.projectId||t2("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),tZ("Using default host for project ",p.options.projectId),l=`${p.options.projectId}-default-rtdb.firebaseio.com`),c=(h=sv(l,void 0)).repoInfo,void 0!==$.default&&$.default.env&&(u=$.default.env.FIREBASE_DATABASE_EMULATOR_HOST),u?c=(h=sv(l=`http://${u}?ns=${c.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new nu(p.name,p.options,f),r4("Invalid Firebase Database URL",h),nq(h.path)||t2("Database URL must point to the root of a Firebase Database (not including a child path)."),new sM((n=c,i=p,r=d,s=new nc(p,m),(o=sL[i.name])||(o={},sL[i.name]=o),(a=o[n.toURLString()])&&t2("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new sn(n,!1,r,s),o[n.toURLString()]=a,a),p)},"PUBLIC").setMultipleInstances(!0)),tE(tj,tU,void 0),tE(tj,tU,"esm2020");let sU=new eg("auth","Firebase",sj()),sB=new eG("@firebase/auth");function sW(e,...t){sB.logLevel<=T.ERROR&&sB.error(`Auth (${ty}): ${e}`,...t)}function sq(e,...t){throw sV(e,...t)}function sz(e,...t){return sV(e,...t)}function s$(e,t,n){return new eg("auth","Firebase",{...sj(),[t]:n}).create(t,{appName:e.name})}function sH(e){return s$(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function sV(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return sU.create(e,...t)}function sK(e,t,...n){if(!e)throw sV(t,...n)}function sG(e){let t="INTERNAL ASSERTION FAILED: "+e;throw sW(t),Error(t)}function sY(){return"undefined"!=typeof self&&self.location?.href||""}function sJ(){return"undefined"!=typeof self&&self.location?.protocol||null}class sX{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||sG(n),this.isMobile=eu()||ep()}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===sJ()||"https:"===sJ()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function sQ(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||sG(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class sZ{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void sG("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void sG("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void sG("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let s0={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},s1=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],s2=new sX(3e4,6e4);function s6(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function s3(e,t,n,i,r={}){return s5(e,r,async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});let o=eP({key:e.config.apiKey,...s}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:a,...r};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&es(e.emulatorConfig.host)&&(l.credentials="include"),sZ.fetch()(await s8(e,e.config.apiHost,n,o),l)})}async function s5(e,t,n){e._canInitEmulator=!1;let i={...s0,...t};try{let t=new s7(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw s9(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw s9(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw s9(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw s9(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw s$(e,o,n);sq(e,o)}}catch(t){if(t instanceof em)throw t;sq(e,"network-request-failed",{message:String(t)})}}async function s4(e,t,n,i,r={}){let s=await s3(e,t,n,i,r);return"mfaPendingCredential"in s&&sq(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function s8(e,t,n,i){let r=`${t}${n}?${i}`,s=e.config.emulator?sQ(e.config,r):`${e.config.apiScheme}://${r}`;return s1.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class s7{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(sz(this.auth,"network-request-failed")),s2.get())})}}function s9(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=sz(e,t,i);return r.customData._tokenResponse=n,r}function oe(e){return void 0!==e&&void 0!==e.enterprise}class ot{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function on(e,t){return s3(e,"GET","/v2/recaptchaConfig",s6(e,t))}async function oi(e,t){return s3(e,"POST","/v1/accounts:delete",t)}async function or(e,t){return s3(e,"POST","/v1/accounts:lookup",t)}function os(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function oo(e,t=!1){let n=ej(e),i=await n.getIdToken(t),r=ol(i);sK(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");let s="object"==typeof r.firebase?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:os(oa(r.auth_time)),issuedAtTime:os(oa(r.iat)),expirationTime:os(oa(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function oa(e){return 1e3*Number(e)}function ol(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return sW("JWT malformed, contained fewer than 3 sections"),null;try{let e=Z(n);if(!e)return sW("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return sW("Caught error parsing JWT payload as JSON",e?.toString()),null}}function oh(e){let t=ol(e);return sK(t,"internal-error"),sK(void 0!==t.exp,"internal-error"),sK(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function oc(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof em&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class ou{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class od{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=os(this.lastLoginAt),this.creationTime=os(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function op(e){var t,n;let i=e.auth,r=await e.getIdToken(),s=await oc(e,or(i,{idToken:r}));sK(s?.users.length,i,"internal-error");let o=s.users[0];e._notifyReloadListener(o);let a=o.providerUserInfo?.length?om(o.providerUserInfo):[],l=(t=e.providerData,n=a,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),h=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!l?.length;Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new od(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&c})}async function of(e){let t=ej(e);await op(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function om(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function og(e,t){let n=await s5(e,{},async()=>{let n=eP({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await s8(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";let a={method:"POST",headers:o,body:n};return e.emulatorConfig&&es(e.emulatorConfig.host)&&(a.credentials="include"),sZ.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function o_(e,t){return s3(e,"POST","/v2/accounts:revokeToken",s6(e,t))}class ov{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){sK(e.idToken,"internal-error"),sK(void 0!==e.idToken,"internal-error"),sK(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):oh(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){sK(0!==e.length,"internal-error");let t=oh(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(sK(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await og(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new ov;return n&&(sK("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(sK("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(sK("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new ov,this.toJSON())}_performRefresh(){return sG("not implemented")}}function oy(e,t){sK("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ob{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new ou(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new od(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await oc(this,this.stsTokenManager.getToken(this.auth,e));return sK(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return oo(this,e)}reload(){return of(this)}_assign(e){this!==e&&(sK(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new ob({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){sK(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await op(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tp(this.auth.app))return Promise.reject(sH(this.auth));let e=await this.getIdToken();return await oc(this,oi(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,l=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:c,emailVerified:u,isAnonymous:d,providerData:p,stsTokenManager:f}=t;sK(c&&f,e,"internal-error");let m=ov.fromJSON(this.name,f);sK("string"==typeof c,e,"internal-error"),oy(n,e.name),oy(i,e.name),sK("boolean"==typeof u,e,"internal-error"),sK("boolean"==typeof d,e,"internal-error"),oy(r,e.name),oy(s,e.name),oy(o,e.name),oy(a,e.name),oy(l,e.name),oy(h,e.name);let g=new ob({uid:c,auth:e,email:i,emailVerified:u,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:r,tenantId:o,stsTokenManager:m,createdAt:l,lastLoginAt:h});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){let i=new ov;i.updateFromServerResponse(t);let r=new ob({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await op(r),r}static async _fromGetAccountInfoResponse(e,t,n){let i=t.users[0];sK(void 0!==i.localId,"internal-error");let r=void 0!==i.providerUserInfo?om(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!r?.length,o=new ov;o.updateFromIdToken(n);let a=new ob({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new od(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length}),a}}let ow=new Map;function oC(e){var t,n;t="Expected a class definition",e instanceof Function||sG(t);let i=ow.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||sG(n)):(i=new e,ow.set(e,i)),i}class oI{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function oT(e,t,n){return`firebase:${e}:${t}:${n}`}oI.type="NONE";class oE{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=oT(this.userKey,i.apiKey,r),this.fullPersistenceKey=oT("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await or(this.auth,{idToken:e}).catch(()=>void 0);return t?ob._fromGetAccountInfoResponse(this.auth,t,e):null}return ob._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new oE(oC(oI),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||oC(oI),s=oT(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let i;if("string"==typeof t){let n=await or(e,{idToken:t}).catch(()=>void 0);if(!n)break;i=await ob._fromGetAccountInfoResponse(e,n,t)}else i=ob._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch{}let a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length&&(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch{}}))),new oE(r,e,n)}}function ok(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(oR(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(oS(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(oA(t))return"Blackberry";if(oO(t))return"Webos";if(ox(t))return"Safari";if((t.includes("chrome/")||oP(t))&&!t.includes("edge/"))return"Chrome";if(oN(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function oS(e=ec()){return/firefox\//i.test(e)}function ox(e=ec()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function oP(e=ec()){return/crios\//i.test(e)}function oR(e=ec()){return/iemobile/i.test(e)}function oN(e=ec()){return/android/i.test(e)}function oA(e=ec()){return/blackberry/i.test(e)}function oO(e=ec()){return/webos/i.test(e)}function oD(e=ec()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function oL(e=ec()){return oD(e)||oN(e)||oO(e)||oA(e)||/windows phone/i.test(e)||oR(e)}function oM(e,t=[]){let n;switch(e){case"Browser":n=ok(ec());break;case"Worker":n=`${ok(ec())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${ty}/${i}`}class oF{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function oj(e,t={}){return s3(e,"GET","/v2/passwordPolicy",s6(e,t))}class oU{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class oB{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new oW(this),this.idTokenSubscription=new oW(this),this.beforeStateQueue=new oF(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sU,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=oC(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await oE.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await or(this,{idToken:e}),n=await ob._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(tp(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===r)&&s?.user&&(n=s.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(sK(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await op(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tp(this.app))return Promise.reject(sH(this));let t=e?ej(e):null;return t&&sK(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&sK(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tp(this.app)?Promise.reject(sH(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tp(this.app)?Promise.reject(sH(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(oC(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new oU(await oj(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new eg("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await o_(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&oC(e)||this._popupRedirectResolver;sK(t,this,"argument-error"),this.redirectPersistenceManager=await oE.create(this,[oC(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(sK(o,this,"internal-error"),o.then(()=>{s||r(this.currentUser)}),"function"==typeof t){let r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return sK(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=oM(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(tp(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){sB.logLevel<=T.WARN&&sB.warn(`Auth (${ty}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class oW{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new eO(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return sK(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let oq={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function oz(e){return`__${e}${Math.floor(1e6*Math.random())}`}class o${constructor(){this.enterprise=new oH}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class oH{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let oV="NO_RECAPTCHA";class oK{constructor(e){this.type="recaptcha-enterprise",this.auth=ej(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{on(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new ot(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;oe(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(oV)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new o$().execute("siteKey",{action:"verify"}):new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&oe(window.grecaptcha))i(n,e,r);else{var s;if("undefined"==typeof window)return void r(Error("RecaptchaVerifier is only supported in browser"));let t=oq.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,oq.loadJS(s)).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function oG(e,t,n,i=!1,r=!1){let s,o=new oK(e);if(r)s=oV;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function oY(e,t,n,i,r){if("EMAIL_PASSWORD_PROVIDER"===r)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async r=>{if("auth/missing-recaptcha-token"!==r.code)return Promise.reject(r);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let r=await oG(e,t,n,"getOobCode"===n);return i(e,r)}});else{let r=await oG(e,t,n,"getOobCode"===n);return i(e,r)}if("PHONE_PROVIDER"!==r)return Promise.reject(r+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let r=await oG(e,t,n);return i(e,r).catch(async r=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let r=await oG(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)})}{let r=await oG(e,t,n,!1,!0);return i(e,r)}}async function oJ(e){let t=ej(e),n=new ot(await on(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new oK(t).verify()}function oX(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function oQ(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class oZ{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return sG("not implemented")}_getIdTokenResponse(e){return sG("not implemented")}_linkToIdToken(e,t){return sG("not implemented")}_getReauthenticationResolver(e){return sG("not implemented")}}async function o0(e,t){return s3(e,"POST","/v1/accounts:signUp",t)}async function o1(e,t){return s4(e,"POST","/v1/accounts:signInWithPassword",s6(e,t))}async function o2(e,t){return s4(e,"POST","/v1/accounts:signInWithEmailLink",s6(e,t))}async function o6(e,t){return s4(e,"POST","/v1/accounts:signInWithEmailLink",s6(e,t))}class o3 extends oZ{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new o3(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new o3(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return oY(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",o1,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return o2(e,{email:this._email,oobCode:this._password});default:sq(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return oY(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",o0,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return o6(e,{idToken:t,email:this._email,oobCode:this._password});default:sq(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function o5(e,t){return s4(e,"POST","/v1/accounts:signInWithIdp",s6(e,t))}class o4 extends oZ{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new o4(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):sq("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...i}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let r=new o4(t,n);return r.idToken=i.idToken||void 0,r.accessToken=i.accessToken||void 0,r.secret=i.secret,r.nonce=i.nonce,r.pendingToken=i.pendingToken||null,r}_getIdTokenResponse(e){return o5(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,o5(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,o5(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eP(t)}return e}}async function o8(e,t){return s3(e,"POST","/v1/accounts:sendVerificationCode",s6(e,t))}async function o7(e,t){return s4(e,"POST","/v1/accounts:signInWithPhoneNumber",s6(e,t))}async function o9(e,t){let n=await s4(e,"POST","/v1/accounts:signInWithPhoneNumber",s6(e,t));if(n.temporaryProof)throw s9(e,"account-exists-with-different-credential",n);return n}let ae={USER_NOT_FOUND:"user-not-found"};async function at(e,t){return s4(e,"POST","/v1/accounts:signInWithPhoneNumber",s6(e,{...t,operation:"REAUTH"}),ae)}class an extends oZ{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new an({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new an({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return o7(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return o9(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return at(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new an({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class ai{constructor(e){const t=eR(eN(e)),n=t.apiKey??null,i=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);sK(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,i,r=(n=(t=eR(eN(e)).link)?eR(eN(t)).deep_link_id:null,((i=eR(eN(e)).deep_link_id)?eR(eN(i)).link:null)||i||n||t||e);try{return new ai(r)}catch{return null}}}class ar{constructor(){this.providerId=ar.PROVIDER_ID}static credential(e,t){return o3._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=ai.parseLink(t);return sK(n,"argument-error"),o3._fromEmailAndCode(e,n.code,n.tenantId)}}ar.PROVIDER_ID="password",ar.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ar.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class as{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class ao extends as{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class aa extends ao{constructor(){super("facebook.com")}static credential(e){return o4._fromParams({providerId:aa.PROVIDER_ID,signInMethod:aa.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return aa.credentialFromTaggedObject(e)}static credentialFromError(e){return aa.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return aa.credential(e.oauthAccessToken)}catch{return null}}}aa.FACEBOOK_SIGN_IN_METHOD="facebook.com",aa.PROVIDER_ID="facebook.com";class al extends ao{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return o4._fromParams({providerId:al.PROVIDER_ID,signInMethod:al.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return al.credentialFromTaggedObject(e)}static credentialFromError(e){return al.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return al.credential(t,n)}catch{return null}}}al.GOOGLE_SIGN_IN_METHOD="google.com",al.PROVIDER_ID="google.com";class ah extends ao{constructor(){super("github.com")}static credential(e){return o4._fromParams({providerId:ah.PROVIDER_ID,signInMethod:ah.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ah.credentialFromTaggedObject(e)}static credentialFromError(e){return ah.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ah.credential(e.oauthAccessToken)}catch{return null}}}ah.GITHUB_SIGN_IN_METHOD="github.com",ah.PROVIDER_ID="github.com";class ac extends ao{constructor(){super("twitter.com")}static credential(e,t){return o4._fromParams({providerId:ac.PROVIDER_ID,signInMethod:ac.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ac.credentialFromTaggedObject(e)}static credentialFromError(e){return ac.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ac.credential(t,n)}catch{return null}}}ac.TWITTER_SIGN_IN_METHOD="twitter.com",ac.PROVIDER_ID="twitter.com";class au{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new au({user:await ob._fromIdTokenResponse(e,n,i),providerId:ad(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new au({user:e,providerId:ad(n),_tokenResponse:n,operationType:t})}}function ad(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ap extends em{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,ap.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new ap(e,t,n,i)}}function af(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw ap._fromErrorAndOperation(e,n,t,i);throw n})}async function am(e,t,n=!1){let i=await oc(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return au._forOperation(e,"link",i)}async function ag(e,t,n=!1){let{auth:i}=e;if(tp(i.app))return Promise.reject(sH(i));let r="reauthenticate";try{let s=await oc(e,af(i,r,t,e),n);sK(s.idToken,i,"internal-error");let o=ol(s.idToken);sK(o,i,"internal-error");let{sub:a}=o;return sK(e.uid===a,i,"user-mismatch"),au._forOperation(e,r,s)}catch(e){throw e?.code==="auth/user-not-found"&&sq(i,"user-mismatch"),e}}async function a_(e,t,n=!1){if(tp(e.app))return Promise.reject(sH(e));let i="signIn",r=await af(e,i,t),s=await au._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}class av{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ay._fromServerResponse(e,t):"totpInfo"in t?ab._fromServerResponse(e,t):sq(e,"internal-error")}}class ay extends av{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ay(t)}}class ab extends av{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new ab(t)}}function aw(e,t){return s3(e,"POST","/v2/accounts/mfaEnrollment:start",s6(e,t))}new WeakMap;let aC="__sak";class aI{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(aC,"1"),this.storage.removeItem(aC),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class aT extends aI{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oL(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let i=e.key;t?this.detachListener():this.stopPolling();let r=()=>{let e=this.storage.getItem(i);(t||this.localCache[i]!==e)&&this.notifyListeners(i,e)},s=this.storage.getItem(i);((n=ec()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}aT.type="LOCAL";class aE extends aI{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}aE.type="SESSION";class ak{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new ak(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!r?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function aS(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ak.receivers=[];class ax{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=aS("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(h),clearTimeout(i),a(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function aP(){return window}function aR(){return void 0!==aP().WorkerGlobalScope&&"function"==typeof aP().importScripts}async function aN(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let aA="firebaseLocalStorageDb",aO="firebaseLocalStorage",aD="fbase_key";class aL{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function aM(e,t){return e.transaction([aO],t?"readwrite":"readonly").objectStore(aO)}function aF(){let e=indexedDB.open(aA,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(aO,{keyPath:aD})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(aO)?t(n):(n.close(),await new aL(indexedDB.deleteDatabase(aA)).toPromise(),t(await aF()))})})}async function aj(e,t,n){return new aL(aM(e,!0).put({[aD]:t,value:n})).toPromise()}async function aU(e,t){let n=aM(e,!1).get(t),i=await new aL(n).toPromise();return void 0===i?null:i.value}function aB(e,t){return new aL(aM(e,!0).delete(t)).toPromise()}class aW{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await aF()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return aR()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ak._getInstance(aR()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await aN(),!this.activeServiceWorker)return;this.sender=new ax(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await aF();return await aj(e,aC,"1"),await aB(e,aC),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>aj(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>aU(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>aB(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new aL(aM(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function aq(e,t){return s3(e,"POST","/v2/accounts/mfaSignIn:start",s6(e,t))}aW.type="LOCAL",oz("rcb"),new sX(3e4,6e4);let az="recaptcha";async function a$(e,t,n){if(!e._getRecaptchaConfig())try{await oJ(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){sK("enroll"===t.type,e,"internal-error");let r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===oV){sK(n?.type===az,e,"argument-error");let i=await aH(e,t,n);return aw(e,i)}return aw(e,t)},o=oY(e,r,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{sK("signin"===t.type,e,"internal-error");let r=i.multiFactorHint?.uid||i.multiFactorUid;sK(r,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:r,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===oV){sK(n?.type===az,e,"argument-error");let i=await aH(e,t,n);return aq(e,i)}return aq(e,t)},a=oY(e,s,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=async(e,t)=>{if(t.captchaResponse===oV){sK(n?.type===az,e,"argument-error");let i=await aH(e,t,n);return o8(e,i)}return o8(e,t)},s=oY(e,t,"sendVerificationCode",r,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function aH(e,t,n){sK(n.type===az,e,"argument-error");let i=await n.verify();sK("string"==typeof i,e,"argument-error");let r={...t};if("phoneEnrollmentInfo"in r){let e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if(!("phoneSignInInfo"in r))return Object.assign(r,{recaptchaToken:i}),r;{let e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}}class aV{constructor(e){this.providerId=aV.PROVIDER_ID,this.auth=ej(e)}verifyPhoneNumber(e,t){return a$(this.auth,e,ej(t))}static credential(e,t){return an._fromVerification(e,t)}static credentialFromResult(e){return aV.credentialFromTaggedObject(e)}static credentialFromError(e){return aV.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?an._fromTokenResponse(t,n):null}}aV.PROVIDER_ID="phone",aV.PHONE_SIGN_IN_METHOD="phone";class aK extends oZ{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return o5(e,this._buildIdpRequest())}_linkToIdToken(e,t){return o5(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return o5(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function aG(e){return a_(e.auth,new aK(e),e.bypassAuthState)}function aY(e){let{auth:t,user:n}=e;return sK(n,t,"internal-error"),ag(n,new aK(e),e.bypassAuthState)}async function aJ(e){let{auth:t,user:n}=e;return sK(n,t,"internal-error"),am(n,new aK(e),e.bypassAuthState)}class aX{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return aG;case"linkViaPopup":case"linkViaRedirect":return aJ;case"reauthViaPopup":case"reauthViaRedirect":return aY;default:sq(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||sG(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||sG(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let aQ=new sX(2e3,1e4);class aZ extends aX{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,aZ.currentPopupAction&&aZ.currentPopupAction.cancel(),aZ.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return sK(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||sG(t);let n=aS();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(sz(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(sz(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,aZ.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(sz(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,aQ.get())};e()}}aZ.currentPopupAction=null;let a0=new Map;class a1 extends aX{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=a0.get(this.auth._key());if(!e){try{let t=await a2(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}a0.set(this.auth._key(),e)}return this.bypassAuthState||a0.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function a2(e,t){var n;let i=oT("pendingRedirect",(n=t).config.apiKey,n.name),r=oC(e._redirectPersistence);if(!await r._isAvailable())return!1;let s=await r._get(i)==="true";return await r._remove(i),s}function a6(e,t){a0.set(e._key(),t)}async function a3(e,t,n=!1){if(tp(e.app))return Promise.reject(sH(e));let i=ej(e),r=t?oC(t):(sK(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver),s=new a1(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class a5{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return a8(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!a8(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(sz(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(a4(e))}saveEventToCache(e){this.cachedEventUids.add(a4(e)),this.lastProcessedEventTime=Date.now()}}function a4(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function a8({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function a7(e,t={}){return s3(e,"GET","/v1/projects",t)}let a9=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,le=/^https?/;async function lt(e){if(e.config.emulator)return;let{authorizedDomains:t}=await a7(e);for(let e of t)try{if(function(e){let t=sY(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!le.test(n))return!1;if(a9.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch{}sq(e,"unauthorized-domain")}let ln=new sX(3e4,6e4);function li(){let e=aP().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let lr=null,ls=new sX(5e3,15e3),lo={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},la=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function ll(e){let t,n,i,r,s,o=await (lr=lr||new Promise((t,n)=>{function i(){li(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{li(),n(sz(e,"network-request-failed"))},timeout:ln.get()})}if(aP().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(aP().gapi?.load)i();else{var r;let t=oz("iframefcb");return aP()[t]=()=>{gapi.load?i():n(sz(e,"network-request-failed"))},(r=`${oq.gapiScript}?onload=${t}`,oq.loadJS(r)).catch(e=>n(e))}}).catch(e=>{throw lr=null,e})),a=aP().gapi;return sK(a,e,"internal-error"),o.open({where:document.body,url:(sK((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?sQ(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:ty},(r=la.get(e.config.apiHost))&&(i.eid=r),(s=e._getFrameworks()).length&&(i.fw=s.join(",")),`${n}?${eP(i).slice(1)}`),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lo,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=sz(e,"network-request-failed"),s=aP().setTimeout(()=>{i(r)},ls.get());function o(){aP().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}let lh={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class lc{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let lu=encodeURIComponent("fac");async function ld(e,t,n,i,r,s){sK(e.config.authDomain,e,"auth-domain-config-required"),sK(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:ty,eventId:r};if(t instanceof as)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",eE(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=i;if(t instanceof ao){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${lu}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?sQ(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${eP(o).slice(1)}${l}`}let lp="webStorageSupport",lf=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=aE,this._completeRedirectFn=a3,this._overrideRedirectResult=a6}async _openPopup(e,t,n,i){var r,s;r=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",r||sG(s);let o=await ld(e,t,n,sY(),i);return function(e,t,n,i=500,r=600){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l={...lh,width:i.toString(),height:r.toString(),top:s,left:o},h=ec().toLowerCase();n&&(a=oP(h)?"_blank":n),oS(h)&&(t=t||"http://localhost",l.scrollbars="yes");let c=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=ec()){return oD(e)&&!!window.navigator?.standalone}(h)&&"_self"!==a){var u,d;let e,n;return u=t||"",d=a,(e=document.createElement("a")).href=u,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new lc(null)}let p=window.open(t||"",a,c);sK(p,e,"popup-blocked");try{p.focus()}catch(e){}return new lc(p)}(e,o,aS())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await ld(e,t,n,sY(),i),aP().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||sG(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await ll(e),n=new a5(e);return t.register("authEvent",t=>(sK(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(lp,{type:lp},n=>{let i=n?.[0]?.[lp];void 0!==i&&t(!!i),sq(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=lt(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oL()||ox()||oD()}};var lm="@firebase/auth",lg="1.11.1";class l_{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){sK(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let lv=ei("authIdTokenMaxAge")||300,ly=null;function lb(e=tC()){let t=th(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=th(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eS(n.getOptions(),t??{}))return e;sq(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:lf,persistence:[aW,aT,aE]}),i=ei("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(i,location.origin);if(location.origin===e.origin){let t,i=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>lv)return;let r=n?.token;ly!==r&&(ly=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});ej(n).beforeAuthStateChanged(i,()=>i(n.currentUser)),ej(n).onIdTokenChanged(e=>i(e),void 0,void 0)}}let r=et("auth");return r&&function(e,t,n){let i=ej(e);sK(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=oX(t),{host:s,port:o}=function(e){let t=oX(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:oQ(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:oQ(t)}}}(t),a=null===o?"":`:${o}`,l={url:`${r}//${s}${a}/`},h=Object.freeze({host:s,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){sK(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),sK(eS(l,i.config.emulator)&&eS(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,es(s)?(eo(`${r}//${s}${a}`),eh("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}oq={loadJS:e=>new Promise((t,n)=>{let i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{let t=sz("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},I="Browser",tl(new eU("auth",(e,{options:t})=>{let n,i,r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;sK(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h=new oB(r,s,o,{apiKey:a,authDomain:l,clientPlatform:I,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:oM(I)});return i=(Array.isArray(n=t?.persistence||[])?n:[n]).map(oC),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(i,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),tl(new eU("auth-internal",e=>new l_(ej(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tE(lm,lg,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(I)),tE(lm,lg,"esm2020"),e.s([],59134),e.i(59134);let lw={apiKey:$.default.env.NEXT_PUBLIC_FIREBASE_API_KEY||"",authDomain:$.default.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"",projectId:$.default.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"",storageBucket:$.default.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:$.default.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"",appId:$.default.env.NEXT_PUBLIC_FIREBASE_APP_ID||"",databaseURL:$.default.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL||""};function lC(){if(tI().length)return f=sF(p=tI()[0]),m=lb(p),{app:p,database:f,auth:m,isConfigured:!0};if(!(lw.apiKey&&lw.projectId))return console.warn("Firebase configuration is incomplete. Some features may not work."),console.warn("Please set NEXT_PUBLIC_FIREBASE_* environment variables."),{app:null,database:null,auth:null,isConfigured:!1};try{return p=tb(lw),f=sF(p),m=lb(p),console.log("Firebase initialized successfully"),{app:p,database:f,auth:m,isConfigured:!0}}catch(e){return console.error("Error initializing Firebase:",e),{app:null,database:null,auth:null,isConfigured:!1}}}function lI(){return f||lC().database}lC();var lT=e.i(1645);let lE=(0,S.createContext)(null);function lk(){let e=(0,S.useContext)(lE);if(!e)throw Error("useBoardContext must be used within BoardProvider");return e}function lS({children:e,userId:t,userName:n}){let[i,r]=(0,S.useState)(null),[s,o]=(0,S.useState)(null),[a,l]=(0,S.useState)(new Map),[h,c]=(0,S.useState)([]),[u,d]=(0,S.useState)(!1),[p,f]=(0,S.useState)(!1),[m,g]=(0,S.useState)(null),[_,v]=(0,S.useState)(!0),[y,b]=(0,S.useState)([]),[w,C]=(0,S.useState)([]);(0,S.useEffect)(()=>{if(!i)return;let e=lI();if(!(lw.apiKey&&lw.projectId)||!e){console.warn("Firebase not configured, using REST API fallback"),v(!1),T();return}v(!0),I(e)},[i]);let I=e=>{if(i){f(!0),g(null);try{let t=sx(e,`boards/${i}/canvasState`),n=sD(t,e=>{let t=e.val();t&&(o(t),d(!0)),f(!1)},e=>{console.error("Firebase canvas error:",e),g("Failed to connect to Firebase"),v(!1),T()}),r=sx(e,`boards/${i}/presence`),s=sD(r,e=>{let t=e.val();if(t){let e=new Map;Object.entries(t).forEach(([t,n])=>{e.set(t,n)}),l(e)}}),a=sx(e,`boards/${i}/notifications`),h=sD(a,e=>{let t=e.val();if(t){let e=Object.values(t);c(e.slice(-20))}});return()=>{n(),s(),h()}}catch(e){console.error("Error setting up Firebase listeners:",e),g("Failed to setup Firebase listeners"),v(!1),T()}}},T=async()=>{if(i)try{f(!0),g(null);let e=(0,lT.getBackendUrl)(),t=await (0,lT.fetchWithErrorHandling)(`${e}/api/boards/${i}/snapshot`,{method:"GET"});if(t.ok){let e=await t.json();o(e.canvasState),d(!0)}else g("Failed to fetch board snapshot")}catch(e){g(e.message||"Failed to fetch board")}finally{f(!1)}},E=(0,S.useCallback)(e=>{if(!i)return;let t={...e,id:`stroke_${Date.now()}_${Math.random()}`,timestamp:Date.now()};if(_){let e=lI();e&&sR(sx(e,`boards/${i}/canvasState/actions`),t)}else o(e=>e?{...e,actions:[...e.actions,t],lastUpdated:new Date().toISOString()}:null);b(e=>[...e,t]),C([])},[i,_]),x=(0,S.useCallback)(e=>{if(!i)return;let t={...e,id:`shape_${Date.now()}_${Math.random()}`,timestamp:Date.now()};if(_){let e=lI();e&&sR(sx(e,`boards/${i}/canvasState/actions`),t)}else o(e=>e?{...e,actions:[...e.actions,t],lastUpdated:new Date().toISOString()}:null);b(e=>[...e,t]),C([])},[i,_]),P=(0,S.useCallback)(()=>{if(i){if(_){let e=lI();e&&sN(sx(e,`boards/${i}/canvasState/actions`),[])}else o(e=>e?{...e,actions:[],lastUpdated:new Date().toISOString()}:null);b([]),C([])}},[i,_]),R=(0,S.useCallback)(e=>{if(!i)return;let t={...e,id:`notif_${Date.now()}`,timestamp:Date.now()};if(_){let e=lI();e&&sN(sx(e,`boards/${i}/notifications/${t.id}`),t)}else c(e=>[...e,t].slice(-20))},[i,_]),N=(0,S.useCallback)((e,r)=>{if(!i)return;let s={userId:t,name:n,status:e,cursor:r,lastHeartbeat:new Date().toISOString()};if(_){let e=lI();e&&sN(sx(e,`boards/${i}/presence/${t}`),s)}else{let t=(0,lT.getBackendUrl)();(0,lT.fetchWithErrorHandling)(`${t}/api/boards/${i}/presence`,{method:"POST",body:JSON.stringify({status:e,cursor:r})}).catch(e=>console.error("Failed to update presence:",e))}},[i,t,n,_]),A=(0,S.useCallback)(()=>{if(0===y.length)return;let e=y[y.length-1];b(e=>e.slice(0,-1)),C(t=>[...t,e]),o(t=>t?{...t,actions:t.actions.filter(t=>t.id!==e.id),lastUpdated:new Date().toISOString()}:null)},[y]),O=(0,S.useCallback)(()=>{if(0===w.length)return;let e=w[w.length-1];C(e=>e.slice(0,-1)),b(t=>[...t,e]),o(t=>t?{...t,actions:[...t.actions,e],lastUpdated:new Date().toISOString()}:null)},[w]);return(0,k.jsx)(lE.Provider,{value:{boardId:i,canvasState:s,presence:a,notifications:h,isConnected:u,isLoading:p,error:m,actions:{setBoardId:r,addStroke:E,addShape:x,clearBoard:P,broadcastNotification:R,updatePresence:N,undo:A,redo:O}},children:e})}function lx({width:e,height:t,currentTool:n,currentColor:i,strokeWidth:r}){let s=(0,S.useRef)(null),[o,a]=(0,S.useState)(!1),[l,h]=(0,S.useState)(null),[c,u]=(0,S.useState)([]),{canvasState:d,actions:p}=lk();(0,S.useEffect)(()=>{let n=s.current;if(!n)return;let i=n.getContext("2d");i&&(i.clearRect(0,0,e,t),d?.actions.forEach(e=>{f(i,e)}))},[d,e,t]);let f=(e,t)=>{"stroke"===t.type?m(e,t):g(e,t)},m=(e,t)=>{if(!(t.points.length<4)){e.strokeStyle=t.color,e.lineWidth=t.width,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(t.points[0],t.points[1]);for(let n=2;n<t.points.length;n+=2)e.lineTo(t.points[n],t.points[n+1]);e.stroke()}},g=(e,t)=>{switch(e.strokeStyle=t.color,e.lineWidth=2,e.beginPath(),t.type){case"rectangle":t.width&&t.height&&e.rect(t.x,t.y,t.width,t.height);break;case"circle":t.radius&&e.arc(t.x,t.y,t.radius,0,2*Math.PI);break;case"line":void 0!==t.width&&void 0!==t.height&&(e.moveTo(t.x,t.y),e.lineTo(t.x+t.width,t.y+t.height))}e.stroke()},_=e=>{let t=s.current;if(!t)return{x:0,y:0};let n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}};return(0,k.jsx)(P.Box,{sx:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",bgcolor:"background.paper",overflow:"hidden"},children:(0,k.jsx)("canvas",{ref:s,width:e,height:t,onMouseDown:e=>{let t=_(e);a(!0),h(t),("pen"===n||"eraser"===n)&&u([t.x,t.y]),p.updatePresence("active",t)},onMouseMove:a=>{let h=_(a);if(o&&p.updatePresence("active",h),!o)return;let m=s.current;if(!m)return;let g=m.getContext("2d");if(g){if("pen"===n||"eraser"===n){if(u(e=>[...e,h.x,h.y]),g.strokeStyle="eraser"===n?"#FFFFFF":i,g.lineWidth=r,g.lineCap="round",g.lineJoin="round",c.length>=2){let e=c[c.length-2],t=c[c.length-1];g.beginPath(),g.moveTo(e,t),g.lineTo(h.x,h.y),g.stroke()}}else if(l){switch(g.clearRect(0,0,e,t),d?.actions.forEach(e=>{f(g,e)}),g.strokeStyle=i,g.lineWidth=2,g.beginPath(),n){case"rectangle":let r=h.x-l.x,s=h.y-l.y;g.rect(l.x,l.y,r,s);break;case"circle":let o=Math.sqrt(Math.pow(h.x-l.x,2)+Math.pow(h.y-l.y,2));g.arc(l.x,l.y,o,0,2*Math.PI);break;case"line":g.moveTo(l.x,l.y),g.lineTo(h.x,h.y)}g.stroke()}}},onMouseUp:e=>{if(!o)return;let t=_(e);if(a(!1),"pen"===n||"eraser"===n)c.length>=4&&p.addStroke({type:"stroke",points:c,color:"eraser"===n?"#FFFFFF":i,width:r}),u([]);else if(l){let e=t.x-l.x,r=t.y-l.y;switch(n){case"rectangle":p.addShape({type:"rectangle",x:l.x,y:l.y,width:e,height:r,color:i});break;case"circle":let s=Math.sqrt(e**2+r**2);p.addShape({type:"circle",x:l.x,y:l.y,radius:s,color:i});break;case"line":p.addShape({type:"line",x:l.x,y:l.y,width:e,height:r,color:i})}}h(null)},onMouseLeave:()=>{o&&(a(!1),u([]),h(null)),p.updatePresence("idle")},style:{border:"1px solid #ccc",cursor:"pen"===n?"crosshair":"default",backgroundColor:"#FFFFFF"}})})}var lP=e.i(79741),lR=e.i(17803),lN=e.i(60997),lA=e.i(75907),lO=e.i(56206),lD=e.i(961),lL=e.i(77366),lM=e.i(64107),lF=e.i(96851),lj=e.i(95724),lU=e.i(13149),lB=e.i(46739);function lW(e){return(0,lB.default)("MuiButtonGroup",e)}let lq=(0,lU.default)("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","vertical","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]);var lz=e.i(65366),l$=e.i(41896);let lH=["children","className","color","component","disabled","disableElevation","disableFocusRipple","disableRipple","fullWidth","orientation","size","variant"],lV=(0,lF.default)("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${lq.grouped}`]:t.grouped},{[`& .${lq.grouped}`]:t[`grouped${(0,lM.default)(n.orientation)}`]},{[`& .${lq.grouped}`]:t[`grouped${(0,lM.default)(n.variant)}`]},{[`& .${lq.grouped}`]:t[`grouped${(0,lM.default)(n.variant)}${(0,lM.default)(n.orientation)}`]},{[`& .${lq.grouped}`]:t[`grouped${(0,lM.default)(n.variant)}${(0,lM.default)(n.color)}`]},{[`& .${lq.firstButton}`]:t.firstButton},{[`& .${lq.lastButton}`]:t.lastButton},{[`& .${lq.middleButton}`]:t.middleButton},t.root,t[n.variant],!0===n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth,"vertical"===n.orientation&&t.vertical]}})(({theme:e,ownerState:t})=>(0,lA.default)({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius},"contained"===t.variant&&{boxShadow:(e.vars||e).shadows[2]},t.disableElevation&&{boxShadow:"none"},t.fullWidth&&{width:"100%"},"vertical"===t.orientation&&{flexDirection:"column"},{[`& .${lq.grouped}`]:(0,lA.default)({minWidth:40,"&:hover":(0,lA.default)({},"contained"===t.variant&&{boxShadow:"none"})},"contained"===t.variant&&{boxShadow:"none"}),[`& .${lq.firstButton},& .${lq.middleButton}`]:(0,lA.default)({},"horizontal"===t.orientation&&{borderTopRightRadius:0,borderBottomRightRadius:0},"vertical"===t.orientation&&{borderBottomRightRadius:0,borderBottomLeftRadius:0},"text"===t.variant&&"horizontal"===t.orientation&&{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${"light"===e.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${lq.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},"text"===t.variant&&"vertical"===t.orientation&&{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${"light"===e.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${lq.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},"text"===t.variant&&"inherit"!==t.color&&{borderColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.5)`:(0,lL.alpha)(e.palette[t.color].main,.5)},"outlined"===t.variant&&"horizontal"===t.orientation&&{borderRightColor:"transparent"},"outlined"===t.variant&&"vertical"===t.orientation&&{borderBottomColor:"transparent"},"contained"===t.variant&&"horizontal"===t.orientation&&{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${lq.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},"contained"===t.variant&&"vertical"===t.orientation&&{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${lq.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},"contained"===t.variant&&"inherit"!==t.color&&{borderColor:(e.vars||e).palette[t.color].dark},{"&:hover":(0,lA.default)({},"outlined"===t.variant&&"horizontal"===t.orientation&&{borderRightColor:"currentColor"},"outlined"===t.variant&&"vertical"===t.orientation&&{borderBottomColor:"currentColor"})}),[`& .${lq.lastButton},& .${lq.middleButton}`]:(0,lA.default)({},"horizontal"===t.orientation&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},"vertical"===t.orientation&&{borderTopRightRadius:0,borderTopLeftRadius:0},"outlined"===t.variant&&"horizontal"===t.orientation&&{marginLeft:-1},"outlined"===t.variant&&"vertical"===t.orientation&&{marginTop:-1})})),lK=S.forwardRef(function(e,t){let n=(0,lj.useDefaultProps)({props:e,name:"MuiButtonGroup"}),{children:i,className:r,color:s="primary",component:o="div",disabled:a=!1,disableElevation:l=!1,disableFocusRipple:h=!1,disableRipple:c=!1,fullWidth:u=!1,orientation:d="horizontal",size:p="medium",variant:f="outlined"}=n,m=(0,lN.default)(n,lH),g=(0,lA.default)({},n,{color:s,component:o,disabled:a,disableElevation:l,disableFocusRipple:h,disableRipple:c,fullWidth:u,orientation:d,size:p,variant:f}),_=(e=>{let{classes:t,color:n,disabled:i,disableElevation:r,fullWidth:s,orientation:o,variant:a}=e,l={root:["root",a,"vertical"===o&&"vertical",s&&"fullWidth",r&&"disableElevation"],grouped:["grouped",`grouped${(0,lM.default)(o)}`,`grouped${(0,lM.default)(a)}`,`grouped${(0,lM.default)(a)}${(0,lM.default)(o)}`,`grouped${(0,lM.default)(a)}${(0,lM.default)(n)}`,i&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return(0,lD.default)(l,lW,t)})(g),v=S.useMemo(()=>({className:_.grouped,color:s,disabled:a,disableElevation:l,disableFocusRipple:h,disableRipple:c,fullWidth:u,size:p,variant:f}),[s,a,l,h,c,u,p,f,_.grouped]),y=S.Children.toArray(i).filter(e=>S.isValidElement(e)),b=y.length;return(0,k.jsx)(lV,(0,lA.default)({as:o,role:"group",className:(0,lO.default)(_.root,r),ref:t,ownerState:g},m,{children:(0,k.jsx)(lz.default.Provider,{value:v,children:y.map((e,t)=>{let n,i;return(0,k.jsx)(l$.default.Provider,{value:(n=0===t,i=t===b-1,n&&i?"":n?_.firstButton:i?_.lastButton:_.middleButton),children:e},t)})})}))});var lG=e.i(76951),lY=e.i(64966),lJ=e.i(69213),lX=e.i(97364),lQ=e.i(79795),lZ=e.i(56254),l0=e.i(61614),l1=e.i(91357),l2=e.i(94020),l2=l2;let l6={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};var l3=e.i(98548),l3=l3,l5=e.i(62317);function l4(e,t){return e-t}function l8(e,t){var n;let{index:i}=null!=(n=e.reduce((e,n,i)=>{let r=Math.abs(t-n);return null===e||r<e.distance||r===e.distance?{distance:r,index:i}:e},null))?n:{};return i}function l7(e,t){if(void 0!==t.current&&e.changedTouches){for(let n=0;n<e.changedTouches.length;n+=1){let i=e.changedTouches[n];if(i.identifier===t.current)return{x:i.clientX,y:i.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function l9({values:e,newValue:t,index:n}){let i=e.slice();return i[n]=t,i.sort(l4)}function he({sliderRef:e,activeIndex:t,setActive:n}){var i,r,s;let o=(0,lX.unstable_ownerDocument)(e.current);null!=(i=e.current)&&i.contains(o.activeElement)&&Number(null==o||null==(r=o.activeElement)?void 0:r.getAttribute("data-index"))===t||null==(s=e.current)||s.querySelector(`[type="range"][data-index="${t}"]`).focus(),n&&n(t)}function ht(e,t){return"number"==typeof e&&"number"==typeof t?e===t:"object"==typeof e&&"object"==typeof t&&function(e,t,n=(e,t)=>e===t){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}(e,t)}let hn={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},hi=e=>e;function hr(){return void 0===g&&(g="undefined"==typeof CSS||"function"!=typeof CSS.supports||CSS.supports("touch-action","none")),g}var hs=e.i(80445),ho=e.i(35236);function ha(e){return(0,lB.default)("MuiSlider",e)}let hl=(0,lU.default)("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),hh=["aria-label","aria-valuetext","aria-labelledby","component","components","componentsProps","color","classes","className","disableSwap","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","orientation","shiftStep","size","step","scale","slotProps","slots","tabIndex","track","value","valueLabelDisplay","valueLabelFormat"];function hc(e){return e}let hu=(0,hs.styled)("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`color${(0,lM.default)(n.color)}`],"medium"!==n.size&&t[`size${(0,lM.default)(n.size)}`],n.marked&&t.marked,"vertical"===n.orientation&&t.vertical,"inverted"===n.track&&t.trackInverted,!1===n.track&&t.trackFalse]}})(({theme:e})=>{var t;return{borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${hl.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${hl.dragging}`]:{[`& .${hl.thumb}, & .${hl.track}`]:{transition:"none"}},variants:[...Object.keys((null!=(t=e.vars)?t:e).palette).filter(t=>{var n;return(null!=(n=e.vars)?n:e).palette[t].main}).map(t=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}}),hd=(0,hs.styled)("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),hp=(0,hs.styled)("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>{var t;return{display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.keys((null!=(t=e.vars)?t:e).palette).filter(t=>{var n;return(null!=(n=e.vars)?n:e).palette[t].main}).map(t=>({props:{color:t,track:"inverted"},style:(0,lA.default)({},e.vars?{backgroundColor:e.vars.palette.Slider[`${t}Track`],borderColor:e.vars.palette.Slider[`${t}Track`]}:(0,lA.default)({backgroundColor:(0,lL.lighten)(e.palette[t].main,.62),borderColor:(0,lL.lighten)(e.palette[t].main,.62)},e.applyStyles("dark",{backgroundColor:(0,lL.darken)(e.palette[t].main,.5)}),e.applyStyles("dark",{borderColor:(0,lL.darken)(e.palette[t].main,.5)})))}))]}}),hf=(0,hs.styled)("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.thumb,t[`thumbColor${(0,lM.default)(n.color)}`],"medium"!==n.size&&t[`thumbSize${(0,lM.default)(n.size)}`]]}})(({theme:e})=>{var t;return{position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${hl.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.keys((null!=(t=e.vars)?t:e).palette).filter(t=>{var n;return(null!=(n=e.vars)?n:e).palette[t].main}).map(t=>({props:{color:t},style:{[`&:hover, &.${hl.focusVisible}`]:(0,lA.default)({},e.vars?{boxShadow:`0px 0px 0px 8px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 8px ${(0,lL.alpha)(e.palette[t].main,.16)}`},{"@media (hover: none)":{boxShadow:"none"}}),[`&.${hl.active}`]:(0,lA.default)({},e.vars?{boxShadow:`0px 0px 0px 14px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 14px ${(0,lL.alpha)(e.palette[t].main,.16)}`})}}))]}}),hm=(0,hs.styled)(function(e){let{children:t,className:n,value:i}=e,r=(e=>{let{open:t}=e;return{offset:(0,lO.default)(t&&hl.valueLabelOpen),circle:hl.valueLabelCircle,label:hl.valueLabelLabel}})(e);return t?S.cloneElement(t,{className:(0,lO.default)(t.props.className)},(0,k.jsxs)(S.Fragment,{children:[t.props.children,(0,k.jsx)("span",{className:(0,lO.default)(r.offset,n),"aria-hidden":!0,children:(0,k.jsx)("span",{className:r.circle,children:(0,k.jsx)("span",{className:r.label,children:i})})})]})):null},{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(({theme:e})=>(0,lA.default)({zIndex:1,whiteSpace:"nowrap"},e.typography.body2,{fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${hl.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${hl.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]})),hg=(0,hs.styled)("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>(0,ho.default)(e)&&"markActive"!==e,overridesResolver:(e,t)=>{let{markActive:n}=e;return[t.mark,n&&t.markActive]}})(({theme:e})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}}]})),h_=(0,hs.styled)("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>(0,ho.default)(e)&&"markLabelActive"!==e,overridesResolver:(e,t)=>t.markLabel})(({theme:e})=>(0,lA.default)({},e.typography.body2,{color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(e.vars||e).palette.text.primary}}]})),hv=({children:e})=>e,hy=S.forwardRef(function(e,t){var n,i,r,s,o,a,l,h,c,u,d,p,f,m,g,_,v,y,b,w,C,I,T,E;let x=(0,lj.useDefaultProps)({props:e,name:"MuiSlider"}),P=(0,lG.useRtl)(),{"aria-label":R,"aria-valuetext":N,"aria-labelledby":A,component:O="span",components:D={},componentsProps:L={},color:M="primary",classes:F,className:j,disableSwap:U=!1,disabled:B=!1,getAriaLabel:W,getAriaValueText:q,marks:z=!1,max:$=100,min:H=0,orientation:V="horizontal",shiftStep:K=10,size:G="medium",step:Y=1,scale:J=hc,slotProps:X,slots:Q,track:Z="normal",valueLabelDisplay:ee="off",valueLabelFormat:et=hc}=x,en=(0,lN.default)(x,hh),ei=(0,lA.default)({},x,{isRtl:P,max:$,min:H,classes:F,disabled:B,disableSwap:U,orientation:V,marks:z,color:M,size:G,step:Y,shiftStep:K,scale:J,track:Z,valueLabelDisplay:ee,valueLabelFormat:et}),{axisProps:er,getRootProps:es,getHiddenInputProps:eo,getThumbProps:ea,open:el,active:eh,axis:ec,focusedThumbIndex:eu,range:ed,dragging:ep,marks:ef,values:em,trackOffset:eg,trackLeap:e_,getThumbStyle:ev}=function(e){let{"aria-labelledby":t,defaultValue:n,disabled:i=!1,disableSwap:r=!1,isRtl:s=!1,marks:o=!1,max:a=100,min:l=0,name:h,onChange:c,onChangeCommitted:u,orientation:d="horizontal",rootRef:p,scale:f=hi,step:m=1,shiftStep:g=10,tabIndex:_,value:v}=e,y=S.useRef(void 0),[b,w]=S.useState(-1),[C,I]=S.useState(-1),[T,E]=S.useState(!1),k=S.useRef(0),[x,P]=(0,lQ.unstable_useControlled)({controlled:v,default:null!=n?n:l,name:"Slider"}),R=c&&((e,t,n)=>{let i=e.nativeEvent||e,r=new i.constructor(i.type,i);Object.defineProperty(r,"target",{writable:!0,value:{value:t,name:h}}),c(r,t,n)}),N=Array.isArray(x),A=N?x.slice().sort(l4):[x];A=A.map(e=>null==e?l:(0,l3.default)(e,l,a));let O=!0===o&&null!==m?[...Array(Math.floor((a-l)/m)+1)].map((e,t)=>({value:l+m*t})):o||[],D=O.map(e=>e.value),{isFocusVisibleRef:L,onBlur:M,onFocus:F,ref:j}=(0,l2.default)(),[U,B]=S.useState(-1),W=S.useRef(null),q=(0,l1.unstable_useForkRef)(j,W),z=(0,l1.unstable_useForkRef)(p,q),$=(e,t)=>{let n=Number(e.currentTarget.getAttribute("data-index")),i=A[n],s=D.indexOf(i),o=t;if(O&&null==m){let e=D[D.length-1];o=o>e?e:o<D[0]?D[0]:o<i?D[s-1]:D[s+1]}if(o=(0,l3.default)(o,l,a),N){r&&(o=(0,l3.default)(o,A[n-1]||-1/0,A[n+1]||1/0));let e=o;o=l9({values:A,newValue:o,index:n});let t=n;r||(t=o.indexOf(e)),he({sliderRef:W,activeIndex:t})}P(o),B(n),R&&!ht(o,x)&&R(e,o,n),u&&u(e,o)};(0,lZ.unstable_useEnhancedEffect)(()=>{if(i&&W.current.contains(document.activeElement)){var e;null==(e=document.activeElement)||e.blur()}},[i]),i&&-1!==b&&w(-1),i&&-1!==U&&B(-1);let H=S.useRef(void 0),V=d;s&&"horizontal"===d&&(V+="-reverse");let K=({finger:e,move:t=!1})=>{let n,i,{current:s}=W,{width:o,height:h,bottom:c,left:u}=s.getBoundingClientRect();if(n=0===V.indexOf("vertical")?(c-e.y)/h:(e.x-u)/o,-1!==V.indexOf("-reverse")&&(n=1-n),i=(a-l)*n+l,m)i=Number((Math.round((i-l)/m)*m+l).toFixed(function(e){if(1>Math.abs(e)){let t=e.toExponential().split("e-"),n=t[0].split(".")[1];return(n?n.length:0)+parseInt(t[1],10)}let t=e.toString().split(".")[1];return t?t.length:0}(m)));else{let e=l8(D,i);i=D[e]}i=(0,l3.default)(i,l,a);let d=0;if(N){d=t?H.current:l8(A,i),r&&(i=(0,l3.default)(i,A[d-1]||-1/0,A[d+1]||1/0));let e=i;i=l9({values:A,newValue:i,index:d}),r&&t||(H.current=d=i.indexOf(e))}return{newValue:i,activeIndex:d}},G=(0,l0.unstable_useEventCallback)(e=>{let t=l7(e,y);if(!t)return;if(k.current+=1,"mousemove"===e.type&&0===e.buttons)return void Y(e);let{newValue:n,activeIndex:i}=K({finger:t,move:!0});he({sliderRef:W,activeIndex:i,setActive:w}),P(n),!T&&k.current>2&&E(!0),R&&!ht(n,x)&&R(e,n,i)}),Y=(0,l0.unstable_useEventCallback)(e=>{let t=l7(e,y);if(E(!1),!t)return;let{newValue:n}=K({finger:t,move:!0});w(-1),"touchend"===e.type&&I(-1),u&&u(e,n),y.current=void 0,X()}),J=(0,l0.unstable_useEventCallback)(e=>{if(i)return;hr()||e.preventDefault();let t=e.changedTouches[0];null!=t&&(y.current=t.identifier);let n=l7(e,y);if(!1!==n){let{newValue:t,activeIndex:i}=K({finger:n});he({sliderRef:W,activeIndex:i,setActive:w}),P(t),R&&!ht(t,x)&&R(e,t,i)}k.current=0;let r=(0,lX.unstable_ownerDocument)(W.current);r.addEventListener("touchmove",G,{passive:!0}),r.addEventListener("touchend",Y,{passive:!0})}),X=S.useCallback(()=>{let e=(0,lX.unstable_ownerDocument)(W.current);e.removeEventListener("mousemove",G),e.removeEventListener("mouseup",Y),e.removeEventListener("touchmove",G),e.removeEventListener("touchend",Y)},[Y,G]);S.useEffect(()=>{let{current:e}=W;return e.addEventListener("touchstart",J,{passive:hr()}),()=>{e.removeEventListener("touchstart",J),X()}},[X,J]),S.useEffect(()=>{i&&X()},[i,X]);let Q=((N?A[0]:l)-l)*100/(a-l),Z=(A[A.length-1]-l)*100/(a-l)-Q;return{active:b,axis:V,axisProps:hn,dragging:T,focusedThumbIndex:U,getHiddenInputProps:(n={})=>{var r;let o,c,u,p,v=(0,l5.default)(n),y={onChange:(o=v||{},e=>{var t;null==(t=o.onChange)||t.call(o,e),$(e,e.target.valueAsNumber)}),onFocus:(c=v||{},e=>{var t;let n=Number(e.currentTarget.getAttribute("data-index"));F(e),!0===L.current&&B(n),I(n),null==c||null==(t=c.onFocus)||t.call(c,e)}),onBlur:(u=v||{},e=>{var t;M(e),!1===L.current&&B(-1),I(-1),null==u||null==(t=u.onBlur)||t.call(u,e)}),onKeyDown:(p=v||{},e=>{var t;if(null!==m){let t=A[Number(e.currentTarget.getAttribute("data-index"))],n=null;("ArrowLeft"===e.key||"ArrowDown"===e.key)&&e.shiftKey||"PageDown"===e.key?n=Math.max(t-g,l):(("ArrowRight"===e.key||"ArrowUp"===e.key)&&e.shiftKey||"PageUp"===e.key)&&(n=Math.min(t+g,a)),null!==n&&($(e,n),e.preventDefault())}null==p||null==(t=p.onKeyDown)||t.call(p,e)})},b=(0,lA.default)({},v,y);return(0,lA.default)({tabIndex:_,"aria-labelledby":t,"aria-orientation":d,"aria-valuemax":f(a),"aria-valuemin":f(l),name:h,type:"range",min:e.min,max:e.max,step:null===e.step&&e.marks?"any":null!=(r=e.step)?r:void 0,disabled:i},n,b,{style:(0,lA.default)({},l6,{direction:s?"rtl":"ltr",width:"100%",height:"100%"})})},getRootProps:(e={})=>{let t,n=(0,l5.default)(e),r={onMouseDown:(t=n||{},e=>{var n;if(null==(n=t.onMouseDown)||n.call(t,e),i||e.defaultPrevented||0!==e.button)return;e.preventDefault();let r=l7(e,y);if(!1!==r){let{newValue:t,activeIndex:n}=K({finger:r});he({sliderRef:W,activeIndex:n,setActive:w}),P(t),R&&!ht(t,x)&&R(e,t,n)}k.current=0;let s=(0,lX.unstable_ownerDocument)(W.current);s.addEventListener("mousemove",G,{passive:!0}),s.addEventListener("mouseup",Y)})},s=(0,lA.default)({},n,r);return(0,lA.default)({},e,{ref:z},s)},getThumbProps:(e={})=>{let t,n,i=(0,l5.default)(e),r={onMouseOver:(t=i||{},e=>{var n;null==(n=t.onMouseOver)||n.call(t,e),I(Number(e.currentTarget.getAttribute("data-index")))}),onMouseLeave:(n=i||{},e=>{var t;null==(t=n.onMouseLeave)||t.call(n,e),I(-1)})};return(0,lA.default)({},e,i,r)},marks:O,open:C,range:N,rootRef:z,trackLeap:Z,trackOffset:Q,values:A,getThumbStyle:e=>({pointerEvents:-1!==b&&b!==e?"none":void 0})}}((0,lA.default)({},ei,{rootRef:t}));ei.marked=ef.length>0&&ef.some(e=>e.label),ei.dragging=ep,ei.focusedThumbIndex=eu;let ey=(e=>{let{disabled:t,dragging:n,marked:i,orientation:r,track:s,classes:o,color:a,size:l}=e,h={root:["root",t&&"disabled",n&&"dragging",i&&"marked","vertical"===r&&"vertical","inverted"===s&&"trackInverted",!1===s&&"trackFalse",a&&`color${(0,lM.default)(a)}`,l&&`size${(0,lM.default)(l)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",l&&`thumbSize${(0,lM.default)(l)}`,a&&`thumbColor${(0,lM.default)(a)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return(0,lD.default)(h,ha,o)})(ei),eb=null!=(n=null!=(i=null==Q?void 0:Q.root)?i:D.Root)?n:hu,ew=null!=(r=null!=(s=null==Q?void 0:Q.rail)?s:D.Rail)?r:hd,eC=null!=(o=null!=(a=null==Q?void 0:Q.track)?a:D.Track)?o:hp,eI=null!=(l=null!=(h=null==Q?void 0:Q.thumb)?h:D.Thumb)?l:hf,eT=null!=(c=null!=(u=null==Q?void 0:Q.valueLabel)?u:D.ValueLabel)?c:hm,eE=null!=(d=null!=(p=null==Q?void 0:Q.mark)?p:D.Mark)?d:hg,ek=null!=(f=null!=(m=null==Q?void 0:Q.markLabel)?m:D.MarkLabel)?f:h_,eS=null!=(g=null!=(_=null==Q?void 0:Q.input)?_:D.Input)?g:"input",ex=null!=(v=null==X?void 0:X.root)?v:L.root,eP=null!=(y=null==X?void 0:X.rail)?y:L.rail,eR=null!=(b=null==X?void 0:X.track)?b:L.track,eN=null!=(w=null==X?void 0:X.thumb)?w:L.thumb,eA=null!=(C=null==X?void 0:X.valueLabel)?C:L.valueLabel,eO=null!=(I=null==X?void 0:X.mark)?I:L.mark,eD=null!=(T=null==X?void 0:X.markLabel)?T:L.markLabel,eL=null!=(E=null==X?void 0:X.input)?E:L.input,eM=(0,lY.default)({elementType:eb,getSlotProps:es,externalSlotProps:ex,externalForwardedProps:en,additionalProps:(0,lA.default)({},(!eb||!(0,lJ.default)(eb))&&{as:O}),ownerState:(0,lA.default)({},ei,null==ex?void 0:ex.ownerState),className:[ey.root,j]}),eF=(0,lY.default)({elementType:ew,externalSlotProps:eP,ownerState:ei,className:ey.rail}),ej=(0,lY.default)({elementType:eC,externalSlotProps:eR,additionalProps:{style:(0,lA.default)({},er[ec].offset(eg),er[ec].leap(e_))},ownerState:(0,lA.default)({},ei,null==eR?void 0:eR.ownerState),className:ey.track}),eU=(0,lY.default)({elementType:eI,getSlotProps:ea,externalSlotProps:eN,ownerState:(0,lA.default)({},ei,null==eN?void 0:eN.ownerState),className:ey.thumb}),eB=(0,lY.default)({elementType:eT,externalSlotProps:eA,ownerState:(0,lA.default)({},ei,null==eA?void 0:eA.ownerState),className:ey.valueLabel}),eW=(0,lY.default)({elementType:eE,externalSlotProps:eO,ownerState:ei,className:ey.mark}),eq=(0,lY.default)({elementType:ek,externalSlotProps:eD,ownerState:ei,className:ey.markLabel}),ez=(0,lY.default)({elementType:eS,getSlotProps:eo,externalSlotProps:eL,ownerState:ei});return(0,k.jsxs)(eb,(0,lA.default)({},eM,{children:[(0,k.jsx)(ew,(0,lA.default)({},eF)),(0,k.jsx)(eC,(0,lA.default)({},ej)),ef.filter(e=>e.value>=H&&e.value<=$).map((e,t)=>{let n,i=(e.value-H)*100/($-H),r=er[ec].offset(i);return n=!1===Z?-1!==em.indexOf(e.value):"normal"===Z&&(ed?e.value>=em[0]&&e.value<=em[em.length-1]:e.value<=em[0])||"inverted"===Z&&(ed?e.value<=em[0]||e.value>=em[em.length-1]:e.value>=em[0]),(0,k.jsxs)(S.Fragment,{children:[(0,k.jsx)(eE,(0,lA.default)({"data-index":t},eW,!(0,lJ.default)(eE)&&{markActive:n},{style:(0,lA.default)({},r,eW.style),className:(0,lO.default)(eW.className,n&&ey.markActive)})),null!=e.label?(0,k.jsx)(ek,(0,lA.default)({"aria-hidden":!0,"data-index":t},eq,!(0,lJ.default)(ek)&&{markLabelActive:n},{style:(0,lA.default)({},r,eq.style),className:(0,lO.default)(ey.markLabel,eq.className,n&&ey.markLabelActive),children:e.label})):null]},t)}),em.map((e,t)=>{let n=(e-H)*100/($-H),i=er[ec].offset(n),r="off"===ee?hv:eT;return(0,k.jsx)(r,(0,lA.default)({},!(0,lJ.default)(r)&&{valueLabelFormat:et,valueLabelDisplay:ee,value:"function"==typeof et?et(J(e),t):et,index:t,open:el===t||eh===t||"on"===ee,disabled:B},eB,{children:(0,k.jsx)(eI,(0,lA.default)({"data-index":t},eU,{className:(0,lO.default)(ey.thumb,eU.className,eh===t&&ey.active,eu===t&&ey.focusVisible),style:(0,lA.default)({},i,ev(t),eU.style),children:(0,k.jsx)(eS,(0,lA.default)({"data-index":t,"aria-label":W?W(t):R,"aria-valuenow":J(e),"aria-labelledby":A,"aria-valuetext":q?q(J(e),t):N,value:em[t]},ez))}))}),t)})]}))});var hb=e.i(36279),hw=e.i(75297),hC=e.i(11730),hI=e.i(28519),hT=e.i(78319),hE=e.i(61661),hk=e.i(33008);let hS=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFFFFF"];function hx({currentTool:e,onToolChange:t,currentColor:n,onColorChange:i,strokeWidth:r,onStrokeWidthChange:s}){let{actions:o}=lk();return(0,k.jsxs)(D.Paper,{elevation:3,sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:200,maxWidth:250},children:[(0,k.jsxs)(P.Box,{children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:"Tools"}),(0,k.jsxs)(lK,{orientation:"vertical",fullWidth:!0,children:[(0,k.jsx)(lP.Tooltip,{title:"Pen",placement:"right",children:(0,k.jsx)(O.Button,{variant:"pen"===e?"contained":"outlined",onClick:()=>t("pen"),startIcon:(0,k.jsx)(hb.default,{}),children:"Pen"})}),(0,k.jsx)(lP.Tooltip,{title:"Rectangle",placement:"right",children:(0,k.jsx)(O.Button,{variant:"rectangle"===e?"contained":"outlined",onClick:()=>t("rectangle"),startIcon:(0,k.jsx)(hw.default,{}),children:"Rectangle"})}),(0,k.jsx)(lP.Tooltip,{title:"Circle",placement:"right",children:(0,k.jsx)(O.Button,{variant:"circle"===e?"contained":"outlined",onClick:()=>t("circle"),startIcon:(0,k.jsx)(hC.default,{}),children:"Circle"})}),(0,k.jsx)(lP.Tooltip,{title:"Line",placement:"right",children:(0,k.jsx)(O.Button,{variant:"line"===e?"contained":"outlined",onClick:()=>t("line"),startIcon:(0,k.jsx)(hI.default,{}),children:"Line"})})]})]}),(0,k.jsx)(lR.Divider,{}),(0,k.jsxs)(P.Box,{children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:"Color"}),(0,k.jsx)(P.Box,{sx:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:.5},children:hS.map(e=>(0,k.jsx)(lP.Tooltip,{title:e,children:(0,k.jsx)(F.IconButton,{onClick:()=>i(e),sx:{width:36,height:36,bgcolor:e,border:n===e?"3px solid #000":"1px solid #ccc","&:hover":{bgcolor:e,opacity:.8}}})},e))})]}),(0,k.jsx)(lR.Divider,{}),(0,k.jsxs)(P.Box,{children:[(0,k.jsxs)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:["Stroke Width: ",r,"px"]}),(0,k.jsx)(hy,{value:r,onChange:(e,t)=>s(t),min:1,max:20,step:1,marks:!0,valueLabelDisplay:"auto"})]}),(0,k.jsx)(lR.Divider,{}),(0,k.jsxs)(P.Box,{children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:"Actions"}),(0,k.jsxs)(lK,{orientation:"vertical",fullWidth:!0,children:[(0,k.jsx)(lP.Tooltip,{title:"Undo",placement:"right",children:(0,k.jsx)(O.Button,{onClick:o.undo,startIcon:(0,k.jsx)(hE.default,{}),children:"Undo"})}),(0,k.jsx)(lP.Tooltip,{title:"Redo",placement:"right",children:(0,k.jsx)(O.Button,{onClick:o.redo,startIcon:(0,k.jsx)(hk.default,{}),children:"Redo"})}),(0,k.jsx)(lP.Tooltip,{title:"Clear Board",placement:"right",children:(0,k.jsx)(O.Button,{onClick:o.clearBoard,startIcon:(0,k.jsx)(hT.default,{}),color:"error",children:"Clear"})})]})]})]})}var hP=e.i(65482),hR=e.i(96534),hN=e.i(9617),hA=e.i(64295),hO=e.i(72141),hD=e.i(16135),hL=e.i(87081),hM=e.i(26907);function hF(){let{presence:e,isConnected:t}=lk(),n=e=>{let t=(e=>{switch(e){case"active":return"success";case"idle":return"warning";default:return"action"}})(e);return(0,k.jsx)(hM.default,{sx:{fontSize:12},color:t})},i=Array.from(e.values()).filter(e=>"active"===e.status),r=Array.from(e.values()).filter(e=>"idle"===e.status);return Array.from(e.values()).filter(e=>"offline"===e.status),(0,k.jsxs)(D.Paper,{elevation:3,sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:250,maxWidth:300,maxHeight:"100%",overflow:"auto"},children:[(0,k.jsxs)(P.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",children:"Presence"}),(0,k.jsx)(hD.Chip,{label:t?"Connected":"Disconnected",size:"small",color:t?"success":"error",icon:(0,k.jsx)(hC.default,{})})]}),i.length>0&&(0,k.jsxs)(P.Box,{children:[(0,k.jsxs)(N.Typography,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:["Active (",i.length,")"]}),(0,k.jsx)(hP.List,{dense:!0,children:i.map(e=>(0,k.jsxs)(hR.ListItem,{sx:{px:0},children:[(0,k.jsx)(hN.ListItemAvatar,{children:(0,k.jsx)(hL.Badge,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:n(e.status),children:(0,k.jsx)(hO.Avatar,{src:e.avatar,alt:e.name,sx:{width:32,height:32},children:e.name.charAt(0).toUpperCase()})})}),(0,k.jsx)(hA.ListItemText,{primary:e.name,secondary:e.cursor?`(${Math.round(e.cursor.x)}, ${Math.round(e.cursor.y)})`:"Active",primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"}})]},e.userId))})]}),r.length>0&&(0,k.jsxs)(P.Box,{children:[(0,k.jsxs)(N.Typography,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:["Idle (",r.length,")"]}),(0,k.jsx)(hP.List,{dense:!0,children:r.map(e=>(0,k.jsxs)(hR.ListItem,{sx:{px:0},children:[(0,k.jsx)(hN.ListItemAvatar,{children:(0,k.jsx)(hL.Badge,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:n(e.status),children:(0,k.jsx)(hO.Avatar,{src:e.avatar,alt:e.name,sx:{width:32,height:32,opacity:.6},children:e.name.charAt(0).toUpperCase()})})}),(0,k.jsx)(hA.ListItemText,{primary:e.name,secondary:"Idle",primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"},sx:{opacity:.6}})]},e.userId))})]}),0===e.size&&(0,k.jsx)(P.Box,{sx:{textAlign:"center",py:4},children:(0,k.jsx)(N.Typography,{variant:"body2",color:"text.secondary",children:"No other users online"})})]})}var hj=e.i(75976),hU=e.i(10724);function hB(){let{notifications:e}=lk(),{addNotification:t}=(0,hU.useNotifications)(),[n,i]=(0,S.useState)(null),r=(0,S.useRef)(new Set);(0,S.useEffect)(()=>{if(e.length>0){let n=e[e.length-1];if(!r.current.has(n.id)){r.current.add(n.id),i(n),t({type:"board",title:(e=>{switch(e){case"join":return"User Joined";case"leave":return"User Left";case"update":return"Board Updated";case"milestone":return"Milestone Reached";default:return"Board Notification"}})(n.type),message:n.message,metadata:{link:"/labs",actor:n.actor?{id:n.actor.userId,name:n.actor.name}:void 0}}).catch(e=>console.error("Failed to add notification:",e));let e=setTimeout(()=>{i(null)},5e3);return()=>clearTimeout(e)}}},[e,t]);let s=()=>{i(null)};return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(hj.Snackbar,{open:!!n,autoHideDuration:5e3,onClose:s,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:n&&(0,k.jsxs)(U.Alert,{onClose:s,severity:(e=>{switch(e){case"critical":return"error";case"warning":return"warning";default:return"info"}})(n.severity),sx:{width:"100%",maxWidth:400},children:[(0,k.jsx)(B.AlertTitle,{children:(e=>{switch(e){case"join":return"User Joined";case"leave":return"User Left";case"update":return"Board Updated";case"milestone":return"Milestone Reached";default:return"Board Notification"}})(n.type)}),(0,k.jsx)(N.Typography,{variant:"body2",children:n.message}),n.actor&&(0,k.jsxs)(N.Typography,{variant:"caption",color:"text.secondary",children:["by ",n.actor.name]})]})})})}function hW(){let{presence:e}=lk(),t=Array.from(e.values()).filter(e=>"active"===e.status&&e.cursor);return(0,k.jsx)(P.Box,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:t.map(e=>(0,k.jsxs)(P.Box,{sx:{position:"absolute",left:e.cursor?.x||0,top:e.cursor?.y||0,transform:"translate(-50%, -50%)",transition:"all 0.1s ease-out"},children:[(0,k.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"},children:(0,k.jsx)("path",{d:"M5.5 3.21V20.8L9.5 16.8L12.5 24L14.5 23L11.5 15.8L16.5 15.3L5.5 3.21Z",fill:`hsl(${137.5*e.userId.charCodeAt(0)%360}, 70%, 50%)`,stroke:"white",strokeWidth:"1"})}),(0,k.jsx)(P.Box,{sx:{position:"absolute",top:20,left:10,bgcolor:`hsl(${137.5*e.userId.charCodeAt(0)%360}, 70%, 50%)`,color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.75rem",fontWeight:"bold",whiteSpace:"nowrap",boxShadow:1},children:e.name})]},e.userId))})}function hq({onClose:e}){let{boardId:t,isLoading:n,isConnected:i,error:r}=lk(),[s,o]=(0,S.useState)("pen"),[a,l]=(0,S.useState)("#000000"),[h,c]=(0,S.useState)(2),[u,d]=(0,S.useState)({width:1200,height:700});return(0,S.useEffect)(()=>{let e=()=>{d({width:Math.min(window.innerWidth-600,1600),height:Math.min(window.innerHeight-200,900)})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,k.jsxs)(P.Box,{sx:{height:"100vh",display:"flex",flexDirection:"column",bgcolor:"background.default"},children:[(0,k.jsx)(L.AppBar,{position:"static",elevation:1,children:(0,k.jsxs)(M.Toolbar,{children:[(0,k.jsxs)(N.Typography,{variant:"h6",sx:{flexGrow:1},children:["Collaboration Board ",t&&`- ${t}`]}),!i&&(0,k.jsx)(U.Alert,{severity:"warning",icon:(0,k.jsx)(q.default,{}),sx:{mr:2},action:(0,k.jsx)(O.Button,{size:"small",color:"inherit",onClick:()=>window.location.reload(),children:"Reconnect"}),children:"Using offline mode - changes may not sync"}),e&&(0,k.jsx)(F.IconButton,{edge:"end",color:"inherit",onClick:e,children:(0,k.jsx)(W.default,{})})]})}),r&&(0,k.jsxs)(U.Alert,{severity:"error",sx:{m:2},action:(0,k.jsx)(F.IconButton,{size:"small",onClick:()=>window.location.reload(),children:(0,k.jsx)(z.default,{})}),children:[(0,k.jsx)(B.AlertTitle,{children:"Connection Error"}),r]}),n&&!t&&(0,k.jsxs)(P.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1},children:[(0,k.jsx)(j.CircularProgress,{}),(0,k.jsx)(N.Typography,{sx:{ml:2},children:"Loading board..."})]}),!n&&(0,k.jsxs)(P.Box,{sx:{display:"flex",flexGrow:1,overflow:"hidden",position:"relative"},children:[(0,k.jsx)(P.Box,{sx:{p:2,bgcolor:"background.paper",borderRight:1,borderColor:"divider"},children:(0,k.jsx)(hx,{currentTool:s,onToolChange:o,currentColor:a,onColorChange:l,strokeWidth:h,onStrokeWidthChange:c})}),(0,k.jsxs)(P.Box,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",overflow:"auto"},children:[(0,k.jsx)(lx,{width:u.width,height:u.height,currentTool:s,currentColor:a,strokeWidth:h}),(0,k.jsx)(hW,{})]}),(0,k.jsx)(P.Box,{sx:{p:2,bgcolor:"background.paper",borderLeft:1,borderColor:"divider"},children:(0,k.jsx)(hF,{})})]}),(0,k.jsx)(hB,{})]})}function hz({boardId:e,userId:t,userName:n,onClose:i}){return(0,k.jsx)(lS,{userId:t,userName:n,children:(0,k.jsx)(h$,{boardId:e,onClose:i})})}function h$({boardId:e,onClose:t}){let{actions:n}=lk();return(0,S.useEffect)(()=>(n.setBoardId(e),n.broadcastNotification({type:"join",message:"joined the board",severity:"info",actor:{userId:"",name:""}}),()=>{n.broadcastNotification({type:"leave",message:"left the board",severity:"info",actor:{userId:"",name:""}}),n.updatePresence("offline")}),[e,n]),(0,k.jsx)(hq,{onClose:t})}var hH=e.i(5877);function hV(){let e=(0,x.useRouter)(),{boardId:t}=e.query,{user:n}=(0,hH.useAuth)(),[i,r]=(0,S.useState)(""),[s,o]=(0,S.useState)(!1),a=t||i,l=()=>{i.trim()&&(o(!0),e.push(`/board?boardId=${i}`,void 0,{shallow:!0}))};return(s||t)&&a?(0,k.jsx)(hz,{boardId:a,userId:n?.id||"anonymous",userName:n?.name||"Anonymous User",onClose:()=>{o(!1),r(""),e.push("/board",void 0,{shallow:!0})}}):(0,k.jsx)(R.Container,{maxWidth:"sm",sx:{mt:8},children:(0,k.jsxs)(D.Paper,{sx:{p:4},children:[(0,k.jsx)(N.Typography,{variant:"h4",gutterBottom:!0,children:"Collaboration Board"}),(0,k.jsx)(N.Typography,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Create a new board or join an existing one to collaborate in real-time."}),(0,k.jsxs)(P.Box,{sx:{mt:4,display:"flex",flexDirection:"column",gap:2},children:[(0,k.jsx)(O.Button,{variant:"contained",size:"large",onClick:()=>{let t=`board_${Date.now()}`;r(t),o(!0),e.push(`/board?boardId=${t}`,void 0,{shallow:!0})},fullWidth:!0,children:"Create New Board"}),(0,k.jsx)(N.Typography,{variant:"body2",textAlign:"center",color:"text.secondary",children:"- OR -"}),(0,k.jsx)(A.TextField,{label:"Board ID",variant:"outlined",fullWidth:!0,value:i,onChange:e=>r(e.target.value),placeholder:"Enter board ID to join",onKeyPress:e=>{"Enter"===e.key&&l()}}),(0,k.jsx)(O.Button,{variant:"outlined",size:"large",onClick:l,disabled:!i.trim(),fullWidth:!0,children:"Join Existing Board"})]}),!n&&(0,k.jsx)(P.Box,{sx:{mt:3,p:2,bgcolor:"info.light",borderRadius:1},children:(0,k.jsx)(N.Typography,{variant:"body2",color:"info.contrastText",children:" Tip: Log in to save your boards and see your collaboration history."})})]})})}e.s(["default",()=>hV],55429)},43765,(e,t,n)=>{let i="/board";(window.__NEXT_P=window.__NEXT_P||[]).push([i,()=>e.r(55429)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([i])})}]);