(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,56254,(e,t,n)=>{"use strict";var i=e.r(91074);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(64800)),s=e.r(44855);n.default=(0,r.default)((0,s.jsx)("path",{d:"M19.35 10.04C18.67 6.59 15.64 4 12 4c-1.48 0-2.85.43-4.01 1.17l1.46 1.46C10.21 6.23 11.08 6 12 6c3.04 0 5.5 2.46 5.5 5.5v.5H19c1.66 0 3 1.34 3 3 0 1.13-.64 2.11-1.56 2.62l1.45 1.45C23.16 18.16 24 16.68 24 15c0-2.64-2.05-4.78-4.65-4.96M3 5.27l2.75 2.74C2.56 8.15 0 10.77 0 14c0 3.31 2.69 6 6 6h11.73l2 2L21 20.73 4.27 4zM7.73 10l8 8H6c-2.21 0-4-1.79-4-4s1.79-4 4-4z"}),"CloudOff")},35463,(e,t,n)=>{"use strict";var i=e.r(91074);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(64800)),s=e.r(44855);n.default=(0,r.default)((0,s.jsx)("path",{d:"M2 4h20v16H2z"}),"Rectangle")},20562,(e,t,n)=>{"use strict";var i=e.r(91074);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(64800)),s=e.r(44855);n.default=(0,r.default)((0,s.jsx)("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle")},91508,(e,t,n)=>{"use strict";var i=e.r(91074);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(64800)),s=e.r(44855);n.default=(0,r.default)((0,s.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove")},83944,(e,t,n)=>{"use strict";var i=e.r(91074);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(64800)),s=e.r(44855);n.default=(0,r.default)((0,s.jsx)("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo")},35499,(e,t,n)=>{"use strict";var i=e.r(91074);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(64800)),s=e.r(44855);n.default=(0,r.default)((0,s.jsx)("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"Redo")},21530,(e,t,n)=>{"use strict";var i=e.r(91074);Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=i(e.r(64800)),s=e.r(44855);n.default=(0,r.default)((0,s.jsx)("circle",{cx:"12",cy:"12",r:"8"}),"FiberManualRecord")},1277,e=>{"use strict";let t,n,i,r,s,o,a,l,h,c,u,d,p,f,m,g,_,v,y,b;var w,C,I,T,E,k=e.i(44855),S=e.i(58891),x=e.i(83344),P=e.i(74614),R=e.i(72204),N=e.i(15915),A=e.i(92378),O=e.i(75557),D=e.i(65790),L=e.i(9487),M=e.i(81037),F=e.i(86012),j=e.i(37025),U=e.i(9109),B=e.i(96335),W=e.i(84933),q=e.i(80622),z=e.i(81706),$=e.i(15127),H=e.i(90324),V=e.i(96861),K=e.i(88795),G=e.i(51480),Y=e.i(13740);function J(e){return(0,Y.default)("MuiAlertTitle",e)}(0,G.default)("MuiAlertTitle",["root"]);let X=["className"],Q=(0,H.styled)(K.default,{name:"MuiAlertTitle",slot:"Root",overridesResolver:(e,t)=>t.root})(({theme:e})=>({fontWeight:e.typography.fontWeightMedium,marginTop:-2})),Z=S.forwardRef(function(e,t){let n=(0,V.useDefaultProps)({props:e,name:"MuiAlertTitle"}),{className:i}=n,r=(0,q.default)(n,X),s=(e=>{let{classes:t}=e;return(0,$.default)({root:["root"]},J,t)})(n);return(0,k.jsx)(Q,(0,W.default)({gutterBottom:!0,component:"div",ownerState:n,ref:t,className:(0,z.default)(s.root,i)},r))});var ee=e.i(10600),et=e.i(56254),en=e.i(24918);let ei=function(e,t){if(!e)throw er(t)},er=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},es=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:((64512&r)==55296&&i+1<e.length&&(64512&e.charCodeAt(i+1))==56320?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128):t[n++]=r>>12|224,t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eo=function(e){let t=[],n=0,i=0;for(;n<e.length;){let r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){let s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")},ea={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){let r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=r>>2,c=(3&r)<<4|o>>4,u=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(u=64)),i.push(n[h],n[c],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(es(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):eo(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){let r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==a)throw new el;let l=r<<2|s>>4;if(i.push(l),64!==o){let e=s<<4&240|o>>2;if(i.push(e),64!==a){let e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class el extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let eh=function(e){let t=es(e);return ea.encodeByteArray(t,!0)},ec=function(e){return eh(e).replace(/\./g,"")},eu=function(e){try{return ea.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},ed=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===B.default||void 0===B.default.env)return;let e=B.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&eu(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},ep=e=>ed()?.emulatorHosts?.[e],ef=()=>ed()?.config,em=e=>ed()?.[`_${e}`];class eg{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function e_(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function ev(e){return(await fetch(e,{credentials:"include"})).ok}let ey={},eb=!1;function ew(e,t){if("undefined"==typeof window||"undefined"==typeof document||!e_(window.location.host)||ey[e]===t||ey[e]||eb)return;function n(e){return`__firebase__banner__${e}`}ey[e]=t;let i="__firebase__banner",r=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(ey))ey[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(i),t=!1,e||((e=document.createElement("div")).setAttribute("id",i),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;eb=!0,(e=document.getElementById(i))&&e.remove()},e);u.setAttribute("width","24"),u.setAttribute("id",c),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px",t.append(u,a,h,n),document.body.appendChild(t)}r?(a.innerText="Preview backend disconnected.",u.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(u.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function eC(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function eI(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(eC())}function eT(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function eE(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ek(){return false}class eS extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,eS.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ex.prototype.create)}}class ex{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,i;let r=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,i=r,n.replace(eP,(e,t)=>{let n=i[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new eS(s,l,r)}}let eP=/\{\$([^}]+)}/g;function eR(e){return JSON.parse(e)}function eN(e){return JSON.stringify(e)}let eA=function(e){let t={},n={},i={},r="";try{let s=e.split(".");t=eR(eu(s[0])||""),n=eR(eu(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}},eO=function(e){let t=eA(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},eD=function(e){let t=eA(e).claims;return"object"==typeof t&&!0===t.admin};function eL(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eM(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eF(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ej(e,t,n){let i={};for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function eU(e,t){if(e===t)return!0;let n=Object.keys(e),i=Object.keys(t);for(let r of n){if(!i.includes(r))return!1;let n=e[r],s=t[r];if(eB(n)&&eB(s)){if(!eU(n,s))return!1}else if(n!==s)return!1}for(let e of i)if(!n.includes(e))return!1;return!0}function eB(e){return null!==e&&"object"==typeof e}function eW(e){let t=[];for(let[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function eq(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}}),t}function ez(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class e${constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,i;t||(t=0);let r=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)r[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)r[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),i=0x5a827999):(n=o^a^l,i=0x6ed9eba1):e<60?(n=o&a|l&(o|a),i=0x8f1bbcdc):(n=o^a^l,i=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+i+r[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,i=0,r=this.buf_,s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class eH{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(i=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(i.next=eV),void 0===i.error&&(i.error=eV),void 0===i.complete&&(i.complete=eV);let r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}}),this.observers.push(i),r}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function eV(){}function eK(e,t){return`${e} failed: ${t} argument `}let eG=function(e){let t=[],n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);if(r>=55296&&r<=56319){let t=r-55296;ei(++i<e.length,"Surrogate pair missing trail surrogate."),r=65536+(t<<10)+(e.charCodeAt(i)-56320)}r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return t},eY=function(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function eJ(e){return e&&e._delegate?e._delegate:e}class eX{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eQ="[DEFAULT]";class eZ{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new eg;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eQ})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eQ){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eQ){return this.instances.has(e)}getOptions(e=eQ){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),i=this.onInitCallbacks.get(n)??new Set;i.add(e),this.onInitCallbacks.set(n,i);let r=this.instances.get(n);return r&&e(r,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let i of n)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eQ?void 0:n,options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=eQ){return this.component?this.component.multipleInstances?e:eQ:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class e0{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eZ(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let e1=[];(w=T||(T={}))[w.DEBUG=0]="DEBUG",w[w.VERBOSE=1]="VERBOSE",w[w.INFO=2]="INFO",w[w.WARN=3]="WARN",w[w.ERROR=4]="ERROR",w[w.SILENT=5]="SILENT";let e2={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},e3=T.INFO,e5={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},e4=(e,t,...n)=>{if(t<e.logLevel)return;let i=new Date().toISOString(),r=e5[t];if(r)console[r](`[${i}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class e6{constructor(e){this.name=e,this._logLevel=e3,this._logHandler=e4,this._userLogHandler=null,e1.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in T))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?e2[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...e),this._logHandler(this,T.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...e),this._logHandler(this,T.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,T.INFO,...e),this._logHandler(this,T.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,T.WARN,...e),this._logHandler(this,T.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,T.ERROR,...e),this._logHandler(this,T.ERROR,...e)}}let e8=new WeakMap,e7=new WeakMap,e9=new WeakMap,te=new WeakMap,tt=new WeakMap,tn={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return e7.get(e);if("objectStoreNames"===t)return e.objectStoreNames||e9.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ti(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ti(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(ti(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&e8.set(t,e)}).catch(()=>{}),tt.set(t,e),t}if(te.has(e))return te.get(e);let i=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(tr(this),t),ti(e8.get(this))}:function(...t){return ti(e.apply(tr(this),t))}:function(t,...n){let i=e.call(tr(this),t,...n);return e9.set(i,t.sort?t.sort():[t]),ti(i)};return e instanceof IDBTransaction&&function(e){if(e7.has(e))return;let t=new Promise((t,n)=>{let i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)});e7.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,tn):e}(e);return i!==e&&(te.set(e,i),tt.set(i,e)),i}let tr=e=>tt.get(e),ts=["get","getKey","getAll","getAllKeys","count"],to=["put","add","delete","clear"],ta=new Map;function tl(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(ta.get(t))return ta.get(t);let n=t.replace(/FromIndex$/,""),i=t!==n,r=to.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(r||ts.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,r?"readwrite":"readonly"),o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return ta.set(t,s),s}tn={...b=tn,get:(e,t,n)=>tl(e,t)||b.get(e,t,n),has:(e,t)=>!!tl(e,t)||b.has(e,t)};class th{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let tc="@firebase/app",tu="0.14.6",td=new e6("@firebase/app"),tp="[DEFAULT]",tf={[tc]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},tm=new Map,tg=new Map,t_=new Map;function tv(e,t){try{e.container.addComponent(t)}catch(n){td.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function ty(e,t){e.container.addOrOverwriteComponent(t)}function tb(e){let t=e.name;if(t_.has(t))return td.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(t_.set(t,e),tm.values()))tv(n,e);for(let t of tg.values())tv(t,e);return!0}function tw(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function tC(e,t,n=tp){tw(e,t).clearInstance(n)}function tI(e){return void 0!==e.options}function tT(e){return!tI(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function tE(e){return null!=e&&void 0!==e.settings}function tk(){t_.clear()}let tS=new ex("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class tx{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eX("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tS.create("app-deleted",{appName:this._name})}}function tP(e,t){let n=eu(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tR extends tx{constructor(e,t,n,i){const r=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:r};void 0!==e.apiKey?super(e,s,i):super(e.options,s,i),this._serverConfig={automaticDataCollectionEnabled:r,...t},this._serverConfig.authIdToken&&tP(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tP(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tF(tc,tu,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tM(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tS.create("server-app-deleted")}}let tN="12.6.0";function tA(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let i={name:tp,automaticDataCollectionEnabled:!0,...t},r=i.name;if("string"!=typeof r||!r)throw tS.create("bad-app-name",{appName:String(r)});if(n||(n=ef()),!n)throw tS.create("no-options");let s=tm.get(r);if(s)if(eU(n,s.options)&&eU(i,s.config))return s;else throw tS.create("duplicate-app",{appName:r});let o=new e0(r);for(let e of t_.values())o.addComponent(e);let a=new tx(n,i,o);return tm.set(r,a),a}function tO(e,t={}){let n;if(("undefined"!=typeof window||eT())&&!eT())throw tS.create("invalid-server-app-environment");let i=t||{};if(e&&(tI(e)?n=e.options:tT(e)?i=e:n=e),void 0===i.automaticDataCollectionEnabled&&(i.automaticDataCollectionEnabled=!0),n||(n=ef()),!n)throw tS.create("no-options");let r={...i,...n};if(void 0!==r.releaseOnDeref&&delete r.releaseOnDeref,void 0!==i.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw tS.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(r)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=tg.get(s);if(o)return o.incRefCount(i.releaseOnDeref),o;let a=new e0(s);for(let e of t_.values())a.addComponent(e);let l=new tR(n,i,s,a);return tg.set(s,l),l}function tD(e=tp){let t=tm.get(e);if(!t&&e===tp&&ef())return tA();if(!t)throw tS.create("no-app",{appName:e});return t}function tL(){return Array.from(tm.values())}async function tM(e){let t=!1,n=e.name;tm.has(n)?(t=!0,tm.delete(n)):tg.has(n)&&0>=e.decRefCount()&&(tg.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tF(e,t,n){let i=tf[e]??e;n&&(i+=`-${n}`);let r=i.match(/\s|\//),s=t.match(/\s|\//);if(r||s){let e=[`Unable to register library "${i}" with version "${t}":`];r&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),r&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),td.warn(e.join(" "));return}tb(new eX(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}function tj(e,t){if(null!==e&&"function"!=typeof e)throw tS.create("invalid-log-argument");for(let n of e1){let i=null;t&&t.level&&(i=e2[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...r)=>{let s=r.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(i??t.logLevel)&&e({level:T[n].toLowerCase(),message:s,args:r,type:t.name})}}}function tU(e){e1.forEach(t=>{t.setLogLevel(e)})}let tB="firebase-heartbeat-store",tW=null;function tq(){return tW||(tW=(function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(e,1),a=ti(o);return i&&o.addEventListener("upgradeneeded",e=>{i(ti(o.result),e.oldVersion,e.newVersion,ti(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),r&&e.addEventListener("versionchange",e=>r(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tB)}catch(e){console.warn(e)}}}).catch(e=>{throw tS.create("idb-open",{originalErrorMessage:e.message})})),tW}async function tz(e){try{let t=(await tq()).transaction(tB),n=await t.objectStore(tB).get(tH(e));return await t.done,n}catch(e){if(e instanceof eS)td.warn(e.message);else{let t=tS.create("idb-get",{originalErrorMessage:e?.message});td.warn(t.message)}}}async function t$(e,t){try{let n=(await tq()).transaction(tB,"readwrite"),i=n.objectStore(tB);await i.put(t,tH(e)),await n.done}catch(e){if(e instanceof eS)td.warn(e.message);else{let t=tS.create("idb-set",{originalErrorMessage:e?.message});td.warn(t.message)}}}function tH(e){return`${e.name}!${e.options.appId}`}class tV{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tG(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tK();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){td.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tK(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],i=e.slice();for(let r of e){let e=n.find(e=>e.agent===r.agent);if(e){if(e.dates.push(r.date),tY(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),tY(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=ec(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return td.warn(e),""}}}function tK(){return new Date().toISOString().substring(0,10)}class tG{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{t(r.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tz(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return t$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return t$(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tY(e){return ec(JSON.stringify({version:2,heartbeats:e})).length}tb(new eX("platform-logger",e=>new th(e),"PRIVATE")),tb(new eX("heartbeat",e=>new tV(e),"PRIVATE")),tF(tc,tu,""),tF(tc,tu,"esm2020"),tF("fire-js",""),e.s(["SDK_VERSION",()=>tN,"_DEFAULT_ENTRY_NAME",()=>tp,"_addComponent",()=>tv,"_addOrOverwriteComponent",()=>ty,"_apps",()=>tm,"_clearComponents",()=>tk,"_components",()=>t_,"_getProvider",()=>tw,"_isFirebaseApp",()=>tI,"_isFirebaseServerApp",()=>tE,"_isFirebaseServerAppSettings",()=>tT,"_registerComponent",()=>tb,"_removeServiceInstance",()=>tC,"_serverApps",()=>tg,"deleteApp",()=>tM,"getApp",()=>tD,"getApps",()=>tL,"initializeApp",()=>tA,"initializeServerApp",()=>tO,"onLog",()=>tj,"registerVersion",()=>tF,"setLogLevel",()=>tU],29706),tF("firebase","12.6.0","app"),e.i(29706);let tJ="@firebase/database",tX="1.1.0",tQ="";class tZ{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),eN(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:eR(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class t0{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return eL(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let t1=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new tZ(t)}}catch(e){}return new t0},t2=t1("localStorage"),t3=t1("sessionStorage"),t5=new e6("@firebase/database"),t4=(_=1,function(){return _++}),t6=function(e){let t=eG(e),n=new e$;n.update(t);let i=n.digest();return ea.encodeByteArray(i)},t8=function(...e){let t="";for(let n=0;n<e.length;n++){let i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=t8.apply(null,i):"object"==typeof i?t+=eN(i):t+=i,t+=" "}return t},t7=null,t9=!0,ne=function(e,t){ei(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(t5.logLevel=T.VERBOSE,t7=t5.log.bind(t5),t&&t3.set("logging_enabled",!0)):"function"==typeof e?t7=e:(t7=null,t3.remove("logging_enabled"))},nt=function(...e){if(!0===t9&&(t9=!1,null===t7&&!0===t3.get("logging_enabled")&&ne(!0)),t7){let t=t8.apply(null,e);t7(t)}},nn=function(e){return function(...t){nt(e,...t)}},ni=function(...e){let t="FIREBASE INTERNAL ERROR: "+t8(...e);t5.error(t)},nr=function(...e){let t=`FIREBASE FATAL ERROR: ${t8(...e)}`;throw t5.error(t),Error(t)},ns=function(...e){let t="FIREBASE WARNING: "+t8(...e);t5.warn(t)},no=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&ns("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},na=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},nl=function(e){if(ek()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},nh="[MIN_NAME]",nc="[MAX_NAME]",nu=function(e,t){if(e===t)return 0;{if(e===nh||t===nc)return -1;if(t===nh||e===nc)return 1;let n=ny(e),i=ny(t);if(null!==n)if(null!==i)return n-i==0?e.length-t.length:n-i;else return -1;return null!==i?1:e<t?-1:1}},nd=function(e,t){return e===t?0:e<t?-1:1},np=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+eN(t))},nf=function(e){if("object"!=typeof e||null===e)return eN(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=eN(t[i]),n+=":",n+=nf(e[t[i]]);return n+"}"},nm=function(e,t){let n=e.length;if(n<=t)return[e];let i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function ng(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let n_=function(e){let t,n,i,r,s;ei(!na(e),"Invalid JSON number");0===e?(n=0,i=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,i=Math.round(e*Math.pow(2,52-r)-0x10000000000000)):(n=0,i=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(i%2?1:0),i=Math.floor(i/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},nv=RegExp("^-?(0*)\\d{1,10}$"),ny=function(e){if(nv.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},nb=function(e){try{e()}catch(e){setTimeout(()=>{throw ns("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},nw=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class nC{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,tE(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){ns(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class nI{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(nt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',ns(e)}}class nT{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}nT.OWNER="owner";let nE=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,nk="websocket",nS="long_polling";class nx{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=t2.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&t2.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function nP(e,t,n){let i;if(ei("string"==typeof t,"typeof type must == string"),ei("object"==typeof n,"typeof params must == object"),t===nk)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===nS)i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let r=[];return ng(n,(e,t)=>{r.push(e+"="+t)}),i+r.join("&")}class nR{constructor(){this.counters_={}}incrementCounter(e,t=1){eL(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let i in n)n.hasOwnProperty(i)&&"__proto__"!==i&&(t[i]=e(t[i],n[i]));return t}(void 0,this.counters_)}}let nN={},nA={};function nO(e){let t=e.toString();return nN[t]||(nN[t]=new nR),nN[t]}class nD{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&nb(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let nL="start";class nM{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=nn(e),this.stats_=nO(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),nP(t,nS,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new nD(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),nl(()=>{if(this.isClosed_)return;this.scriptTagHolder=new nF((...e)=>{let[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===nL)this.id=n,this.password=i;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[nL]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&nE.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){nM.forceAllow_=!0}static forceDisallow(){nM.forceDisallow_=!0}static isAvailable(){return!ek()&&(!!nM.forceAllow_||!nM.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=eN(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=nm(eh(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ek())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=eN(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class nF{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,ek())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=t4(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=nF.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){nt("frame writing exception"),e.stack&&nt(e.stack),nt(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||nt("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(i),n()})}addTag(e,t){ek()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{nt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let nj=null;"undefined"!=typeof MozWebSocket?nj=MozWebSocket:"undefined"!=typeof WebSocket&&(nj=WebSocket);class nU{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=nn(this.connId),this.stats_=nO(t),this.connURL=nU.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){let s={};return s.v="5",!ek()&&"undefined"!=typeof location&&location.hostname&&nE.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s.ac=i),r&&(s.p=r),nP(e,nk,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,t2.set("previous_websocket_failure",!0);try{let e;if(ek()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${tQ}/${B.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=B.default.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new nj(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){nU.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==nj&&!nU.forceDisallow_}static previouslyFailed(){return t2.isInMemoryStorage||!0===t2.get("previous_websocket_failure")}markConnectionHealthy(){t2.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=eR(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(ei(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=eN(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=nm(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}nU.responsesRequiredToBeHealthy=2,nU.healthyTimeout=3e4;class nB{static get ALL_TRANSPORTS(){return[nM,nU]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=nU&&nU.isAvailable(),n=t&&!nU.previouslyFailed();if(e.webSocketOnly&&(t||ns("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[nU];else{let e=this.transports_=[];for(let t of nB.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);nB.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}nB.globalTransportInitialized_=!1;class nW{constructor(e,t,n,i,r,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=nn("c:"+this.id+":"),this.transportManager_=new nB(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=nw(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=np("t",e),n=np("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=np("t",e),n=np("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=np("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?ni("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):ni("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&ns("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),nw(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):nw(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(t2.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class nq{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class nz{constructor(e){this.allowedEvents_=e,this.listeners_={},ei(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);let i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){ei(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class n$ extends nz{static getInstance(){return new n$}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||eI()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return ei("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class nH{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function nV(){return new nH("")}function nK(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function nG(e){return e.pieces_.length-e.pieceNum_}function nY(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new nH(e.pieces_,t)}function nJ(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function nX(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function nQ(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new nH(t,0)}function nZ(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof nH)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new nH(n,0)}function n0(e){return e.pieceNum_>=e.pieces_.length}function n1(e,t){let n=nK(e),i=nK(t);if(null===n)return t;if(n===i)return n1(nY(e),nY(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function n2(e,t){if(nG(e)!==nG(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function n3(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(nG(e)>nG(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class n5{constructor(e,t){this.errorPrefix_=t,this.parts_=nX(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eY(this.parts_[e]);n4(this)}}function n4(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+n6(e))}function n6(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class n8 extends nz{static getInstance(){return new n8}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return ei("visible"===e,"Unknown event type: "+e),[this.visible_]}}class n7 extends nq{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=n7.nextPersistentConnectionId_++,this.log_=nn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!ek())throw Error("Auth override specified in options, but not supported on non Node.js platforms");n8.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&n$.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let i=++this.requestNumber_,r={r:i,a:e,b:t};this.log_(eN(r)),ei(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),n&&(this.requestCBHash_[i]=n)}get(e){this.initConnection_();let t=new eg,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,i){this.initConnection_();let r=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+r),this.listens.has(s)||this.listens.set(s,new Map),ei(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),ei(!this.listens.get(s).has(r),"listen() called twice for same path/queryId.");let o={onComplete:i,hashFn:t,query:e,tag:n};this.listens.get(s).set(r,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);let r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,r=>{let s=r.d,o=r.s;n7.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&eL(e,"w")){let n=eM(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();ns(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||eD(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=eO(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+i),ei(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,i)&&this.connected_&&this.sendUnlisten_(n,i,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);let r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){let r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,e=>{i&&setTimeout(()=>{i(e.s,e.d)},Math.floor(0))})}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();let s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+eN(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):ni("Unrecognized action received from server: "+eN(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){ei(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+n7.nextConnectionId_++,r=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){ei(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?nt("getToken() completed but was canceled"):(nt("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new nW(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{ns(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},r))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&ns(e),a())}}}interrupt(e){nt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){nt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],eF(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>nf(e)).join("$"):"default";let i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){let n,i=new nH(e).toString();if(this.listens.has(i)){let e=this.listens.get(i);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(i)}else n=void 0;return n}onAuthRevoked_(e,t){nt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){nt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";ek()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+tQ.replace(/\./g,"-")]=1,eI()?e["framework.cordova"]=1:eE()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=n$.getInstance().currentlyOnline();return eF(this.interruptReasons_)&&e}}n7.nextPersistentConnectionId_=0,n7.nextConnectionId_=0;class n9{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n9(e,t)}}class ie{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new n9(nh,e),i=new n9(nh,t);return 0!==this.compare(n,i)}minPost(){return n9.MIN}}class it extends ie{static get __EMPTY_NODE(){return i}static set __EMPTY_NODE(e){i=e}compare(e,t){return nu(e.name,t.name)}isDefinedOn(e){throw er("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return n9.MIN}maxPost(){return new n9(nc,i)}makePost(e,t){return ei("string"==typeof e,"KeyIndex indexValue must always be a string."),new n9(e,i)}toString(){return".key"}}let ii=new it;class ir{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class is{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:is.RED,this.left=null!=i?i:io.EMPTY_NODE,this.right=null!=r?r:io.EMPTY_NODE}copy(e,t,n,i,r){return new is(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this,r=n(e,i.key);return(i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return io.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,i;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return io.EMPTY_NODE;else i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,is.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,is.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}is.RED=!0,is.BLACK=!1;class io{constructor(e,t=io.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new io(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,is.BLACK,null,null))}remove(e){return new io(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,is.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(i)return i.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new ir(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new ir(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new ir(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new ir(this.root_,null,this.comparator_,!0,e)}}function ia(e,t){return nu(e.name,t.name)}function il(e,t){return nu(e,t)}io.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new is(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let ih=function(e){return"number"==typeof e?"number:"+n_(e):"string:"+e},ic=function(e){if(e.isLeafNode()){let t=e.val();ei("string"==typeof t||"number"==typeof t||"object"==typeof t&&eL(t,".sv"),"Priority must be a string or number.")}else ei(e===r||e.isEmpty(),"priority of unexpected type.");ei(e===r||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class iu{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=iu.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,ei(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),ic(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new iu(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:iu.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return n0(e)?this:".priority"===nK(e)?this.priorityNode_:iu.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:iu.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=nK(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(ei(".priority"!==n||1===nG(e),".priority must be the last token in a path"),this.updateImmediateChild(n,iu.__childrenNodeConstructor.EMPTY_NODE.updateChild(nY(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+ih(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=n_(this.value_):e+=this.value_,this.lazyHash_=t6(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===iu.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof iu.__childrenNodeConstructor?-1:(ei(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,i=iu.VALUE_TYPE_ORDER.indexOf(t),r=iu.VALUE_TYPE_ORDER.indexOf(n);return(ei(i>=0,"Unknown leaf type: "+t),ei(r>=0,"Unknown leaf type: "+n),i!==r)?r-i:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}iu.VALUE_TYPE_ORDER=["object","boolean","number","string"];let id=new class extends ie{compare(e,t){let n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?nu(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return n9.MIN}maxPost(){return new n9(nc,new iu("[PRIORITY-POST]",a))}makePost(e,t){return new n9(t,new iu("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},ip=Math.log(2);class im{constructor(e){this.count=parseInt(Math.log(e+1)/ip,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let ig=function(e,t,n,i){e.sort(t);let r=function(t,i){let s,o=i-t;if(0===o)return null;if(1===o)return s=e[t],new is(n?n(s):s,s.node,is.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=r(t,a),h=r(a+1,i);return s=e[a],new is(n?n(s):s,s.node,is.BLACK,l,h)}};return new io(i||t,function(t){let i=null,s=null,o=e.length,a=function(t,i){let s=o-t,a=o;o-=t;let h=r(s+1,a),c=e[s];l(new is(n?n(c):c,c.node,i,null,h))},l=function(e){i?i.left=e:s=e,i=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,is.BLACK):(a(i,is.BLACK),a(i,is.RED))}return s}(new im(e.length)))},i_={};class iv{static get Default(){return ei(i_&&id,"ChildrenNode.ts has not been loaded"),l=l||new iv({".priority":i_},{".priority":id})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eM(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof io?t:null}hasIndex(e){return eL(this.indexSet_,e.toString())}addIndex(e,t){let n;ei(e!==ii,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(n9.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();n=r?ig(i,e.getCompare()):i_;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new iv(h,l)}addToIndexes(e,t){return new iv(ej(this.indexes_,(n,i)=>{let r=eM(this.indexSet_,i);if(ei(r,"Missing index implementation for "+i),n===i_)if(!r.isDefinedOn(e.node))return i_;else{let n=[],i=t.getIterator(n9.Wrap),s=i.getNext();for(;s;)s.name!==e.name&&n.push(s),s=i.getNext();return n.push(e),ig(n,r.getCompare())}{let i=t.get(e.name),r=n;return i&&(r=r.remove(new n9(e.name,i))),r.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new iv(ej(this.indexes_,n=>{if(n===i_)return n;{let i=t.get(e.name);return i?n.remove(new n9(e.name,i)):n}}),this.indexSet_)}}class iy{static get EMPTY_NODE(){return h||(h=new iy(new io(il),null,iv.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&ic(this.priorityNode_),this.children_.isEmpty()&&ei(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new iy(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=nK(e);return null===t?this:this.getImmediateChild(t).getChild(nY(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(ei(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,i,r=new n9(e,t);t.isEmpty()?(n=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(r,this.children_)):(n=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(r,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new iy(n,s,i)}}updateChild(e,t){let n=nK(e);if(null===n)return t;{ei(".priority"!==nK(e)||1===nG(e),".priority must be the last token in a path");let i=this.getImmediateChild(n).updateChild(nY(e),t);return this.updateImmediateChild(n,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,i=0,r=!0;if(this.forEachChild(id,(s,o)=>{t[s]=o.val(e),n++,r&&iy.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1}),e||!r||!(i<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+ih(this.getPriority().val())+":"),this.forEachChild(id,(t,n)=>{let i=n.hash();""!==i&&(e+=":"+t+":"+i)}),this.lazyHash_=""===e?"":t6(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let i=this.resolveIndex_(n);if(!i)return this.children_.getPredecessorKey(e);{let n=i.getPredecessorKey(new n9(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new n9(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new n9(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,n9.Wrap),i=n.peek();for(;null!=i&&0>t.compare(i,e);)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,n9.Wrap),i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===ib?-1:0}withIndex(e){if(e===ii||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new iy(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===ii||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(id),n=e.getIterator(id),i=t.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=t.getNext(),r=n.getNext()}return null===i&&null===r}}resolveIndex_(e){return e===ii?null:this.indexMap_.get(e.toString())}}iy.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let ib=new class extends iy{constructor(){super(new io(il),iy.EMPTY_NODE,iv.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return iy.EMPTY_NODE}isEmpty(){return!1}};function iw(e,t=null){if(null===e)return iy.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),ei(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new iu(e,iw(t));if(e instanceof Array){let n=iy.EMPTY_NODE;return ng(e,(t,i)=>{if(eL(e,t)&&"."!==t.substring(0,1)){let e=iw(i);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(iw(t))}{let n=[],i=!1;if(ng(e,(e,t)=>{if("."!==e.substring(0,1)){let r=iw(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new n9(e,r)))}}),0===n.length)return iy.EMPTY_NODE;let r=ig(n,ia,e=>e.name,il);if(!i)return new iy(r,iw(t),iv.Default);{let e=ig(n,id.getCompare());return new iy(r,iw(t),new iv({".priority":e},{".priority":id}))}}}Object.defineProperties(n9,{MIN:{value:new n9(nh,iy.EMPTY_NODE)},MAX:{value:new n9(nc,ib)}}),it.__EMPTY_NODE=iy.EMPTY_NODE,iu.__childrenNodeConstructor=iy,r=ib,a=ib,o=iw;class iC extends ie{constructor(e){super(),this.indexPath_=e,ei(!n0(e)&&".priority"!==nK(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?nu(e.name,t.name):r}makePost(e,t){let n=iw(e);return new n9(t,iy.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new n9(nc,iy.EMPTY_NODE.updateChild(this.indexPath_,ib))}toString(){return nX(this.indexPath_,0).join("/")}}let iI=new class extends ie{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?nu(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return n9.MIN}maxPost(){return n9.MAX}makePost(e,t){return new n9(t,iw(e))}toString(){return".value"}};function iT(e){return{type:"value",snapshotNode:e}}function iE(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ik(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function iS(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class ix{constructor(e){this.index_=e}updateChild(e,t,n,i,r,s){ei(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let o=e.getImmediateChild(t);return o.getChild(i).equals(n.getChild(i))&&o.isEmpty()===n.isEmpty()||(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(ik(t,o)):ei(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(iE(t,n)):s.trackChildChange(iS(t,n,o))),e.isLeafNode()&&n.isEmpty())?e:e.updateImmediateChild(t,n).withIndex(this.index_)}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(id,(e,i)=>{t.hasChild(e)||n.trackChildChange(ik(e,i))}),t.isLeafNode()||t.forEachChild(id,(t,i)=>{if(e.hasChild(t)){let r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(iS(t,i,r))}else n.trackChildChange(iE(t,i))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?iy.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class iP{constructor(e){this.indexedFilter_=new ix(e.getIndex()),this.index_=e.getIndex(),this.startPost_=iP.getStartPost_(e),this.endPost_=iP.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?0>=this.index_.compare(this.getStartPost(),e):0>this.index_.compare(this.getStartPost(),e),n=this.endIsInclusive_?0>=this.index_.compare(e,this.getEndPost()):0>this.index_.compare(e,this.getEndPost());return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new n9(t,n))||(n=iy.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=iy.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(iy.EMPTY_NODE);let r=this;return t.forEachChild(id,(e,t)=>{r.matches(new n9(e,t))||(i=i.updateImmediateChild(e,iy.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(!e.hasStart())return e.getIndex().minPost();{let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}}static getEndPost_(e){if(!e.hasEnd())return e.getIndex().maxPost();{let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}}}class iR{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{let t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new iP(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return(this.rangedFilter_.matches(new n9(t,n))||(n=iy.EMPTY_NODE),e.getImmediateChild(t).equals(n))?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=iy.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=iy.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){let t=e.getNext();if(this.withinDirectionalStart(t))if(this.withinDirectionalEnd(t))i=i.updateImmediateChild(t.name,t.node),n++;else break}}else{let e;i=(i=t.withIndex(this.index_)).updatePriority(iy.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){let t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,iy.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,i,r){let s;if(this.reverse_){let e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();ei(e.numChildren()===this.limit_,"");let o=new n9(t,n),a=this.reverse_?e.getFirstChild(this.index_):e.getLastChild(this.index_),l=this.rangedFilter_.matches(o);if(e.hasChild(t)){let h=e.getImmediateChild(t),c=i.getChildAfterChild(this.index_,a,this.reverse_);for(;null!=c&&(c.name===t||e.hasChild(c.name));)c=i.getChildAfterChild(this.index_,c,this.reverse_);let u=null==c?1:s(c,o);if(l&&!n.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(iS(t,n,h)),e.updateImmediateChild(t,n);{null!=r&&r.trackChildChange(ik(t,h));let n=e.updateImmediateChild(t,iy.EMPTY_NODE);return null!=c&&this.rangedFilter_.matches(c)?(null!=r&&r.trackChildChange(iE(c.name,c.node)),n.updateImmediateChild(c.name,c.node)):n}}return n.isEmpty()?e:l?s(a,o)>=0?(null!=r&&(r.trackChildChange(ik(a.name,a.node)),r.trackChildChange(iE(t,n))),e.updateImmediateChild(t,n).updateImmediateChild(a.name,iy.EMPTY_NODE)):e:e}}class iN{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=id}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return ei(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(ei(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:nh}hasEnd(){return this.endSet_}getIndexEndValue(){return ei(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(ei(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:nc}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return ei(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===id}copy(){let e=new iN;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function iA(e){let t,n={};if(e.isDefault())return n;if(e.index_===id?t="$priority":e.index_===iI?t="$value":e.index_===ii?t="$key":(ei(e.index_ instanceof iC,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=eN(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=eN(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+eN(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=eN(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+eN(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function iO(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==id&&(t.i=e.index_.toString()),t}class iD extends nq{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(ei(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=nn("p:rest:"),this.listens_={}}listen(e,t,n,i){let r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);let s=iD.getListenId_(e,n),o={};this.listens_[s]=o;let a=iA(e._queryParams);this.restRequest_(r+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),eM(this.listens_,s)===o)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=iD.getListenId_(e,t);delete this.listens_[n]}get(e){let t=iA(e._queryParams),n=e._path.toString(),i=new eg;return this.restRequest_(n+".json",t,(e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(Error(r))}),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eW(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=eR(o.responseText)}catch(e){ns("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&ns("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class iL{constructor(){this.rootNode_=iy.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function iM(){return{value:null,children:new Map}}function iF(e,t,n){var i,r;null!==e.value?n(t,e.value):(i=e,r=(e,i)=>{iF(i,new nH(t.toString()+"/"+e),n)},i.children.forEach((e,t)=>{r(t,e)}))}class ij{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&ng(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class iU{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new ij(e);const n=1e4+2e4*Math.random();nw(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;ng(e,(e,i)=>{i>0&&eL(this.statsToReport_,e)&&(t[e]=i,n=!0)}),n&&this.server_.reportStats(t),nw(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function iB(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function iW(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function iq(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(C=E||(E={}))[C.OVERWRITE=0]="OVERWRITE",C[C.MERGE=1]="MERGE",C[C.ACK_USER_WRITE=2]="ACK_USER_WRITE",C[C.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class iz{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=E.ACK_USER_WRITE,this.source=iB()}operationForChild(e){if(!n0(this.path))return ei(nK(this.path)===e,"operationForChild called for unrelated child."),new iz(nY(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return ei(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new nH(e));return new iz(nV(),t,this.revert)}}}class i${constructor(e,t){this.source=e,this.path=t,this.type=E.LISTEN_COMPLETE}operationForChild(e){return n0(this.path)?new i$(this.source,nV()):new i$(this.source,nY(this.path))}}class iH{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=E.OVERWRITE}operationForChild(e){return n0(this.path)?new iH(this.source,nV(),this.snap.getImmediateChild(e)):new iH(this.source,nY(this.path),this.snap)}}class iV{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=E.MERGE}operationForChild(e){if(!n0(this.path))return ei(nK(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new iV(this.source,nY(this.path),this.children);{let t=this.children.subtree(new nH(e));return t.isEmpty()?null:t.value?new iH(this.source,nV(),t.value):new iV(this.source,nV(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class iK{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(n0(e))return this.isFullyInitialized()&&!this.filtered_;let t=nK(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class iG{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function iY(e,t,n,i,r,s){let o=i.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw er("Should only compare child_ events.");let i=new n9(t.childName,t.snapshotNode),r=new n9(n.childName,n.snapshotNode);return e.index_.compare(i,r)})(e,t,n)),o.forEach(n=>{var i,o,a;let l=(i=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,i.index_)),o);r.forEach(i=>{i.respondsTo(n.type)&&t.push(i.createEvent(l,e.query_))})})}function iJ(e,t){return{eventCache:e,serverCache:t}}function iX(e,t,n,i){return iJ(new iK(t,n,i),e.serverCache)}function iQ(e,t,n,i){return iJ(e.eventCache,new iK(t,n,i))}function iZ(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function i0(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class i1{static fromObject(e){let t=new i1(null);return ng(e,(e,n)=>{t=t.set(new nH(e),n)}),t}constructor(e,t=(!c&&(c=new io(nd)),c)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:nV(),value:this.value};{if(n0(e))return null;let n=nK(e),i=this.children.get(n);if(null===i)return null;{let r=i.findRootMostMatchingPathAndValue(nY(e),t);return null!=r?{path:nZ(new nH(n),r.path),value:r.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(n0(e))return this;{let t=nK(e),n=this.children.get(t);return null!==n?n.subtree(nY(e)):new i1(null)}}set(e,t){if(n0(e))return new i1(t,this.children);{let n=nK(e),i=(this.children.get(n)||new i1(null)).set(nY(e),t),r=this.children.insert(n,i);return new i1(this.value,r)}}remove(e){if(n0(e))if(this.children.isEmpty())return new i1(null);else return new i1(null,this.children);{let t=nK(e),n=this.children.get(t);if(!n)return this;{let i,r=n.remove(nY(e));return(i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty())?new i1(null):new i1(this.value,i)}}}get(e){if(n0(e))return this.value;{let t=nK(e),n=this.children.get(t);return n?n.get(nY(e)):null}}setTree(e,t){if(n0(e))return t;{let n,i=nK(e),r=(this.children.get(i)||new i1(null)).setTree(nY(e),t);return n=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new i1(this.value,n)}}fold(e){return this.fold_(nV(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((i,r)=>{n[i]=r.fold_(nZ(e,i),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,nV(),t)}findOnPath_(e,t,n){let i=!!this.value&&n(t,this.value);if(i)return i;{if(n0(e))return null;let i=nK(e),r=this.children.get(i);return r?r.findOnPath_(nY(e),nZ(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,nV(),t)}foreachOnPath_(e,t,n){if(n0(e))return this;{this.value&&n(t,this.value);let i=nK(e),r=this.children.get(i);return r?r.foreachOnPath_(nY(e),nZ(t,i),n):new i1(null)}}foreach(e){this.foreach_(nV(),e)}foreach_(e,t){this.children.inorderTraversal((n,i)=>{i.foreach_(nZ(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class i2{constructor(e){this.writeTree_=e}static empty(){return new i2(new i1(null))}}function i3(e,t,n){if(n0(t))return new i2(new i1(n));{let i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){let r=i.path,s=i.value,o=n1(r,t);return s=s.updateChild(o,n),new i2(e.writeTree_.set(r,s))}{let i=new i1(n);return new i2(e.writeTree_.setTree(t,i))}}}function i5(e,t,n){let i=e;return ng(n,(e,n)=>{i=i3(i,nZ(t,e),n)}),i}function i4(e,t){return n0(t)?i2.empty():new i2(e.writeTree_.setTree(t,new i1(null)))}function i6(e,t){return null!=i8(e,t)}function i8(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(n1(n.path,t)):null}function i7(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(id,(e,n)=>{t.push(new n9(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new n9(e,n.value))}),t}function i9(e,t){if(n0(t))return e;{let n=i8(e,t);return new i2(null!=n?new i1(n):e.writeTree_.subtree(t))}}function re(e){return e.writeTree_.isEmpty()}function rt(e,t){return function e(t,n,i){if(null!=n.value)return i.updateChild(t,n.value);{let r=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(ei(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):i=e(nZ(t,n),s,i)}),i.getChild(t).isEmpty()||null===r||(i=i.updateChild(nZ(t,".priority"),r)),i}}(nV(),e.writeTree_,t)}function rn(e){return e.visible}function ri(e,t,n){let i=i2.empty();for(let r=0;r<e.length;++r){let s=e[r];if(t(s)){let e,t=s.path;if(s.snap)n3(n,t)?i=i3(i,e=n1(n,t),s.snap):n3(t,n)&&(e=n1(t,n),i=i3(i,nV(),s.snap.getChild(e)));else if(s.children){if(n3(n,t))i=i5(i,e=n1(n,t),s.children);else if(n3(t,n))if(n0(e=n1(t,n)))i=i5(i,nV(),s.children);else{let t=eM(s.children,nK(e));if(t){let n=t.getChild(nY(e));i=i3(i,nV(),n)}}}else throw er("WriteRecord should have .snap or .children")}}return i}function rr(e,t,n,i,r){if(i||r){let s=i9(e.visibleWrites,t);return!r&&re(s)?n:r||null!=n||i6(s,nV())?rt(ri(e.allWrites,function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(n3(e.path,t)||n3(t,e.path))},t),n||iy.EMPTY_NODE):null}{let i=i8(e.visibleWrites,t);if(null!=i)return i;{let i=i9(e.visibleWrites,t);return re(i)?n:null!=n||i6(i,nV())?rt(i,n||iy.EMPTY_NODE):null}}}function rs(e,t,n,i){return rr(e.writeTree,e.treePath,t,n,i)}function ro(e,t){return function(e,t,n){let i=iy.EMPTY_NODE,r=i8(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(id,(e,t)=>{i=i.updateImmediateChild(e,t)}),i;if(!n)return i7(i9(e.visibleWrites,t)).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i;{let r=i9(e.visibleWrites,t);return n.forEachChild(id,(e,t)=>{let n=rt(i9(r,new nH(e)),t);i=i.updateImmediateChild(e,n)}),i7(r).forEach(e=>{i=i.updateImmediateChild(e.name,e.node)}),i}}(e.writeTree,e.treePath,t)}function ra(e,t,n,i){return function(e,t,n,i,r){ei(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=nZ(t,n);if(i6(e.visibleWrites,s))return null;{let t=i9(e.visibleWrites,s);return re(t)?r.getChild(n):rt(t,r.getChild(n))}}(e.writeTree,e.treePath,t,n,i)}function rl(e,t){var n,i;return n=e.writeTree,i=nZ(e.treePath,t),i8(n.visibleWrites,i)}function rh(e,t,n){var i,r;let s,o;return i=e.writeTree,r=e.treePath,s=nZ(r,t),null!=(o=i8(i.visibleWrites,s))?o:n.isCompleteForChild(t)?rt(i9(i.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function rc(e,t){return ru(nZ(e.treePath,t),e.writeTree)}function ru(e,t){return{treePath:e,writeTree:t}}class rd{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;ei("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),ei(".priority"!==n,"Only non-priority child changes can be tracked.");let i=this.changeMap.get(n);if(i){let r=i.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(n,iS(n,e.snapshotNode,i.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(n,ik(n,i.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(n,iE(n,e.snapshotNode));else if("child_changed"===t&&"child_changed"===r)this.changeMap.set(n,iS(n,e.snapshotNode,i.oldSnap));else throw er("Illegal combination of changes: "+e+" occurred after "+i)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let rp=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class rf{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new iK(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return rh(this.writes_,e,t)}}getChildAfterChild(e,t,n){var i;let r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:i0(this.viewCache_),s=(i=this.writes_,function(e,t,n,i,r,s,o){let a,l=i9(e.visibleWrites,t),h=i8(l,nV());if(null!=h)a=h;else{if(null==n)return[];a=rt(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),r=n.getNext();for(;r&&e.length<1;)0!==t(r,i)&&e.push(r),r=n.getNext();return e}}(i.writeTree,i.treePath,r,t,1,n,e));return 0===s.length?null:s[0]}}function rm(e,t,n,i,r,s){let o=t.eventCache;if(null!=rl(i,n))return t;{let a,l;if(n0(n))if(ei(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=i0(t),r=ro(i,n instanceof iy?n:iy.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),r,s)}else{let n=rs(i,i0(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=nK(n);if(".priority"===h){ei(1===nG(n),"Can't have a priority with additional path components");let r=o.getNode(),s=ra(i,n,r,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(r,s):o.getNode()}else{let c,u=nY(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=ra(i,n,o.getNode(),l);c=null!=e?o.getNode().getImmediateChild(h).updateChild(u,e):o.getNode().getImmediateChild(h)}else c=rh(i,h,t.serverCache);a=null!=c?e.filter.updateChild(o.getNode(),h,c,u,r,s):o.getNode()}}return iX(t,a,o.isFullyInitialized()||n0(n),e.filter.filtersNodes())}}function rg(e,t,n,i,r,s,o,a){let l,h=t.serverCache,c=o?e.filter:e.filter.getIndexedFilter();if(n0(n))l=c.updateFullNode(h.getNode(),i,null);else if(c.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,i);l=c.updateFullNode(h.getNode(),e,null)}else{let e=nK(n);if(!h.isCompleteForPath(n)&&nG(n)>1)return t;let r=nY(n),s=h.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?c.updatePriority(h.getNode(),s):c.updateChild(h.getNode(),e,s,r,rp,null)}let u=iQ(t,l,h.isFullyInitialized()||n0(n),c.filtersNodes()),d=new rf(r,u,s);return rm(e,u,n,r,d,a)}function r_(e,t,n,i,r,s,o){let a,l,h=t.eventCache,c=new rf(r,t,s);if(n0(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),a=iX(t,l,!0,e.filter.filtersNodes());else{let r=nK(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),a=iX(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=nY(n),u=h.getNode().getImmediateChild(r);if(n0(l))s=i;else{let e=c.getCompleteChild(r);s=null!=e?".priority"===nJ(l)&&e.getChild(nQ(l)).isEmpty()?e:e.updateChild(l,i):iy.EMPTY_NODE}a=u.equals(s)?t:iX(t,e.filter.updateChild(h.getNode(),r,s,l,c,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function rv(e,t){return e.eventCache.isCompleteForChild(t)}function ry(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function rb(e,t,n,i,r,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=n0(n)?i:new i1(null).setTree(n,i);let c=t.serverCache.getNode();return l.children.inorderTraversal((n,i)=>{if(c.hasChild(n)){let l=ry(e,t.serverCache.getNode().getImmediateChild(n),i);h=rg(e,h,new nH(n),l,r,s,o,a)}}),l.children.inorderTraversal((n,i)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!c.hasChild(n)&&!l){let l=ry(e,t.serverCache.getNode().getImmediateChild(n),i);h=rg(e,h,new nH(n),l,r,s,o,a)}}),h}class rw{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new ix(n.getIndex()),r=function(e){return e.loadsAllData()?new ix(e.getIndex()):e.hasLimit()?new iR(e):new iP(e)}(n);this.processor_={filter:r};const s=t.serverCache,o=t.eventCache,a=i.updateFullNode(iy.EMPTY_NODE,s.getNode(),null),l=r.updateFullNode(iy.EMPTY_NODE,o.getNode(),null),h=new iK(a,s.isFullyInitialized(),i.filtersNodes()),c=new iK(l,o.isFullyInitialized(),r.filtersNodes());this.viewCache_=iJ(c,h),this.eventGenerator_=new iG(this.query_)}get query(){return this.query_}}function rC(e){return 0===e.eventRegistrations_.length}function rI(e,t,n){let i=[];if(n){ei(null==t,"A cancel should cancel all event registrations.");let r=e.query._path;e.eventRegistrations_.forEach(e=>{let t=e.createCancelEvent(n,r);t&&i.push(t)})}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){let r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function rT(e,t,n,i){var r,s;t.type===E.MERGE&&null!==t.source.queryId&&(ei(i0(e.viewCache_),"We should always have a full cache before handling merges"),ei(iZ(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,i,r){var s,o,a,l,h,c,u,d,p,f,m,g;let _,v,y=new rd;if(n.type===E.OVERWRITE)n.source.fromUser?_=r_(e,t,n.path,n.snap,i,r,y):(ei(n.source.fromServer,"Unknown source."),v=n.source.tagged||t.serverCache.isFiltered()&&!n0(n.path),_=rg(e,t,n.path,n.snap,i,r,v,y));else if(n.type===E.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=i,c=r,u=y,d=o,l.foreach((e,t)=>{let n=nZ(a,e);rv(o,nK(n))&&(d=r_(s,d,n,t,h,c,u))}),l.foreach((e,t)=>{let n=nZ(a,e);rv(o,nK(n))||(d=r_(s,d,n,t,h,c,u))}),_=d):(ei(n.source.fromServer,"Unknown source."),v=n.source.tagged||t.serverCache.isFiltered(),_=rb(e,t,n.path,n.children,i,r,v,y))}else if(n.type===E.ACK_USER_WRITE)_=n.revert?function(e,t,n,i,r,s){let o;if(null!=rl(i,n))return t;{let a,l=new rf(i,t,r),h=t.eventCache.getNode();if(n0(n)||".priority"===nK(n)){let n;if(t.serverCache.isFullyInitialized())n=rs(i,i0(t));else{let e=t.serverCache.getNode();ei(e instanceof iy,"serverChildren would be complete if leaf node"),n=ro(i,e)}a=e.filter.updateFullNode(h,n,s)}else{let r=nK(n),c=rh(i,r,t.serverCache);null==c&&t.serverCache.isCompleteForChild(r)&&(c=h.getImmediateChild(r)),(a=null!=c?e.filter.updateChild(h,r,c,nY(n),l,s):t.eventCache.getNode().hasChild(r)?e.filter.updateChild(h,r,iy.EMPTY_NODE,nY(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=rs(i,i0(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=rl(i,nV()),iX(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,i,r,y):function(e,t,n,i,r,s,o){if(null!=rl(r,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=i.value)if(n0(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return rg(e,t,n,l.getNode().getChild(n),r,s,a,o);else{if(!n0(n))return t;let i=new i1(null);return l.getNode().forEachChild(ii,(e,t)=>{i=i.set(new nH(e),t)}),rb(e,t,n,i,r,s,a,o)}{let h=new i1(null);return i.foreach((e,t)=>{let i=nZ(n,e);l.isCompleteForPath(i)&&(h=h.set(e,l.getNode().getChild(i)))}),rb(e,t,n,h,r,s,a,o)}}(e,t,n.path,n.affectedTree,i,r,y);else if(n.type===E.LISTEN_COMPLETE){let r;d=e,p=t,f=n.path,m=i,g=y,r=p.serverCache,_=rm(d,iQ(p,r.getNode(),r.isFullyInitialized()||n0(f),r.isFiltered()),f,m,rp,g)}else throw er("Unknown operation type: "+n.type);let b=y.getChanges();return function(e,t,n){let i=t.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=iZ(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!r||i.getNode().equals(s))&&i.getNode().getPriority().equals(s.getPriority())||n.push(iT(iZ(t)))}}(t,_,b),{viewCache:_,changes:b}}(e.processor_,o,t,n,i);return r=e.processor_,ei((s=a.viewCache).eventCache.getNode().isIndexed(r.filter.getIndex()),"Event snap not indexed"),ei(s.serverCache.getNode().isIndexed(r.filter.getIndex()),"Server snap not indexed"),ei(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,rE(e,a.changes,a.viewCache.eventCache.getNode(),null)}function rE(e,t,n,i){var r;let s,o,a=i?[i]:e.eventRegistrations_;return r=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),iY(r,s,"child_removed",t,a,n),iY(r,s,"child_added",t,a,n),iY(r,s,"child_moved",o,a,n),iY(r,s,"child_changed",t,a,n),iY(r,s,"value",t,a,n),s}class rk{constructor(){this.views=new Map}}function rS(e,t,n,i){let r=t.source.queryId;if(null!==r){let s=e.views.get(r);return ei(null!=s,"SyncTree gave us an op for an invalid query."),rT(s,t,n,i)}{let r=[];for(let s of e.views.values())r=r.concat(rT(s,t,n,i));return r}}function rx(e){let t=[];for(let n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function rP(e,t){let n=null;for(let i of e.views.values())n=n||function(e,t){let n=i0(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!n0(t)&&!n.getImmediateChild(nK(t)).isEmpty())?n.getChild(t):null}(i,t);return n}function rR(e,t){if(t._queryParams.loadsAllData())return rA(e);{let n=t._queryIdentifier;return e.views.get(n)}}function rN(e){return null!=rA(e)}function rA(e){for(let t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let rO=1;class rD{constructor(e){this.listenProvider_=e,this.syncPointTree_=new i1(null),this.pendingWriteTree_={visibleWrites:i2.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function rL(e,t,n,i,r){var s,o;return(s=e.pendingWriteTree_,o=r,ei(i>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:i,visible:o}),o&&(s.visibleWrites=i3(s.visibleWrites,t,n)),s.lastWriteId=i,r)?rW(e,new iH(iB(),t,n)):[]}function rM(e,t,n=!1){let i=function(e,t){for(let n=0;n<e.allWrites.length;n++){let i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let i=e.allWrites.findIndex(e=>e.writeId===t);ei(i>=0,"removeWrite called with nonexistent writeId.");let r=e.allWrites[i];e.allWrites.splice(i,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=i&&function(e,t){if(e.snap)return n3(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&n3(nZ(e.path,n),t))return!0;return!1}(t,r.path)?s=!1:n3(r.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=ri(n.allWrites,rn,nV()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):r.snap?e.visibleWrites=i4(e.visibleWrites,r.path):ng(r.children,t=>{e.visibleWrites=i4(e.visibleWrites,nZ(r.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new i1(null);return null!=i.snap?t=t.set(nV(),!0):ng(i.children,e=>{t=t.set(new nH(e),!0)}),rW(e,new iz(i.path,t,n))}}function rF(e,t,n){return rW(e,new iH(iW(),t,n))}function rj(e,t,n,i,r=!1){let s=t._path,o=e.syncPointTree_.get(s),a=[];if(o&&("default"===t._queryIdentifier||null!=rR(o,t))){let c=function(e,t,n,i){let r=t._queryIdentifier,s=[],o=[],a=rN(e);if("default"===r)for(let[t,r]of e.views.entries())o=o.concat(rI(r,n,i)),rC(r)&&(e.views.delete(t),r.query._queryParams.loadsAllData()||s.push(r.query));else{let t=e.views.get(r);t&&(o=o.concat(rI(t,n,i)),rC(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!rN(e)&&s.push(new(ei(u,"Reference.ts has not been loaded"),u)(t._repo,t._path)),{removed:s,events:o}}(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));let d=c.removed;if(a=c.events,!r){let n=-1!==d.findIndex(e=>e._queryParams.loadsAllData()),r=e.syncPointTree_.findOnPath(s,(e,t)=>rN(t));if(n&&!r){let t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){let n=t.fold((e,t,n)=>{if(t&&rN(t))return[rA(t)];{let e=[];return t&&(e=rx(t)),ng(n,(t,n)=>{e=e.concat(n)}),e}});for(let t=0;t<n.length;++t){let i=n[t],r=i.query,s=rq(e,i);e.listenProvider_.startListening(rG(r),rz(e,r),s.hashFn,s.onComplete)}}}r||!(d.length>0)||i||(n?e.listenProvider_.stopListening(rG(t),null):d.forEach(t=>{let n=e.queryToTagMap.get(r$(t));e.listenProvider_.stopListening(rG(t),n)}))}var l=e,h=d;for(let e=0;e<h.length;++e){let t=h[e];if(!t._queryParams.loadsAllData()){let e=r$(t),n=l.queryToTagMap.get(e);l.queryToTagMap.delete(e),l.tagToQueryMap.delete(n)}}}return a}function rU(e,t,n,i=!1){var r;let s,o,a,l,h=t._path,c=null,u=!1;e.syncPointTree_.foreachOnPath(h,(e,t)=>{let n=n1(e,h);c=c||rP(t,n),u=u||rN(t)});let d=e.syncPointTree_.get(h);d?(u=u||rN(d),c=c||rP(d,nV())):(d=new rk,e.syncPointTree_=e.syncPointTree_.set(h,d)),null!=c?s=!0:(s=!1,c=iy.EMPTY_NODE,e.syncPointTree_.subtree(h).foreachChild((e,t)=>{let n=rP(t,nV());n&&(c=c.updateImmediateChild(e,n))}));let p=null!=rR(d,t);if(!p&&!t._queryParams.loadsAllData()){let n=r$(t);ei(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");let i=rO++;e.queryToTagMap.set(n,i),e.tagToQueryMap.set(i,n)}let f=ru(h,e.pendingWriteTree_),m=(o=function(e,t,n,i,r){let s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=rs(n,r?i:null),s=!1;return e?s=!0:(e=i instanceof iy?ro(n,i):iy.EMPTY_NODE,s=!1),new rw(t,iJ(new iK(e,s,!1),new iK(i,r,!1)))}return o}(r=d,t,f,c,s),r.views.has(t._queryIdentifier)||r.views.set(t._queryIdentifier,o),o.eventRegistrations_.push(n),a=o.viewCache_.eventCache,l=[],a.getNode().isLeafNode()||a.getNode().forEachChild(id,(e,t)=>{l.push(iE(e,t))}),a.isFullyInitialized()&&l.push(iT(a.getNode())),rE(o,l,a.getNode(),n));if(!p&&!u&&!i){let n=rR(d,t);m=m.concat(function(e,t,n){let i=t._path,r=rz(e,t),s=rq(e,n),o=e.listenProvider_.startListening(rG(t),r,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(i);if(r)ei(!rN(a.value),"If we're adding a query, it shouldn't be shadowed");else{let t=a.fold((e,t,n)=>{if(!n0(e)&&t&&rN(t))return[rA(t).query];{let e=[];return t&&(e=e.concat(rx(t).map(e=>e.query))),ng(n,(t,n)=>{e=e.concat(n)}),e}});for(let n=0;n<t.length;++n){let i=t[n];e.listenProvider_.stopListening(rG(i),rz(e,i))}}return o}(e,t,n))}return m}function rB(e,t,n){let i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,(e,n)=>{let i=rP(n,n1(e,t));if(i)return i});return rr(i,t,r,n,!0)}function rW(e,t){var n;return function e(t,n,i,r){if(n0(t.path))return function e(t,n,i,r){let s=n.get(nV());null==i&&null!=s&&(i=rP(s,nV()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=i?i.getImmediateChild(n):null,l=rc(r,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(rS(s,t,r,i))),o}(t,n,i,r);{let s=n.get(nV());null==i&&null!=s&&(i=rP(s,nV()));let o=[],a=nK(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=i?i.getImmediateChild(a):null,n=rc(r,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(rS(s,t,r,i))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,ru(nV(),n)))}function rq(e,t){let n=t.query,i=rz(e,n);return{hashFn:()=>(t.viewCache_.serverCache.getNode()||iy.EMPTY_NODE).hash(),onComplete:t=>{var r;if("ok"===t)if(i)return function(e,t,n){let i=rH(e,n);if(!i)return[];{let n=rV(i),r=n.path,s=n.queryId,o=n1(r,t);return rK(e,r,new i$(iq(s),o))}}(e,n._path,i);else return r=n._path,rW(e,new i$(iW(),r));{let i,r,s=(i="Unknown Error","too_big"===t?i="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?i="Client doesn't have permission to access the desired data.":"unavailable"===t&&(i="The service is unavailable"),(r=Error(t+" at "+n._path.toString()+": "+i)).code=t.toUpperCase(),r);return rj(e,n,null,s)}}}}function rz(e,t){let n=r$(t);return e.queryToTagMap.get(n)}function r$(e){return e._path.toString()+"$"+e._queryIdentifier}function rH(e,t){return e.tagToQueryMap.get(t)}function rV(e){let t=e.indexOf("$");return ei(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new nH(e.substr(0,t))}}function rK(e,t,n){let i=e.syncPointTree_.get(t);return ei(i,"Missing sync point for query tag that we're tracking"),rS(i,n,ru(t,e.pendingWriteTree_),null)}function rG(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(ei(d,"Reference.ts has not been loaded"),d)(e._repo,e._path):e}class rY{constructor(e){this.node_=e}getImmediateChild(e){return new rY(this.node_.getImmediateChild(e))}node(){return this.node_}}class rJ{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=nZ(this.path_,e);return new rJ(this.syncTree_,t)}node(){return rB(this.syncTree_,this.path_)}}let rX=function(e,t,n){return e&&"object"==typeof e?(ei(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?rQ(e[".sv"],t,n):"object"==typeof e[".sv"]?rZ(e[".sv"],t):void ei(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},rQ=function(e,t,n){if("timestamp"===e)return n.timestamp;ei(!1,"Unexpected server value: "+e)},rZ=function(e,t,n){e.hasOwnProperty("increment")||ei(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let i=e.increment;"number"!=typeof i&&ei(!1,"Unexpected increment value: "+i);let r=t.node();if(ei(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let s=r.getValue();return"number"!=typeof s?i:s+i},r0=function(e,t,n){return r1(e,new rY(t),n)};function r1(e,t,n){let i,r=rX(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return i=e,r!==e.getPriority().val()&&(i=i.updatePriority(new iu(r))),e.forEachChild(id,(e,r)=>{let s=r1(r,t.getImmediateChild(e),n);s!==r&&(i=i.updateImmediateChild(e,s))}),i;{let i=rX(e.getValue(),t,n);return i!==e.getValue()||r!==e.getPriority().val()?new iu(i,iw(r)):e}}class r2{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function r3(e,t){let n=t instanceof nH?t:new nH(t),i=e,r=nK(n);for(;null!==r;){let e=eM(i.node.children,r)||{children:{},childCount:0};i=new r2(r,i,e),r=nK(n=nY(n))}return i}function r5(e){return e.node.value}function r4(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,i){let r=void 0===r5(i)&&!r6(i),s=eL(t.node.children,n);r&&s?(delete t.node.children[n],t.node.childCount--,e(t)):r||s||(t.node.children[n]=i.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function r6(e){return e.node.childCount>0}function r8(e,t){ng(e.node.children,(n,i)=>{t(new r2(n,e,i))})}function r7(e){return new nH(null===e.parent?e.name:r7(e.parent)+"/"+e.name)}let r9=/[\[\].#$\/\u0000-\u001F\u007F]/,se=/[\[\].#$\u0000-\u001F\u007F]/,st=function(e){return"string"==typeof e&&0!==e.length&&!r9.test(e)},sn=function(e){return"string"==typeof e&&0!==e.length&&!se.test(e)},si=function(e,t,n,i){i&&void 0===t||sr(eK(e,"value"),t,n)},sr=function(e,t,n){let i=n instanceof nH?new n5(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+n6(i));if("function"==typeof t)throw Error(e+"contains a function "+n6(i)+" with contents = "+t.toString());if(na(t))throw Error(e+"contains "+t.toString()+" "+n6(i));if("string"==typeof t&&t.length>3495253.3333333335&&eY(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+n6(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(ng(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!st(t)))throw Error(e+" contains an invalid key ("+t+") "+n6(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.parts_.length>0&&(i.byteLength_+=1),i.parts_.push(t),i.byteLength_+=eY(t),n4(i),sr(e,s,i),o=i.parts_.pop(),i.byteLength_-=eY(o),i.parts_.length>0&&(i.byteLength_-=1)}),n&&r)throw Error(e+' contains ".value" child '+n6(i)+" in addition to actual children.")}},ss=function(e,t,n,i){if((!i||void 0!==n)&&!sn(n))throw Error(eK(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},so=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ss(e,t,n,i)},sa=function(e,t){if(".info"===nK(t))throw Error(e+" failed = Can't modify data under /.info/")},sl=function(e,t){var n;let i=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!st(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==i.length&&((n=i)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),!sn(n)))throw Error(eK(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class sh{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function sc(e,t){let n=null;for(let i=0;i<t.length;i++){let r=t[i],s=r.getPath();null===n||n2(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function su(e,t,n){sc(e,n),sp(e,e=>n2(e,t))}function sd(e,t,n){sc(e,n),sp(e,e=>n3(e,t)||n3(t,e))}function sp(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){let r=e.eventLists_[i];r&&(t(r.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let i=n.getEventRunner();t7&&nt("event: "+n.toString()),nb(i)}}}(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}class sf{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new sh,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=iM(),this.transactionQueueTree_=new r2,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function sm(e){let t=e.infoData_.getNode(new nH(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function sg(e){var t;return(t=t={timestamp:sm(e)}).timestamp=t.timestamp||new Date().getTime(),t}function s_(e,t,n,i,r){e.dataUpdateCount++;let s=new nH(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){let t=ej(n,e=>iw(e));o=function(e,t,n,i){let r=rH(e,i);if(!r)return[];{let i=rV(r),s=i.path,o=i.queryId,a=n1(s,t),l=i1.fromObject(n);return rK(e,s,new iV(iq(o),a,l))}}(e.serverSyncTree_,s,t,r)}else{let t=iw(n);o=function(e,t,n,i){let r=rH(e,i);if(null==r)return[];{let i=rV(r),s=i.path,o=i.queryId,a=n1(s,t);return rK(e,s,new iH(iq(o),a,n))}}(e.serverSyncTree_,s,t,r)}else if(i){var a;let t,i=ej(n,e=>iw(e));a=e.serverSyncTree_,t=i1.fromObject(i),o=rW(a,new iV(iW(),s,t))}else{let t=iw(n);o=rF(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=sT(e,s)),sd(e.eventQueue_,l,o)}function sv(e,t){var n;let i,r,s;sy(e,"connected",t),!1===t&&(sC(n=e,"onDisconnectEvents"),i=sg(n),r=iM(),iF(n.onDisconnect_,nV(),(e,t)=>{var s;let o=(s=n.serverSyncTree_,r1(t,new rJ(s,e),i));!function e(t,n,i){if(n0(n))t.value=i,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,i);else{let r=nK(n);t.children.has(r)||t.children.set(r,iM()),e(t.children.get(r),n=nY(n),i)}}(r,e,o)}),s=[],iF(r,nV(),(e,t)=>{s=s.concat(rF(n.serverSyncTree_,e,t));let i=sx(n,e);sT(n,i)}),n.onDisconnect_=iM(),sd(n.eventQueue_,nV(),s))}function sy(e,t,n){let i=new nH("/.info/"+t),r=iw(n);e.infoData_.updateSnapshot(i,r);let s=rF(e.infoSyncTree_,i,r);sd(e.eventQueue_,i,s)}function sb(e){return e.nextWriteId_++}function sw(e,t,n){let i;i=".info"===nK(t._path)?rj(e.infoSyncTree_,t,n):rj(e.serverSyncTree_,t,n),su(e.eventQueue_,t._path,i)}function sC(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),nt(n,...t)}function sI(e,t,n){return rB(e.serverSyncTree_,t,n)||iy.EMPTY_NODE}function sT(e,t){let n=sE(e,t),i=r7(n),r=sk(e,n);return function(e,t,n){if(0===t.length)return;let i=[],r=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=n1(n,a.path),h=!1,c;if(ei(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,c=a.abortReason,r=r.concat(rM(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,c="maxretry",r=r.concat(rM(e.serverSyncTree_,a.currentWriteId,!0));else{let n=sI(e,a.path,s);a.currentInputSnapshot=n;let i=t[o].update(n.val());if(void 0!==i){sr("transaction failed: Data returned ",i,a.path);let t=iw(i);"object"==typeof i&&null!=i&&eL(i,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=r0(t,n,sg(e));a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=l,a.currentWriteId=sb(e),s.splice(s.indexOf(o),1),r=(r=r.concat(rL(e.serverSyncTree_,a.path,l,a.currentWriteId,a.applyLocally))).concat(rM(e.serverSyncTree_,o,!0))}else h=!0,c="nodata",r=r.concat(rM(e.serverSyncTree_,a.currentWriteId,!0))}sd(e.eventQueue_,n,r),r=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===c?i.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):i.push(()=>t[o].onComplete(Error(c),!1,null))))}sS(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)nb(i[e]);!function e(t,n=t.transactionQueueTree_){if(n||sS(t,n),r5(n)){let i=sk(t,n);ei(i.length>0,"Sending zero length transaction queue"),i.every(e=>0===e.status)&&function(t,n,i){let r=sI(t,n,i.map(e=>e.currentWriteId)),s=r,o=r.hash();for(let e=0;e<i.length;e++){let t=i[e];ei(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let r=n1(n,t.path);s=s.updateChild(r,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,r=>{sC(t,"transaction put response",{path:n.toString(),status:r});let s=[];if("ok"===r){let r=[];for(let e=0;e<i.length;e++)i[e].status=2,s=s.concat(rM(t.serverSyncTree_,i[e].currentWriteId)),i[e].onComplete&&r.push(()=>i[e].onComplete(null,!0,i[e].currentOutputSnapshotResolved)),i[e].unwatcher();sS(t,r3(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),sd(t.eventQueue_,n,s);for(let e=0;e<r.length;e++)nb(r[e])}else{if("datastale"===r)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{ns("transaction at "+n.toString()+" failed: "+r);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=r}sT(t,n)}},o)}(t,r7(n),i)}else r6(n)&&r8(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,r,i),i}function sE(e,t){let n,i=e.transactionQueueTree_;for(n=nK(t);null!==n&&void 0===r5(i);)i=r3(i,n),n=nK(t=nY(t));return i}function sk(e,t){let n=[];return function e(t,n,i){let r=r5(n);if(r)for(let e=0;e<r.length;e++)i.push(r[e]);r8(n,n=>{e(t,n,i)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function sS(e,t){let n=r5(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,r4(t,n.length>0?n:void 0)}r8(t,t=>{sS(e,t)})}function sx(e,t){let n=r7(sE(e,t)),i=r3(e.transactionQueueTree_,t);return!function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,t=>{sP(e,t)}),sP(e,i),!function e(t,n,i,r){i&&!r&&n(t),r8(t,t=>{e(t,n,!0,r)}),i&&r&&n(t)}(i,t=>{sP(e,t)}),n}function sP(e,t){let n=r5(t);if(n){let i=[],r=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(ei(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(ei(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),r=r.concat(rM(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&i.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?r4(t,void 0):n.length=s+1,sd(e.eventQueue_,r7(t),r);for(let e=0;e<i.length;e++)nb(i[e])}}let sR=function(e,t){let n=sN(e),i=n.namespace;"firebase.com"===n.domain&&nr(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||nr("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||no();let r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new nx(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new nH(n.pathString)}},sN=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let c=e.indexOf("/");-1===c&&(c=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(c,u)),c<u&&(r=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(c,u)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):ns(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let p=t.slice(0,h);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{let e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},sA="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",sO=(v=0,y=[],function(e){let t,n=e===v;v=e;let i=Array(8);for(t=7;t>=0;t--)i[t]=sA.charAt(e%64),e=Math.floor(e/64);ei(0===e,"Cannot push at time == 0");let r=i.join("");if(n){for(t=11;t>=0&&63===y[t];t--)y[t]=0;y[t]++}else for(t=0;t<12;t++)y[t]=Math.floor(64*Math.random());for(t=0;t<12;t++)r+=sA.charAt(y[t]);return ei(20===r.length,"nextPushId: Length should be 20."),r});class sD{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){let e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+eN(this.snapshot.exportVal())}}class sL{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class sM{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return ei(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class sF{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return n0(this._path)?null:nJ(this._path)}get ref(){return new sj(this._repo,this._path)}get _queryIdentifier(){let e=nf(iO(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return iO(this._queryParams)}isEqual(e){if(!((e=eJ(e))instanceof sF))return!1;let t=this._repo===e._repo,n=n2(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class sj extends sF{constructor(e,t){super(e,t,new iN,!1)}get parent(){let e=nQ(this._path);return null===e?null:new sj(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class sU{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new nH(e),n=sW(this.ref,e);return new sU(this._node.getChild(t),n,id)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(t,n)=>e(new sU(n,sW(this.ref,t),id)))}hasChild(e){let t=new nH(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function sB(e,t){return(e=eJ(e))._checkNotDeleted("ref"),void 0!==t?sW(e._root,t):e._root}function sW(e,t){return null===nK((e=eJ(e))._path)?so("child","path",t,!1):ss("child","path",t,!1),new sj(e._repo,nZ(e._path,t))}function sq(e,t){let n;sa("push",(e=eJ(e))._path),si("push",t,e._path,!0);let i=sO(sm(e._repo)),r=sW(e,i),s=sW(e,i);return r.then=(n=null!=t?sz(s,t).then(()=>s):Promise.resolve(s)).then.bind(n),r.catch=n.then.bind(n,void 0),r}function sz(e,t){var n,i,r;let s,o,a,l,h,c;sa("set",(e=eJ(e))._path),si("set",t,e._path,!1);let u=new eg;return n=e._repo,i=e._path,r=u.wrapCallback(()=>{}),sC(n,"set",{path:i.toString(),value:t,priority:null}),s=sg(n),a=r0(o=iw(t,null),rB(n.serverSyncTree_,i),s),l=sb(n),h=rL(n.serverSyncTree_,i,a,l,!0),sc(n.eventQueue_,h),n.server_.put(i.toString(),o.val(!0),(e,t)=>{var s,o,a;let h="ok"===e;h||ns("set at "+i+" failed: "+e);let c=rM(n.serverSyncTree_,l,!h);sd(n.eventQueue_,i,c),s=r,o=e,a=t,s&&nb(()=>{if("ok"===o)s(null);else{let e=(o||"error").toUpperCase(),t=e;a&&(t+=": "+a);let n=Error(t);n.code=e,s(n)}})}),c=sx(n,i),sT(n,c),sd(n.eventQueue_,c,[]),u.promise}class s${constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){let n=t._queryParams.getIndex();return new sD("value",this,new sU(e.snapshotNode,new sj(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sL(this,e,t):null}matches(e){return e instanceof s$&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class sH{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new sL(this,e,t):null}createEvent(e,t){ei(null!=e.childName,"Child events should have a childName.");let n=sW(new sj(t._repo,t._path),e.childName),i=t._queryParams.getIndex();return new sD(e.type,this,new sU(e.snapshotNode,n,i),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof sH&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function sV(e,t,n,i){return function(e,t,n,i,r){var s;let o,a;if("object"==typeof i&&(o=void 0,r=i),"function"==typeof i&&(o=i),r&&r.onlyOnce){let t=n,i=(n,i)=>{sw(e._repo,e,h),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}let l=new sM(n,o||void 0),h="value"===t?new s$(l):new sH(t,l);return s=e._repo,a=".info"===nK(e._path)?rU(s.infoSyncTree_,e,h):rU(s.serverSyncTree_,e,h),su(s.eventQueue_,e._path,a),()=>sw(e._repo,e,h)}(e,"value",t,n,i)}ei(!u,"__referenceConstructor has already been defined"),u=sj,ei(!d,"__referenceConstructor has already been defined"),d=sj;let sK={};class sG{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var i;let r;if(e.stats_=nO(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new iD(e.repoInfo_,(t,n,i,r)=>{s_(e,t,n,i,r)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>sv(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{eN(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new n7(e.repoInfo_,t,(t,n,i,r)=>{s_(e,t,n,i,r)},t=>{sv(e,t)},t=>{var n;n=e,ng(t,(e,t)=>{sy(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),i=e.repoInfo_,nA[r=i.toString()]||(nA[r]=(()=>new iU(e.stats_,e.server_))()),e.statsReporter_=nA[r],e.infoData_=new iL,e.infoSyncTree_=new rD({startListening:(t,n,i,r)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=rF(e.infoSyncTree_,t._path,o),setTimeout(()=>{r("ok")},0)),s},stopListening:()=>{}}),sy(e,"connected",!1),e.serverSyncTree_=new rD({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,(n,i)=>{let s=r(n,i);sd(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new sj(this._repo,nV())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=sK[t=this.app.name])&&n[e.key]===e||nr(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&nr("Cannot call "+e+" on a deleted database.")}}function sY(e=tD(),t){let n=tw(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){let e=(e=>{let t=ep(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]})("database");e&&function(e,t,n,i={}){var r;let s,o,a;(e=eJ(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eU(i,h.repoInfo_.emulatorOptions))return;nr("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(i.mockUserToken&&nr('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new nT(nT.OWNER)):i.mockUserToken&&(s=new nT("string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...e};return[ec(JSON.stringify({alg:"none",type:"JWT"})),ec(JSON.stringify(s)),""].join(".")}(i.mockUserToken,e.app.options.projectId))),e_(t)&&(ev(t),ew("Database",!0)),r=s,o=l.lastIndexOf(":"),a=e_(l.substring(0,o)),h.repoInfo_=new nx(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,i),r&&(h.authTokenProvider_=r)}(n,...e)}return n}function sJ(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}n7.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},n7.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},tQ=tN,tb(new eX("database",(e,{instanceIdentifier:t})=>{var n,i,r,s;let o,a,l,h,c,u,d,p=e.getProvider("app").getImmediate(),f=e.getProvider("auth-internal"),m=e.getProvider("app-check-internal");return void 0===(l=t||p.options.databaseURL)&&(p.options.projectId||nr("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),nt("Using default host for project ",p.options.projectId),l=`${p.options.projectId}-default-rtdb.firebaseio.com`),c=(h=sR(l,void 0)).repoInfo,void 0!==B.default&&B.default.env&&(u=B.default.env.FIREBASE_DATABASE_EMULATOR_HOST),u?c=(h=sR(l=`http://${u}?ns=${c.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new nI(p.name,p.options,f),sl("Invalid Firebase Database URL",h),n0(h.path)||nr("Database URL must point to the root of a Firebase Database (not including a child path)."),new sG((n=c,i=p,r=d,s=new nC(p,m),(o=sK[i.name])||(o={},sK[i.name]=o),(a=o[n.toURLString()])&&nr("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new sf(n,!1,r,s),o[n.toURLString()]=a,a),p)},"PUBLIC").setMultipleInstances(!0)),tF(tJ,tX,void 0),tF(tJ,tX,"esm2020");let sX=new ex("auth","Firebase",sJ()),sQ=new e6("@firebase/auth");function sZ(e,...t){sQ.logLevel<=T.ERROR&&sQ.error(`Auth (${tN}): ${e}`,...t)}function s0(e,...t){throw s5(e,...t)}function s1(e,...t){return s5(e,...t)}function s2(e,t,n){return new ex("auth","Firebase",{...sJ(),[t]:n}).create(t,{appName:e.name})}function s3(e){return s2(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function s5(e,...t){if("string"!=typeof e){let n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return sX.create(e,...t)}function s4(e,t,...n){if(!e)throw s5(t,...n)}function s6(e){let t="INTERNAL ASSERTION FAILED: "+e;throw sZ(t),Error(t)}function s8(){return"undefined"!=typeof self&&self.location?.href||""}function s7(){return"undefined"!=typeof self&&self.location?.protocol||null}class s9{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||s6(n),this.isMobile=eI()||eE()}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===s7()||"https:"===s7()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function oe(e,t){var n,i;n=e.emulator,i="Emulator should always be set here",n||s6(i);let{url:r}=e.emulator;return t?`${r}${t.startsWith("/")?t.slice(1):t}`:r}class ot{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void s6("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void s6("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void s6("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let on={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},oi=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],or=new s9(3e4,6e4);function os(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function oo(e,t,n,i,r={}){return oa(e,r,async()=>{let r={},s={};i&&("GET"===t?s=i:r={body:JSON.stringify(i)});let o=eW({key:e.config.apiKey,...s}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:a,...r};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&e_(e.emulatorConfig.host)&&(l.credentials="include"),ot.fetch()(await oh(e,e.config.apiHost,n,o),l)})}async function oa(e,t,n){e._canInitEmulator=!1;let i={...on,...t};try{let t=new oc(e),r=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await r.json();if("needConfirmation"in s)throw ou(e,"account-exists-with-different-credential",s);if(r.ok&&!("errorMessage"in s))return s;{let[t,n]=(r.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw ou(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw ou(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw ou(e,"user-disabled",s);let o=i[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw s2(e,o,n);s0(e,o)}}catch(t){if(t instanceof eS)throw t;s0(e,"network-request-failed",{message:String(t)})}}async function ol(e,t,n,i,r={}){let s=await oo(e,t,n,i,r);return"mfaPendingCredential"in s&&s0(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function oh(e,t,n,i){let r=`${t}${n}?${i}`,s=e.config.emulator?oe(e.config,r):`${e.config.apiScheme}://${r}`;return oi.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class oc{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(s1(this.auth,"network-request-failed")),or.get())})}}function ou(e,t,n){let i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);let r=s1(e,t,i);return r.customData._tokenResponse=n,r}function od(e){return void 0!==e&&void 0!==e.enterprise}class op{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function of(e,t){return oo(e,"GET","/v2/recaptchaConfig",os(e,t))}async function om(e,t){return oo(e,"POST","/v1/accounts:delete",t)}async function og(e,t){return oo(e,"POST","/v1/accounts:lookup",t)}function o_(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function ov(e,t=!1){let n=eJ(e),i=await n.getIdToken(t),r=ob(i);s4(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");let s="object"==typeof r.firebase?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:o_(oy(r.auth_time)),issuedAtTime:o_(oy(r.iat)),expirationTime:o_(oy(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function oy(e){return 1e3*Number(e)}function ob(e){let[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return sZ("JWT malformed, contained fewer than 3 sections"),null;try{let e=eu(n);if(!e)return sZ("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return sZ("Caught error parsing JWT payload as JSON",e?.toString()),null}}function ow(e){let t=ob(e);return s4(t,"internal-error"),s4(void 0!==t.exp,"internal-error"),s4(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function oC(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof eS&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class oI{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class oT{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=o_(this.lastLoginAt),this.creationTime=o_(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function oE(e){var t,n;let i=e.auth,r=await e.getIdToken(),s=await oC(e,og(i,{idToken:r}));s4(s?.users.length,i,"internal-error");let o=s.users[0];e._notifyReloadListener(o);let a=o.providerUserInfo?.length?oS(o.providerUserInfo):[],l=(t=e.providerData,n=a,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),h=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!l?.length;Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new oT(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&c})}async function ok(e){let t=eJ(e);await oE(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function oS(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function ox(e,t){let n=await oa(e,{},async()=>{let n=eW({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,s=await oh(e,i,"/v1/token",`key=${r}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";let a={method:"POST",headers:o,body:n};return e.emulatorConfig&&e_(e.emulatorConfig.host)&&(a.credentials="include"),ot.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function oP(e,t){return oo(e,"POST","/v2/accounts:revokeToken",os(e,t))}class oR{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){s4(e.idToken,"internal-error"),s4(void 0!==e.idToken,"internal-error"),s4(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):ow(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){s4(0!==e.length,"internal-error");let t=ow(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(s4(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:i,expiresIn:r}=await ox(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:i,expirationTime:r}=t,s=new oR;return n&&(s4("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),i&&(s4("string"==typeof i,"internal-error",{appName:e}),s.accessToken=i),r&&(s4("number"==typeof r,"internal-error",{appName:e}),s.expirationTime=r),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new oR,this.toJSON())}_performRefresh(){return s6("not implemented")}}function oN(e,t){s4("string"==typeof e||void 0===e,"internal-error",{appName:t})}class oA{constructor({uid:e,auth:t,stsTokenManager:n,...i}){this.providerId="firebase",this.proactiveRefresh=new oI(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=i.displayName||null,this.email=i.email||null,this.emailVerified=i.emailVerified||!1,this.phoneNumber=i.phoneNumber||null,this.photoURL=i.photoURL||null,this.isAnonymous=i.isAnonymous||!1,this.tenantId=i.tenantId||null,this.providerData=i.providerData?[...i.providerData]:[],this.metadata=new oT(i.createdAt||void 0,i.lastLoginAt||void 0)}async getIdToken(e){let t=await oC(this,this.stsTokenManager.getToken(this.auth,e));return s4(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return ov(this,e)}reload(){return ok(this)}_assign(e){this!==e&&(s4(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new oA({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){s4(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await oE(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(tE(this.auth.app))return Promise.reject(s3(this.auth));let e=await this.getIdToken();return await oC(this,om(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,i=t.email??void 0,r=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,l=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:c,emailVerified:u,isAnonymous:d,providerData:p,stsTokenManager:f}=t;s4(c&&f,e,"internal-error");let m=oR.fromJSON(this.name,f);s4("string"==typeof c,e,"internal-error"),oN(n,e.name),oN(i,e.name),s4("boolean"==typeof u,e,"internal-error"),s4("boolean"==typeof d,e,"internal-error"),oN(r,e.name),oN(s,e.name),oN(o,e.name),oN(a,e.name),oN(l,e.name),oN(h,e.name);let g=new oA({uid:c,auth:e,email:i,emailVerified:u,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:r,tenantId:o,stsTokenManager:m,createdAt:l,lastLoginAt:h});return p&&Array.isArray(p)&&(g.providerData=p.map(e=>({...e}))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){let i=new oR;i.updateFromServerResponse(t);let r=new oA({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await oE(r),r}static async _fromGetAccountInfoResponse(e,t,n){let i=t.users[0];s4(void 0!==i.localId,"internal-error");let r=void 0!==i.providerUserInfo?oS(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!r?.length,o=new oR;o.updateFromIdToken(n);let a=new oA({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:r,metadata:new oT(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!r?.length}),a}}let oO=new Map;function oD(e){var t,n;t="Expected a class definition",e instanceof Function||s6(t);let i=oO.get(e);return i?(n="Instance stored in cache mismatched with class",i instanceof e||s6(n)):(i=new e,oO.set(e,i)),i}class oL{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function oM(e,t,n){return`firebase:${e}:${t}:${n}`}oL.type="NONE";class oF{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:r}=this.auth;this.fullUserKey=oM(this.userKey,i.apiKey,r),this.fullPersistenceKey=oM("persistence",i.apiKey,r),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await og(this.auth,{idToken:e}).catch(()=>void 0);return t?oA._fromGetAccountInfoResponse(this.auth,t,e):null}return oA._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new oF(oD(oL),e,n);let i=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),r=i[0]||oD(oL),s=oM(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let i;if("string"==typeof t){let n=await og(e,{idToken:t}).catch(()=>void 0);if(!n)break;i=await oA._fromGetAccountInfoResponse(e,n,t)}else i=oA._fromJSON(e,t);n!==r&&(o=i),r=n;break}}catch{}let a=i.filter(e=>e._shouldAllowMigration);return r._shouldAllowMigration&&a.length&&(r=a[0],o&&await r._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==r)try{await e._remove(s)}catch{}}))),new oF(r,e,n)}}function oj(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(oq(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(oU(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(o$(t))return"Blackberry";if(oH(t))return"Webos";if(oB(t))return"Safari";if((t.includes("chrome/")||oW(t))&&!t.includes("edge/"))return"Chrome";if(oz(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function oU(e=eC()){return/firefox\//i.test(e)}function oB(e=eC()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function oW(e=eC()){return/crios\//i.test(e)}function oq(e=eC()){return/iemobile/i.test(e)}function oz(e=eC()){return/android/i.test(e)}function o$(e=eC()){return/blackberry/i.test(e)}function oH(e=eC()){return/webos/i.test(e)}function oV(e=eC()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function oK(e=eC()){return oV(e)||oz(e)||oH(e)||o$(e)||/windows phone/i.test(e)||oq(e)}function oG(e,t=[]){let n;switch(e){case"Browser":n=oj(eC());break;case"Worker":n=`${oj(eC())}-${e}`;break;default:n=e}let i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tN}/${i}`}class oY{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,i)=>{try{let i=e(t);n(i)}catch(e){i(e)}});n.onAbort=t,this.queue.push(n);let i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function oJ(e,t={}){return oo(e,"GET","/v2/passwordPolicy",os(e,t))}class oX{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,r){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=r))}}class oQ{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new oZ(this),this.idTokenSubscription=new oZ(this),this.beforeStateQueue=new oY(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=sX,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=oD(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await oF.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await og(this,{idToken:e}),n=await oA._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(tE(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,i=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,r=n?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===r)&&s?.user&&(n=s.user,i=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(i)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(s4(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await oE(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(tE(this.app))return Promise.reject(s3(this));let t=e?eJ(e):null;return t&&s4(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&s4(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return tE(this.app)?Promise.reject(s3(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return tE(this.app)?Promise.reject(s3(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(oD(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new oX(await oJ(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ex("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await oP(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&oD(e)||this._popupRedirectResolver;s4(t,this,"argument-error"),this.redirectPersistenceManager=await oF.create(this,[oD(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};let r="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(s4(o,this,"internal-error"),o.then(()=>{s||r(this.currentUser)}),"function"==typeof t){let r=e.addObserver(t,n,i);return()=>{s=!0,r()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return s4(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=oG(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(tE(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){sQ.logLevel<=T.WARN&&sQ.warn(`Auth (${tN}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class oZ{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new eH(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return s4(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let o0={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function o1(e){return`__${e}${Math.floor(1e6*Math.random())}`}class o2{constructor(){this.enterprise=new o3}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class o3{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let o5="NO_RECAPTCHA";class o4{constructor(e){this.type="recaptcha-enterprise",this.auth=eJ(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{of(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(i=>{if(void 0===i.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new op(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function i(t,n,i){let r=window.grecaptcha;od(r)?r.enterprise.ready(()=>{r.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(o5)})}):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new o2().execute("siteKey",{action:"verify"}):new Promise((e,r)=>{n(this.auth).then(n=>{if(!t&&od(window.grecaptcha))i(n,e,r);else{var s;if("undefined"==typeof window)return void r(Error("RecaptchaVerifier is only supported in browser"));let t=o0.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,o0.loadJS(s)).then(()=>{i(n,e,r)}).catch(e=>{r(e)})}}).catch(e=>{r(e)})})}}async function o6(e,t,n,i=!1,r=!1){let s,o=new o4(e);if(r)s=o5;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function o8(e,t,n,i,r){if("EMAIL_PASSWORD_PROVIDER"===r)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return i(e,t).catch(async r=>{if("auth/missing-recaptcha-token"!==r.code)return Promise.reject(r);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let r=await o6(e,t,n,"getOobCode"===n);return i(e,r)}});else{let r=await o6(e,t,n,"getOobCode"===n);return i(e,r)}if("PHONE_PROVIDER"!==r)return Promise.reject(r+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let r=await o6(e,t,n);return i(e,r).catch(async r=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===r.code||"auth/invalid-app-credential"===r.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let r=await o6(e,t,n,!1,!0);return i(e,r)}return Promise.reject(r)})}{let r=await o6(e,t,n,!1,!0);return i(e,r)}}async function o7(e){let t=eJ(e),n=new op(await of(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new o4(t).verify()}function o9(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function ae(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class at{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return s6("not implemented")}_getIdTokenResponse(e){return s6("not implemented")}_linkToIdToken(e,t){return s6("not implemented")}_getReauthenticationResolver(e){return s6("not implemented")}}async function an(e,t){return oo(e,"POST","/v1/accounts:signUp",t)}async function ai(e,t){return ol(e,"POST","/v1/accounts:signInWithPassword",os(e,t))}async function ar(e,t){return ol(e,"POST","/v1/accounts:signInWithEmailLink",os(e,t))}async function as(e,t){return ol(e,"POST","/v1/accounts:signInWithEmailLink",os(e,t))}class ao extends at{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new ao(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new ao(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return o8(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",ai,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return ar(e,{email:this._email,oobCode:this._password});default:s0(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return o8(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",an,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return as(e,{idToken:t,email:this._email,oobCode:this._password});default:s0(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function aa(e,t){return ol(e,"POST","/v1/accounts:signInWithIdp",os(e,t))}class al extends at{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new al(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):s0("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...i}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let r=new al(t,n);return r.idToken=i.idToken||void 0,r.accessToken=i.accessToken||void 0,r.secret=i.secret,r.nonce=i.nonce,r.pendingToken=i.pendingToken||null,r}_getIdTokenResponse(e){return aa(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,aa(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,aa(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eW(t)}return e}}async function ah(e,t){return oo(e,"POST","/v1/accounts:sendVerificationCode",os(e,t))}async function ac(e,t){return ol(e,"POST","/v1/accounts:signInWithPhoneNumber",os(e,t))}async function au(e,t){let n=await ol(e,"POST","/v1/accounts:signInWithPhoneNumber",os(e,t));if(n.temporaryProof)throw ou(e,"account-exists-with-different-credential",n);return n}let ad={USER_NOT_FOUND:"user-not-found"};async function ap(e,t){return ol(e,"POST","/v1/accounts:signInWithPhoneNumber",os(e,{...t,operation:"REAUTH"}),ad)}class af extends at{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new af({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new af({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return ac(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return au(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return ap(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}=e;return n||t||i||r?new af({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:r}):null}}class am{constructor(e){const t=eq(ez(e)),n=t.apiKey??null,i=t.oobCode??null,r=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);s4(n&&i&&r,"argument-error"),this.apiKey=n,this.operation=r,this.code=i,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,i,r=(n=(t=eq(ez(e)).link)?eq(ez(t)).deep_link_id:null,((i=eq(ez(e)).deep_link_id)?eq(ez(i)).link:null)||i||n||t||e);try{return new am(r)}catch{return null}}}class ag{constructor(){this.providerId=ag.PROVIDER_ID}static credential(e,t){return ao._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=am.parseLink(t);return s4(n,"argument-error"),ao._fromEmailAndCode(e,n.code,n.tenantId)}}ag.PROVIDER_ID="password",ag.EMAIL_PASSWORD_SIGN_IN_METHOD="password",ag.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class a_{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class av extends a_{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class ay extends av{constructor(){super("facebook.com")}static credential(e){return al._fromParams({providerId:ay.PROVIDER_ID,signInMethod:ay.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ay.credentialFromTaggedObject(e)}static credentialFromError(e){return ay.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ay.credential(e.oauthAccessToken)}catch{return null}}}ay.FACEBOOK_SIGN_IN_METHOD="facebook.com",ay.PROVIDER_ID="facebook.com";class ab extends av{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return al._fromParams({providerId:ab.PROVIDER_ID,signInMethod:ab.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ab.credentialFromTaggedObject(e)}static credentialFromError(e){return ab.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ab.credential(t,n)}catch{return null}}}ab.GOOGLE_SIGN_IN_METHOD="google.com",ab.PROVIDER_ID="google.com";class aw extends av{constructor(){super("github.com")}static credential(e){return al._fromParams({providerId:aw.PROVIDER_ID,signInMethod:aw.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return aw.credentialFromTaggedObject(e)}static credentialFromError(e){return aw.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return aw.credential(e.oauthAccessToken)}catch{return null}}}aw.GITHUB_SIGN_IN_METHOD="github.com",aw.PROVIDER_ID="github.com";class aC extends av{constructor(){super("twitter.com")}static credential(e,t){return al._fromParams({providerId:aC.PROVIDER_ID,signInMethod:aC.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return aC.credentialFromTaggedObject(e)}static credentialFromError(e){return aC.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return aC.credential(t,n)}catch{return null}}}aC.TWITTER_SIGN_IN_METHOD="twitter.com",aC.PROVIDER_ID="twitter.com";class aI{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){return new aI({user:await oA._fromIdTokenResponse(e,n,i),providerId:aT(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new aI({user:e,providerId:aT(n),_tokenResponse:n,operationType:t})}}function aT(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class aE extends eS{constructor(e,t,n,i){super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,aE.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new aE(e,t,n,i)}}function ak(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw aE._fromErrorAndOperation(e,n,t,i);throw n})}async function aS(e,t,n=!1){let i=await oC(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return aI._forOperation(e,"link",i)}async function ax(e,t,n=!1){let{auth:i}=e;if(tE(i.app))return Promise.reject(s3(i));let r="reauthenticate";try{let s=await oC(e,ak(i,r,t,e),n);s4(s.idToken,i,"internal-error");let o=ob(s.idToken);s4(o,i,"internal-error");let{sub:a}=o;return s4(e.uid===a,i,"user-mismatch"),aI._forOperation(e,r,s)}catch(e){throw e?.code==="auth/user-not-found"&&s0(i,"user-mismatch"),e}}async function aP(e,t,n=!1){if(tE(e.app))return Promise.reject(s3(e));let i="signIn",r=await ak(e,i,t),s=await aI._fromIdTokenResponse(e,i,r);return n||await e._updateCurrentUser(s.user),s}class aR{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?aN._fromServerResponse(e,t):"totpInfo"in t?aA._fromServerResponse(e,t):s0(e,"internal-error")}}class aN extends aR{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new aN(t)}}class aA extends aR{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new aA(t)}}function aO(e,t){return oo(e,"POST","/v2/accounts/mfaEnrollment:start",os(e,t))}new WeakMap;let aD="__sak";class aL{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(aD,"1"),this.storage.removeItem(aD),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class aM extends aL{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oK(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let i=e.key;t?this.detachListener():this.stopPolling();let r=()=>{let e=this.storage.getItem(i);(t||this.localCache[i]!==e)&&this.notifyListeners(i,e)},s=this.storage.getItem(i);((n=eC()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(r,10):r()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}aM.type="LOCAL";class aF extends aL{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}aF.type="SESSION";class aj{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new aj(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:i}=e.data,r=this.handlersMap[n];if(!r?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(r).map(async t=>t(e.origin,i)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function aU(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}aj.receivers=[];class aB{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let i,r,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=aU("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);r={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),i=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(i),o(e.data.response);break;default:clearTimeout(h),clearTimeout(i),a(Error("invalid_response"))}}},this.handlers.add(r),s.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{r&&this.removeMessageHandler(r)})}}function aW(){return window}function aq(){return void 0!==aW().WorkerGlobalScope&&"function"==typeof aW().importScripts}async function az(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let a$="firebaseLocalStorageDb",aH="firebaseLocalStorage",aV="fbase_key";class aK{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function aG(e,t){return e.transaction([aH],t?"readwrite":"readonly").objectStore(aH)}function aY(){let e=indexedDB.open(a$,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(aH,{keyPath:aV})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(aH)?t(n):(n.close(),await new aK(indexedDB.deleteDatabase(a$)).toPromise(),t(await aY()))})})}async function aJ(e,t,n){return new aK(aG(e,!0).put({[aV]:t,value:n})).toPromise()}async function aX(e,t){let n=aG(e,!1).get(t),i=await new aK(n).toPromise();return void 0===i?null:i.value}function aQ(e,t){return new aK(aG(e,!0).delete(t)).toPromise()}class aZ{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await aY()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return aq()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=aj._getInstance(aq()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await az(),!this.activeServiceWorker)return;this.sender=new aB(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await aY();return await aJ(e,aD,"1"),await aQ(e,aD),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>aJ(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>aX(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>aQ(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new aK(aG(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:i,value:r}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(r)&&(this.notifyListeners(i,r),t.push(i));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function a0(e,t){return oo(e,"POST","/v2/accounts/mfaSignIn:start",os(e,t))}aZ.type="LOCAL",o1("rcb"),new s9(3e4,6e4);let a1="recaptcha";async function a2(e,t,n){if(!e._getRecaptchaConfig())try{await o7(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(i="string"==typeof t?{phoneNumber:t}:t,"session"in i){let t=i.session;if("phoneNumber"in i){s4("enroll"===t.type,e,"internal-error");let r={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===o5){s4(n?.type===a1,e,"argument-error");let i=await a3(e,t,n);return aO(e,i)}return aO(e,t)},o=o8(e,r,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{s4("signin"===t.type,e,"internal-error");let r=i.multiFactorHint?.uid||i.multiFactorUid;s4(r,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:r,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===o5){s4(n?.type===a1,e,"argument-error");let i=await a3(e,t,n);return a0(e,i)}return a0(e,t)},a=o8(e,s,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"},r=async(e,t)=>{if(t.captchaResponse===o5){s4(n?.type===a1,e,"argument-error");let i=await a3(e,t,n);return ah(e,i)}return ah(e,t)},s=o8(e,t,"sendVerificationCode",r,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function a3(e,t,n){s4(n.type===a1,e,"argument-error");let i=await n.verify();s4("string"==typeof i,e,"argument-error");let r={...t};if("phoneEnrollmentInfo"in r){let e=r.phoneEnrollmentInfo.phoneNumber,t=r.phoneEnrollmentInfo.captchaResponse,n=r.phoneEnrollmentInfo.clientType,s=r.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(r,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:s}}),r}if(!("phoneSignInInfo"in r))return Object.assign(r,{recaptchaToken:i}),r;{let e=r.phoneSignInInfo.captchaResponse,t=r.phoneSignInInfo.clientType,n=r.phoneSignInInfo.recaptchaVersion;return Object.assign(r,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),r}}class a5{constructor(e){this.providerId=a5.PROVIDER_ID,this.auth=eJ(e)}verifyPhoneNumber(e,t){return a2(this.auth,e,eJ(t))}static credential(e,t){return af._fromVerification(e,t)}static credentialFromResult(e){return a5.credentialFromTaggedObject(e)}static credentialFromError(e){return a5.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?af._fromTokenResponse(t,n):null}}a5.PROVIDER_ID="phone",a5.PHONE_SIGN_IN_METHOD="phone";class a4 extends at{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return aa(e,this._buildIdpRequest())}_linkToIdToken(e,t){return aa(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return aa(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function a6(e){return aP(e.auth,new a4(e),e.bypassAuthState)}function a8(e){let{auth:t,user:n}=e;return s4(n,t,"internal-error"),ax(n,new a4(e),e.bypassAuthState)}async function a7(e){let{auth:t,user:n}=e;return s4(n,t,"internal-error"),aS(n,new a4(e),e.bypassAuthState)}class a9{constructor(e,t,n,i,r=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:i,tenantId:r,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:r||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return a6;case"linkViaPopup":case"linkViaRedirect":return a7;case"reauthViaPopup":case"reauthViaRedirect":return a8;default:s0(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||s6(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||s6(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let le=new s9(2e3,1e4);class lt extends a9{constructor(e,t,n,i,r){super(e,t,i,r),this.provider=n,this.authWindow=null,this.pollId=null,lt.currentPopupAction&&lt.currentPopupAction.cancel(),lt.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return s4(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||s6(t);let n=aU();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(s1(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(s1(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,lt.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(s1(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,le.get())};e()}}lt.currentPopupAction=null;let ln=new Map;class li extends a9{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ln.get(this.auth._key());if(!e){try{let t=await lr(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}ln.set(this.auth._key(),e)}return this.bypassAuthState||ln.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function lr(e,t){var n;let i=oM("pendingRedirect",(n=t).config.apiKey,n.name),r=oD(e._redirectPersistence);if(!await r._isAvailable())return!1;let s=await r._get(i)==="true";return await r._remove(i),s}function ls(e,t){ln.set(e._key(),t)}async function lo(e,t,n=!1){if(tE(e.app))return Promise.reject(s3(e));let i=eJ(e),r=t?oD(t):(s4(i._popupRedirectResolver,i,"argument-error"),i._popupRedirectResolver),s=new li(i,r,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class la{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return lh(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!lh(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(s1(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ll(e))}saveEventToCache(e){this.cachedEventUids.add(ll(e)),this.lastProcessedEventTime=Date.now()}}function ll(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function lh({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function lc(e,t={}){return oo(e,"GET","/v1/projects",t)}let lu=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ld=/^https?/;async function lp(e){if(e.config.emulator)return;let{authorizedDomains:t}=await lc(e);for(let e of t)try{if(function(e){let t=s8(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){let r=new URL(e);return""===r.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&r.hostname===i}if(!ld.test(n))return!1;if(lu.test(e))return i===e;let r=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+r+"|"+r+")$","i").test(i)}(e))return}catch{}s0(e,"unauthorized-domain")}let lf=new s9(3e4,6e4);function lm(){let e=aW().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let lg=null,l_=new s9(5e3,15e3),lv={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ly=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function lb(e){let t,n,i,r,s,o=await (lg=lg||new Promise((t,n)=>{function i(){lm(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{lm(),n(s1(e,"network-request-failed"))},timeout:lf.get()})}if(aW().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(aW().gapi?.load)i();else{var r;let t=o1("iframefcb");return aW()[t]=()=>{gapi.load?i():n(s1(e,"network-request-failed"))},(r=`${o0.gapiScript}?onload=${t}`,o0.loadJS(r)).catch(e=>n(e))}}).catch(e=>{throw lg=null,e})),a=aW().gapi;return s4(a,e,"internal-error"),o.open({where:document.body,url:(s4((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?oe(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,i={apiKey:t.apiKey,appName:e.name,v:tN},(r=ly.get(e.config.apiHost))&&(i.eid=r),(s=e._getFrameworks()).length&&(i.fw=s.join(",")),`${n}?${eW(i).slice(1)}`),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lv,dontclear:!0},t=>new Promise(async(n,i)=>{await t.restyle({setHideOnLeave:!1});let r=s1(e,"network-request-failed"),s=aW().setTimeout(()=>{i(r)},l_.get());function o(){aW().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{i(r)})}))}let lw={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class lC{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let lI=encodeURIComponent("fac");async function lT(e,t,n,i,r,s){s4(e.config.authDomain,e,"auth-domain-config-required"),s4(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:tN,eventId:r};if(t instanceof a_)for(let[n,i]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",eF(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=i;if(t instanceof av){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${lI}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?oe(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${eW(o).slice(1)}${l}`}let lE="webStorageSupport",lk=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=aF,this._completeRedirectFn=lo,this._overrideRedirectResult=ls}async _openPopup(e,t,n,i){var r,s;r=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",r||s6(s);let o=await lT(e,t,n,s8(),i);return function(e,t,n,i=500,r=600){let s=Math.max((window.screen.availHeight-r)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString(),a="",l={...lw,width:i.toString(),height:r.toString(),top:s,left:o},h=eC().toLowerCase();n&&(a=oW(h)?"_blank":n),oU(h)&&(t=t||"http://localhost",l.scrollbars="yes");let c=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=eC()){return oV(e)&&!!window.navigator?.standalone}(h)&&"_self"!==a){var u,d;let e,n;return u=t||"",d=a,(e=document.createElement("a")).href=u,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new lC(null)}let p=window.open(t||"",a,c);s4(p,e,"popup-blocked");try{p.focus()}catch(e){}return new lC(p)}(e,o,aU())}async _openRedirect(e,t,n,i){var r;return await this._originValidation(e),r=await lT(e,t,n,s8(),i),aW().location.href=r,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:i}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",i||s6(n),i)}let i=this.initAndGetManager(e);return this.eventManagers[t]={promise:i},i.catch(()=>{delete this.eventManagers[t]}),i}async initAndGetManager(e){let t=await lb(e),n=new la(e);return t.register("authEvent",t=>(s4(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(lE,{type:lE},n=>{let i=n?.[0]?.[lE];void 0!==i&&t(!!i),s0(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=lp(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oK()||oB()||oV()}};var lS="@firebase/auth",lx="1.11.1";class lP{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){s4(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let lR=em("authIdTokenMaxAge")||300,lN=null;function lA(e=tD()){let t=tw(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=tw(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eU(n.getOptions(),t??{}))return e;s0(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:lk,persistence:[aZ,aM,aF]}),i=em("authTokenSyncURL");if(i&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(i,location.origin);if(location.origin===e.origin){let t,i=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>lR)return;let r=n?.token;lN!==r&&(lN=r,await fetch(t,{method:r?"POST":"DELETE",headers:r?{Authorization:`Bearer ${r}`}:{}}))});eJ(n).beforeAuthStateChanged(i,()=>i(n.currentUser)),eJ(n).onIdTokenChanged(e=>i(e),void 0,void 0)}}let r=ep("auth");return r&&function(e,t,n){let i=eJ(e);s4(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");let r=o9(t),{host:s,port:o}=function(e){let t=o9(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let i=n[2].split("@").pop()||"",r=/^(\[[^\]]+\])(:|$)/.exec(i);if(r){let e=r[1];return{host:e,port:ae(i.substr(e.length+1))}}{let[e,t]=i.split(":");return{host:e,port:ae(t)}}}(t),a=null===o?"":`:${o}`,l={url:`${r}//${s}${a}/`},h=Object.freeze({host:s,port:o,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!i._canInitEmulator){s4(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),s4(eU(l,i.config.emulator)&&eU(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=l,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,e_(s)?(ev(`${r}//${s}${a}`),ew("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${r}`),n}o0={loadJS:e=>new Promise((t,n)=>{let i=document.createElement("script");i.setAttribute("src",e),i.onload=t,i.onerror=e=>{let t=s1("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(i)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},I="Browser",tb(new eX("auth",(e,{options:t})=>{let n,i,r=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=r.options;s4(a&&!a.includes(":"),"invalid-api-key",{appName:r.name});let h=new oQ(r,s,o,{apiKey:a,authDomain:l,clientPlatform:I,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:oG(I)});return i=(Array.isArray(n=t?.persistence||[])?n:[n]).map(oD),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(i,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),tb(new eX("auth-internal",e=>new lP(eJ(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tF(lS,lx,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(I)),tF(lS,lx,"esm2020"),e.s([],44953),e.i(44953);let lO={apiKey:B.default.env.NEXT_PUBLIC_FIREBASE_API_KEY||"",authDomain:B.default.env.NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN||"",projectId:B.default.env.NEXT_PUBLIC_FIREBASE_PROJECT_ID||"",storageBucket:B.default.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:B.default.env.NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID||"",appId:B.default.env.NEXT_PUBLIC_FIREBASE_APP_ID||"",databaseURL:B.default.env.NEXT_PUBLIC_FIREBASE_DATABASE_URL||""};function lD(){if(tL().length)return f=sY(p=tL()[0]),m=lA(p),{app:p,database:f,auth:m,isConfigured:!0};if(!(lO.apiKey&&lO.projectId))return console.warn("Firebase configuration is incomplete. Some features may not work."),console.warn("Please set NEXT_PUBLIC_FIREBASE_* environment variables."),{app:null,database:null,auth:null,isConfigured:!1};try{return p=tA(lO),f=sY(p),m=lA(p),console.log("Firebase initialized successfully"),{app:p,database:f,auth:m,isConfigured:!0}}catch(e){return console.error("Error initializing Firebase:",e),{app:null,database:null,auth:null,isConfigured:!1}}}function lL(){return f||lD().database}lD();var lM=e.i(13654);let lF=(0,S.createContext)(null);function lj(){let e=(0,S.useContext)(lF);if(!e)throw Error("useBoardContext must be used within BoardProvider");return e}function lU({children:e,userId:t,userName:n}){let[i,r]=(0,S.useState)(null),[s,o]=(0,S.useState)(null),[a,l]=(0,S.useState)(new Map),[h,c]=(0,S.useState)([]),[u,d]=(0,S.useState)(!1),[p,f]=(0,S.useState)(!1),[m,g]=(0,S.useState)(null),[_,v]=(0,S.useState)(!0),[y,b]=(0,S.useState)([]),[w,C]=(0,S.useState)([]);(0,S.useEffect)(()=>{if(!i)return;let e=lL();if(!(lO.apiKey&&lO.projectId)||!e){console.warn("Firebase not configured, using REST API fallback"),v(!1),T();return}v(!0),I(e)},[i]);let I=e=>{if(i){f(!0),g(null);try{let t=sB(e,`boards/${i}/canvasState`),n=sV(t,e=>{let t=e.val();t&&(o(t),d(!0)),f(!1)},e=>{console.error("Firebase canvas error:",e),g("Failed to connect to Firebase"),v(!1),T()}),r=sB(e,`boards/${i}/presence`),s=sV(r,e=>{let t=e.val();if(t){let e=new Map;Object.entries(t).forEach(([t,n])=>{e.set(t,n)}),l(e)}}),a=sB(e,`boards/${i}/notifications`),h=sV(a,e=>{let t=e.val();if(t){let e=Object.values(t);c(e.slice(-20))}});return()=>{n(),s(),h()}}catch(e){console.error("Error setting up Firebase listeners:",e),g("Failed to setup Firebase listeners"),v(!1),T()}}},T=async()=>{if(i)try{f(!0),g(null);let e=(0,lM.getBackendUrl)(),t=await (0,lM.fetchWithErrorHandling)(`${e}/api/boards/${i}/snapshot`,{method:"GET"});if(t.ok){let e=await t.json();o(e.canvasState),d(!0)}else g("Failed to fetch board snapshot")}catch(e){g(e.message||"Failed to fetch board")}finally{f(!1)}},E=(0,S.useCallback)(e=>{if(!i)return;let t={...e,id:`stroke_${Date.now()}_${Math.random()}`,timestamp:Date.now()};if(_){let e=lL();e&&sq(sB(e,`boards/${i}/canvasState/actions`),t)}else o(e=>e?{...e,actions:[...e.actions,t],lastUpdated:new Date().toISOString()}:null);b(e=>[...e,t]),C([])},[i,_]),x=(0,S.useCallback)(e=>{if(!i)return;let t={...e,id:`shape_${Date.now()}_${Math.random()}`,timestamp:Date.now()};if(_){let e=lL();e&&sq(sB(e,`boards/${i}/canvasState/actions`),t)}else o(e=>e?{...e,actions:[...e.actions,t],lastUpdated:new Date().toISOString()}:null);b(e=>[...e,t]),C([])},[i,_]),P=(0,S.useCallback)(()=>{if(i){if(_){let e=lL();e&&sz(sB(e,`boards/${i}/canvasState/actions`),[])}else o(e=>e?{...e,actions:[],lastUpdated:new Date().toISOString()}:null);b([]),C([])}},[i,_]),R=(0,S.useCallback)(e=>{if(!i)return;let t={...e,id:`notif_${Date.now()}`,timestamp:Date.now()};if(_){let e=lL();e&&sz(sB(e,`boards/${i}/notifications/${t.id}`),t)}else c(e=>[...e,t].slice(-20))},[i,_]),N=(0,S.useCallback)((e,r)=>{if(!i)return;let s={userId:t,name:n,status:e,cursor:r,lastHeartbeat:new Date().toISOString()};if(_){let e=lL();e&&sz(sB(e,`boards/${i}/presence/${t}`),s)}else{let t=(0,lM.getBackendUrl)();(0,lM.fetchWithErrorHandling)(`${t}/api/boards/${i}/presence`,{method:"POST",body:JSON.stringify({status:e,cursor:r})}).catch(e=>console.error("Failed to update presence:",e))}},[i,t,n,_]),A=(0,S.useCallback)(()=>{if(0===y.length)return;let e=y[y.length-1];b(e=>e.slice(0,-1)),C(t=>[...t,e]),o(t=>t?{...t,actions:t.actions.filter(t=>t.id!==e.id),lastUpdated:new Date().toISOString()}:null)},[y]),O=(0,S.useCallback)(()=>{if(0===w.length)return;let e=w[w.length-1];C(e=>e.slice(0,-1)),b(t=>[...t,e]),o(t=>t?{...t,actions:[...t.actions,e],lastUpdated:new Date().toISOString()}:null)},[w]);return(0,k.jsx)(lF.Provider,{value:{boardId:i,canvasState:s,presence:a,notifications:h,isConnected:u,isLoading:p,error:m,actions:{setBoardId:r,addStroke:E,addShape:x,clearBoard:P,broadcastNotification:R,updatePresence:N,undo:A,redo:O}},children:e})}function lB({width:e,height:t,currentTool:n,currentColor:i,strokeWidth:r}){let s=(0,S.useRef)(null),[o,a]=(0,S.useState)(!1),[l,h]=(0,S.useState)(null),[c,u]=(0,S.useState)([]),{canvasState:d,actions:p}=lj();(0,S.useEffect)(()=>{let n=s.current;if(!n)return;let i=n.getContext("2d");i&&(i.clearRect(0,0,e,t),d?.actions.forEach(e=>{f(i,e)}))},[d,e,t]);let f=(e,t)=>{"stroke"===t.type?m(e,t):g(e,t)},m=(e,t)=>{if(!(t.points.length<4)){e.strokeStyle=t.color,e.lineWidth=t.width,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(t.points[0],t.points[1]);for(let n=2;n<t.points.length;n+=2)e.lineTo(t.points[n],t.points[n+1]);e.stroke()}},g=(e,t)=>{switch(e.strokeStyle=t.color,e.lineWidth=2,e.beginPath(),t.type){case"rectangle":t.width&&t.height&&e.rect(t.x,t.y,t.width,t.height);break;case"circle":t.radius&&e.arc(t.x,t.y,t.radius,0,2*Math.PI);break;case"line":void 0!==t.width&&void 0!==t.height&&(e.moveTo(t.x,t.y),e.lineTo(t.x+t.width,t.y+t.height))}e.stroke()},_=e=>{let t=s.current;if(!t)return{x:0,y:0};let n=t.getBoundingClientRect();return{x:e.clientX-n.left,y:e.clientY-n.top}};return(0,k.jsx)(P.Box,{sx:{width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center",bgcolor:"background.paper",overflow:"hidden"},children:(0,k.jsx)("canvas",{ref:s,width:e,height:t,onMouseDown:e=>{let t=_(e);a(!0),h(t),("pen"===n||"eraser"===n)&&u([t.x,t.y]),p.updatePresence("active",t)},onMouseMove:a=>{let h=_(a);if(o&&p.updatePresence("active",h),!o)return;let m=s.current;if(!m)return;let g=m.getContext("2d");if(g){if("pen"===n||"eraser"===n){if(u(e=>[...e,h.x,h.y]),g.strokeStyle="eraser"===n?"#FFFFFF":i,g.lineWidth=r,g.lineCap="round",g.lineJoin="round",c.length>=2){let e=c[c.length-2],t=c[c.length-1];g.beginPath(),g.moveTo(e,t),g.lineTo(h.x,h.y),g.stroke()}}else if(l){switch(g.clearRect(0,0,e,t),d?.actions.forEach(e=>{f(g,e)}),g.strokeStyle=i,g.lineWidth=2,g.beginPath(),n){case"rectangle":let r=h.x-l.x,s=h.y-l.y;g.rect(l.x,l.y,r,s);break;case"circle":let o=Math.sqrt(Math.pow(h.x-l.x,2)+Math.pow(h.y-l.y,2));g.arc(l.x,l.y,o,0,2*Math.PI);break;case"line":g.moveTo(l.x,l.y),g.lineTo(h.x,h.y)}g.stroke()}}},onMouseUp:e=>{if(!o)return;let t=_(e);if(a(!1),"pen"===n||"eraser"===n)c.length>=4&&p.addStroke({type:"stroke",points:c,color:"eraser"===n?"#FFFFFF":i,width:r}),u([]);else if(l){let e=t.x-l.x,r=t.y-l.y;switch(n){case"rectangle":p.addShape({type:"rectangle",x:l.x,y:l.y,width:e,height:r,color:i});break;case"circle":let s=Math.sqrt(e**2+r**2);p.addShape({type:"circle",x:l.x,y:l.y,radius:s,color:i});break;case"line":p.addShape({type:"line",x:l.x,y:l.y,width:e,height:r,color:i})}}h(null)},onMouseLeave:()=>{o&&(a(!1),u([]),h(null)),p.updatePresence("idle")},style:{border:"1px solid #ccc",cursor:"pen"===n?"crosshair":"default",backgroundColor:"#FFFFFF"}})})}var lW=e.i(98807),lq=e.i(10251),lz=e.i(96163),l$=e.i(65393),lH=e.i(18420),lV=e.i(95262);function lK(e){return(0,Y.default)("MuiButtonGroup",e)}let lG=(0,G.default)("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","vertical","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]);var lY=e.i(28457),lJ=e.i(58787);let lX=["children","className","color","component","disabled","disableElevation","disableFocusRipple","disableRipple","fullWidth","orientation","size","variant"],lQ=(0,lV.default)("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[{[`& .${lG.grouped}`]:t.grouped},{[`& .${lG.grouped}`]:t[`grouped${(0,lH.default)(n.orientation)}`]},{[`& .${lG.grouped}`]:t[`grouped${(0,lH.default)(n.variant)}`]},{[`& .${lG.grouped}`]:t[`grouped${(0,lH.default)(n.variant)}${(0,lH.default)(n.orientation)}`]},{[`& .${lG.grouped}`]:t[`grouped${(0,lH.default)(n.variant)}${(0,lH.default)(n.color)}`]},{[`& .${lG.firstButton}`]:t.firstButton},{[`& .${lG.lastButton}`]:t.lastButton},{[`& .${lG.middleButton}`]:t.middleButton},t.root,t[n.variant],!0===n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth,"vertical"===n.orientation&&t.vertical]}})(({theme:e,ownerState:t})=>(0,W.default)({display:"inline-flex",borderRadius:(e.vars||e).shape.borderRadius},"contained"===t.variant&&{boxShadow:(e.vars||e).shadows[2]},t.disableElevation&&{boxShadow:"none"},t.fullWidth&&{width:"100%"},"vertical"===t.orientation&&{flexDirection:"column"},{[`& .${lG.grouped}`]:(0,W.default)({minWidth:40,"&:hover":(0,W.default)({},"contained"===t.variant&&{boxShadow:"none"})},"contained"===t.variant&&{boxShadow:"none"}),[`& .${lG.firstButton},& .${lG.middleButton}`]:(0,W.default)({},"horizontal"===t.orientation&&{borderTopRightRadius:0,borderBottomRightRadius:0},"vertical"===t.orientation&&{borderBottomRightRadius:0,borderBottomLeftRadius:0},"text"===t.variant&&"horizontal"===t.orientation&&{borderRight:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${"light"===e.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${lG.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},"text"===t.variant&&"vertical"===t.orientation&&{borderBottom:e.vars?`1px solid rgba(${e.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${"light"===e.palette.mode?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${lG.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},"text"===t.variant&&"inherit"!==t.color&&{borderColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / 0.5)`:(0,lz.alpha)(e.palette[t.color].main,.5)},"outlined"===t.variant&&"horizontal"===t.orientation&&{borderRightColor:"transparent"},"outlined"===t.variant&&"vertical"===t.orientation&&{borderBottomColor:"transparent"},"contained"===t.variant&&"horizontal"===t.orientation&&{borderRight:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${lG.disabled}`]:{borderRight:`1px solid ${(e.vars||e).palette.action.disabled}`}},"contained"===t.variant&&"vertical"===t.orientation&&{borderBottom:`1px solid ${(e.vars||e).palette.grey[400]}`,[`&.${lG.disabled}`]:{borderBottom:`1px solid ${(e.vars||e).palette.action.disabled}`}},"contained"===t.variant&&"inherit"!==t.color&&{borderColor:(e.vars||e).palette[t.color].dark},{"&:hover":(0,W.default)({},"outlined"===t.variant&&"horizontal"===t.orientation&&{borderRightColor:"currentColor"},"outlined"===t.variant&&"vertical"===t.orientation&&{borderBottomColor:"currentColor"})}),[`& .${lG.lastButton},& .${lG.middleButton}`]:(0,W.default)({},"horizontal"===t.orientation&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},"vertical"===t.orientation&&{borderTopRightRadius:0,borderTopLeftRadius:0},"outlined"===t.variant&&"horizontal"===t.orientation&&{marginLeft:-1},"outlined"===t.variant&&"vertical"===t.orientation&&{marginTop:-1})})),lZ=S.forwardRef(function(e,t){let n=(0,V.useDefaultProps)({props:e,name:"MuiButtonGroup"}),{children:i,className:r,color:s="primary",component:o="div",disabled:a=!1,disableElevation:l=!1,disableFocusRipple:h=!1,disableRipple:c=!1,fullWidth:u=!1,orientation:d="horizontal",size:p="medium",variant:f="outlined"}=n,m=(0,q.default)(n,lX),g=(0,W.default)({},n,{color:s,component:o,disabled:a,disableElevation:l,disableFocusRipple:h,disableRipple:c,fullWidth:u,orientation:d,size:p,variant:f}),_=(e=>{let{classes:t,color:n,disabled:i,disableElevation:r,fullWidth:s,orientation:o,variant:a}=e,l={root:["root",a,"vertical"===o&&"vertical",s&&"fullWidth",r&&"disableElevation"],grouped:["grouped",`grouped${(0,lH.default)(o)}`,`grouped${(0,lH.default)(a)}`,`grouped${(0,lH.default)(a)}${(0,lH.default)(o)}`,`grouped${(0,lH.default)(a)}${(0,lH.default)(n)}`,i&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return(0,$.default)(l,lK,t)})(g),v=S.useMemo(()=>({className:_.grouped,color:s,disabled:a,disableElevation:l,disableFocusRipple:h,disableRipple:c,fullWidth:u,size:p,variant:f}),[s,a,l,h,c,u,p,f,_.grouped]),y=(0,l$.default)(i),b=y.length;return(0,k.jsx)(lQ,(0,W.default)({as:o,role:"group",className:(0,z.default)(_.root,r),ref:t,ownerState:g},m,{children:(0,k.jsx)(lY.default.Provider,{value:v,children:y.map((e,t)=>{let n,i;return(0,k.jsx)(lJ.default.Provider,{value:(n=0===t,i=t===b-1,n&&i?"":n?_.firstButton:i?_.lastButton:_.middleButton),children:e},t)})})}))});var l0=e.i(71880),l1=e.i(11266),l2=e.i(77072),l3=e.i(3783),l5=e.i(30401),l4=e.i(10719),l6=e.i(91947),l8=e.i(18894),l7=e.i(63985),l7=l7;let l9={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};var he=e.i(20441),he=he,ht=e.i(75070);function hn(e,t){return e-t}function hi(e,t){var n;let{index:i}=null!=(n=e.reduce((e,n,i)=>{let r=Math.abs(t-n);return null===e||r<e.distance||r===e.distance?{distance:r,index:i}:e},null))?n:{};return i}function hr(e,t){if(void 0!==t.current&&e.changedTouches){for(let n=0;n<e.changedTouches.length;n+=1){let i=e.changedTouches[n];if(i.identifier===t.current)return{x:i.clientX,y:i.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function hs({values:e,newValue:t,index:n}){let i=e.slice();return i[n]=t,i.sort(hn)}function ho({sliderRef:e,activeIndex:t,setActive:n}){var i,r,s;let o=(0,l3.unstable_ownerDocument)(e.current);null!=(i=e.current)&&i.contains(o.activeElement)&&Number(null==o||null==(r=o.activeElement)?void 0:r.getAttribute("data-index"))===t||null==(s=e.current)||s.querySelector(`[type="range"][data-index="${t}"]`).focus(),n&&n(t)}function ha(e,t){return"number"==typeof e&&"number"==typeof t?e===t:"object"==typeof e&&"object"==typeof t&&function(e,t,n=(e,t)=>e===t){return e.length===t.length&&e.every((e,i)=>n(e,t[i]))}(e,t)}let hl={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},hh=e=>e;function hc(){return void 0===g&&(g="undefined"==typeof CSS||"function"!=typeof CSS.supports||CSS.supports("touch-action","none")),g}var hu=e.i(45035);function hd(e){return(0,Y.default)("MuiSlider",e)}let hp=(0,G.default)("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),hf=["aria-label","aria-valuetext","aria-labelledby","component","components","componentsProps","color","classes","className","disableSwap","disabled","getAriaLabel","getAriaValueText","marks","max","min","name","onChange","onChangeCommitted","orientation","shiftStep","size","step","scale","slotProps","slots","tabIndex","track","value","valueLabelDisplay","valueLabelFormat"];function hm(e){return e}let hg=(0,H.styled)("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.root,t[`color${(0,lH.default)(n.color)}`],"medium"!==n.size&&t[`size${(0,lH.default)(n.size)}`],n.marked&&t.marked,"vertical"===n.orientation&&t.vertical,"inverted"===n.track&&t.trackInverted,!1===n.track&&t.trackFalse]}})(({theme:e})=>{var t;return{borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${hp.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${hp.dragging}`]:{[`& .${hp.thumb}, & .${hp.track}`]:{transition:"none"}},variants:[...Object.keys((null!=(t=e.vars)?t:e).palette).filter(t=>{var n;return(null!=(n=e.vars)?n:e).palette[t].main}).map(t=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}}),h_=(0,H.styled)("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),hv=(0,H.styled)("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>{var t;return{display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.keys((null!=(t=e.vars)?t:e).palette).filter(t=>{var n;return(null!=(n=e.vars)?n:e).palette[t].main}).map(t=>({props:{color:t,track:"inverted"},style:(0,W.default)({},e.vars?{backgroundColor:e.vars.palette.Slider[`${t}Track`],borderColor:e.vars.palette.Slider[`${t}Track`]}:(0,W.default)({backgroundColor:(0,lz.lighten)(e.palette[t].main,.62),borderColor:(0,lz.lighten)(e.palette[t].main,.62)},e.applyStyles("dark",{backgroundColor:(0,lz.darken)(e.palette[t].main,.5)}),e.applyStyles("dark",{borderColor:(0,lz.darken)(e.palette[t].main,.5)})))}))]}}),hy=(0,H.styled)("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{let{ownerState:n}=e;return[t.thumb,t[`thumbColor${(0,lH.default)(n.color)}`],"medium"!==n.size&&t[`thumbSize${(0,lH.default)(n.size)}`]]}})(({theme:e})=>{var t;return{position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${hp.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.keys((null!=(t=e.vars)?t:e).palette).filter(t=>{var n;return(null!=(n=e.vars)?n:e).palette[t].main}).map(t=>({props:{color:t},style:{[`&:hover, &.${hp.focusVisible}`]:(0,W.default)({},e.vars?{boxShadow:`0px 0px 0px 8px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 8px ${(0,lz.alpha)(e.palette[t].main,.16)}`},{"@media (hover: none)":{boxShadow:"none"}}),[`&.${hp.active}`]:(0,W.default)({},e.vars?{boxShadow:`0px 0px 0px 14px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 14px ${(0,lz.alpha)(e.palette[t].main,.16)}`})}}))]}}),hb=(0,H.styled)(function(e){let{children:t,className:n,value:i}=e,r=(e=>{let{open:t}=e;return{offset:(0,z.default)(t&&hp.valueLabelOpen),circle:hp.valueLabelCircle,label:hp.valueLabelLabel}})(e);return t?S.cloneElement(t,{className:(0,z.default)(t.props.className)},(0,k.jsxs)(S.Fragment,{children:[t.props.children,(0,k.jsx)("span",{className:(0,z.default)(r.offset,n),"aria-hidden":!0,children:(0,k.jsx)("span",{className:r.circle,children:(0,k.jsx)("span",{className:r.label,children:i})})})]})):null},{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(({theme:e})=>(0,W.default)({zIndex:1,whiteSpace:"nowrap"},e.typography.body2,{fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${hp.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${hp.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]})),hw=(0,H.styled)("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>(0,hu.default)(e)&&"markActive"!==e,overridesResolver:(e,t)=>{let{markActive:n}=e;return[t.mark,n&&t.markActive]}})(({theme:e})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}}]})),hC=(0,H.styled)("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>(0,hu.default)(e)&&"markLabelActive"!==e,overridesResolver:(e,t)=>t.markLabel})(({theme:e})=>(0,W.default)({},e.typography.body2,{color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(e.vars||e).palette.text.primary}}]})),hI=({children:e})=>e,hT=S.forwardRef(function(e,t){var n,i,r,s,o,a,l,h,c,u,d,p,f,m,g,_,v,y,b,w,C,I,T,E;let x=(0,V.useDefaultProps)({props:e,name:"MuiSlider"}),P=(0,l0.useRtl)(),{"aria-label":R,"aria-valuetext":N,"aria-labelledby":A,component:O="span",components:D={},componentsProps:L={},color:M="primary",classes:F,className:j,disableSwap:U=!1,disabled:B=!1,getAriaLabel:H,getAriaValueText:K,marks:G=!1,max:Y=100,min:J=0,orientation:X="horizontal",shiftStep:Q=10,size:Z="medium",step:ee=1,scale:et=hm,slotProps:en,slots:ei,track:er="normal",valueLabelDisplay:es="off",valueLabelFormat:eo=hm}=x,ea=(0,q.default)(x,hf),el=(0,W.default)({},x,{isRtl:P,max:Y,min:J,classes:F,disabled:B,disableSwap:U,orientation:X,marks:G,color:M,size:Z,step:ee,shiftStep:Q,scale:et,track:er,valueLabelDisplay:es,valueLabelFormat:eo}),{axisProps:eh,getRootProps:ec,getHiddenInputProps:eu,getThumbProps:ed,open:ep,active:ef,axis:em,focusedThumbIndex:eg,range:e_,dragging:ev,marks:ey,values:eb,trackOffset:ew,trackLeap:eC,getThumbStyle:eI}=function(e){let{"aria-labelledby":t,defaultValue:n,disabled:i=!1,disableSwap:r=!1,isRtl:s=!1,marks:o=!1,max:a=100,min:l=0,name:h,onChange:c,onChangeCommitted:u,orientation:d="horizontal",rootRef:p,scale:f=hh,step:m=1,shiftStep:g=10,tabIndex:_,value:v}=e,y=S.useRef(void 0),[b,w]=S.useState(-1),[C,I]=S.useState(-1),[T,E]=S.useState(!1),k=S.useRef(0),[x,P]=(0,l5.unstable_useControlled)({controlled:v,default:null!=n?n:l,name:"Slider"}),R=c&&((e,t,n)=>{let i=e.nativeEvent||e,r=new i.constructor(i.type,i);Object.defineProperty(r,"target",{writable:!0,value:{value:t,name:h}}),c(r,t,n)}),N=Array.isArray(x),A=N?x.slice().sort(hn):[x];A=A.map(e=>null==e?l:(0,he.default)(e,l,a));let O=!0===o&&null!==m?[...Array(Math.floor((a-l)/m)+1)].map((e,t)=>({value:l+m*t})):o||[],D=O.map(e=>e.value),{isFocusVisibleRef:L,onBlur:M,onFocus:F,ref:j}=(0,l7.default)(),[U,B]=S.useState(-1),q=S.useRef(null),z=(0,l8.unstable_useForkRef)(j,q),$=(0,l8.unstable_useForkRef)(p,z),H=(e,t)=>{let n=Number(e.currentTarget.getAttribute("data-index")),i=A[n],s=D.indexOf(i),o=t;if(O&&null==m){let e=D[D.length-1];o=o>e?e:o<D[0]?D[0]:o<i?D[s-1]:D[s+1]}if(o=(0,he.default)(o,l,a),N){r&&(o=(0,he.default)(o,A[n-1]||-1/0,A[n+1]||1/0));let e=o;o=hs({values:A,newValue:o,index:n});let t=n;r||(t=o.indexOf(e)),ho({sliderRef:q,activeIndex:t})}P(o),B(n),R&&!ha(o,x)&&R(e,o,n),u&&u(e,o)};(0,l4.unstable_useEnhancedEffect)(()=>{if(i&&q.current.contains(document.activeElement)){var e;null==(e=document.activeElement)||e.blur()}},[i]),i&&-1!==b&&w(-1),i&&-1!==U&&B(-1);let V=S.useRef(void 0),K=d;s&&"horizontal"===d&&(K+="-reverse");let G=({finger:e,move:t=!1})=>{let n,i,{current:s}=q,{width:o,height:h,bottom:c,left:u}=s.getBoundingClientRect();if(n=0===K.indexOf("vertical")?(c-e.y)/h:(e.x-u)/o,-1!==K.indexOf("-reverse")&&(n=1-n),i=(a-l)*n+l,m)i=Number((Math.round((i-l)/m)*m+l).toFixed(function(e){if(1>Math.abs(e)){let t=e.toExponential().split("e-"),n=t[0].split(".")[1];return(n?n.length:0)+parseInt(t[1],10)}let t=e.toString().split(".")[1];return t?t.length:0}(m)));else{let e=hi(D,i);i=D[e]}i=(0,he.default)(i,l,a);let d=0;if(N){d=t?V.current:hi(A,i),r&&(i=(0,he.default)(i,A[d-1]||-1/0,A[d+1]||1/0));let e=i;i=hs({values:A,newValue:i,index:d}),r&&t||(V.current=d=i.indexOf(e))}return{newValue:i,activeIndex:d}},Y=(0,l6.unstable_useEventCallback)(e=>{let t=hr(e,y);if(!t)return;if(k.current+=1,"mousemove"===e.type&&0===e.buttons)return void J(e);let{newValue:n,activeIndex:i}=G({finger:t,move:!0});ho({sliderRef:q,activeIndex:i,setActive:w}),P(n),!T&&k.current>2&&E(!0),R&&!ha(n,x)&&R(e,n,i)}),J=(0,l6.unstable_useEventCallback)(e=>{let t=hr(e,y);if(E(!1),!t)return;let{newValue:n}=G({finger:t,move:!0});w(-1),"touchend"===e.type&&I(-1),u&&u(e,n),y.current=void 0,Q()}),X=(0,l6.unstable_useEventCallback)(e=>{if(i)return;hc()||e.preventDefault();let t=e.changedTouches[0];null!=t&&(y.current=t.identifier);let n=hr(e,y);if(!1!==n){let{newValue:t,activeIndex:i}=G({finger:n});ho({sliderRef:q,activeIndex:i,setActive:w}),P(t),R&&!ha(t,x)&&R(e,t,i)}k.current=0;let r=(0,l3.unstable_ownerDocument)(q.current);r.addEventListener("touchmove",Y,{passive:!0}),r.addEventListener("touchend",J,{passive:!0})}),Q=S.useCallback(()=>{let e=(0,l3.unstable_ownerDocument)(q.current);e.removeEventListener("mousemove",Y),e.removeEventListener("mouseup",J),e.removeEventListener("touchmove",Y),e.removeEventListener("touchend",J)},[J,Y]);S.useEffect(()=>{let{current:e}=q;return e.addEventListener("touchstart",X,{passive:hc()}),()=>{e.removeEventListener("touchstart",X),Q()}},[Q,X]),S.useEffect(()=>{i&&Q()},[i,Q]);let Z=((N?A[0]:l)-l)*100/(a-l),ee=(A[A.length-1]-l)*100/(a-l)-Z;return{active:b,axis:K,axisProps:hl,dragging:T,focusedThumbIndex:U,getHiddenInputProps:(n={})=>{var r;let o,c,u,p,v=(0,ht.default)(n),y={onChange:(o=v||{},e=>{var t;null==(t=o.onChange)||t.call(o,e),H(e,e.target.valueAsNumber)}),onFocus:(c=v||{},e=>{var t;let n=Number(e.currentTarget.getAttribute("data-index"));F(e),!0===L.current&&B(n),I(n),null==c||null==(t=c.onFocus)||t.call(c,e)}),onBlur:(u=v||{},e=>{var t;M(e),!1===L.current&&B(-1),I(-1),null==u||null==(t=u.onBlur)||t.call(u,e)}),onKeyDown:(p=v||{},e=>{var t;if(null!==m){let t=A[Number(e.currentTarget.getAttribute("data-index"))],n=null;("ArrowLeft"===e.key||"ArrowDown"===e.key)&&e.shiftKey||"PageDown"===e.key?n=Math.max(t-g,l):(("ArrowRight"===e.key||"ArrowUp"===e.key)&&e.shiftKey||"PageUp"===e.key)&&(n=Math.min(t+g,a)),null!==n&&(H(e,n),e.preventDefault())}null==p||null==(t=p.onKeyDown)||t.call(p,e)})},b=(0,W.default)({},v,y);return(0,W.default)({tabIndex:_,"aria-labelledby":t,"aria-orientation":d,"aria-valuemax":f(a),"aria-valuemin":f(l),name:h,type:"range",min:e.min,max:e.max,step:null===e.step&&e.marks?"any":null!=(r=e.step)?r:void 0,disabled:i},n,b,{style:(0,W.default)({},l9,{direction:s?"rtl":"ltr",width:"100%",height:"100%"})})},getRootProps:(e={})=>{let t,n=(0,ht.default)(e),r={onMouseDown:(t=n||{},e=>{var n;if(null==(n=t.onMouseDown)||n.call(t,e),i||e.defaultPrevented||0!==e.button)return;e.preventDefault();let r=hr(e,y);if(!1!==r){let{newValue:t,activeIndex:n}=G({finger:r});ho({sliderRef:q,activeIndex:n,setActive:w}),P(t),R&&!ha(t,x)&&R(e,t,n)}k.current=0;let s=(0,l3.unstable_ownerDocument)(q.current);s.addEventListener("mousemove",Y,{passive:!0}),s.addEventListener("mouseup",J)})},s=(0,W.default)({},n,r);return(0,W.default)({},e,{ref:$},s)},getThumbProps:(e={})=>{let t,n,i=(0,ht.default)(e),r={onMouseOver:(t=i||{},e=>{var n;null==(n=t.onMouseOver)||n.call(t,e),I(Number(e.currentTarget.getAttribute("data-index")))}),onMouseLeave:(n=i||{},e=>{var t;null==(t=n.onMouseLeave)||t.call(n,e),I(-1)})};return(0,W.default)({},e,i,r)},marks:O,open:C,range:N,rootRef:$,trackLeap:ee,trackOffset:Z,values:A,getThumbStyle:e=>({pointerEvents:-1!==b&&b!==e?"none":void 0})}}((0,W.default)({},el,{rootRef:t}));el.marked=ey.length>0&&ey.some(e=>e.label),el.dragging=ev,el.focusedThumbIndex=eg;let eT=(e=>{let{disabled:t,dragging:n,marked:i,orientation:r,track:s,classes:o,color:a,size:l}=e,h={root:["root",t&&"disabled",n&&"dragging",i&&"marked","vertical"===r&&"vertical","inverted"===s&&"trackInverted",!1===s&&"trackFalse",a&&`color${(0,lH.default)(a)}`,l&&`size${(0,lH.default)(l)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",l&&`thumbSize${(0,lH.default)(l)}`,a&&`thumbColor${(0,lH.default)(a)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return(0,$.default)(h,hd,o)})(el),eE=null!=(n=null!=(i=null==ei?void 0:ei.root)?i:D.Root)?n:hg,ek=null!=(r=null!=(s=null==ei?void 0:ei.rail)?s:D.Rail)?r:h_,eS=null!=(o=null!=(a=null==ei?void 0:ei.track)?a:D.Track)?o:hv,ex=null!=(l=null!=(h=null==ei?void 0:ei.thumb)?h:D.Thumb)?l:hy,eP=null!=(c=null!=(u=null==ei?void 0:ei.valueLabel)?u:D.ValueLabel)?c:hb,eR=null!=(d=null!=(p=null==ei?void 0:ei.mark)?p:D.Mark)?d:hw,eN=null!=(f=null!=(m=null==ei?void 0:ei.markLabel)?m:D.MarkLabel)?f:hC,eA=null!=(g=null!=(_=null==ei?void 0:ei.input)?_:D.Input)?g:"input",eO=null!=(v=null==en?void 0:en.root)?v:L.root,eD=null!=(y=null==en?void 0:en.rail)?y:L.rail,eL=null!=(b=null==en?void 0:en.track)?b:L.track,eM=null!=(w=null==en?void 0:en.thumb)?w:L.thumb,eF=null!=(C=null==en?void 0:en.valueLabel)?C:L.valueLabel,ej=null!=(I=null==en?void 0:en.mark)?I:L.mark,eU=null!=(T=null==en?void 0:en.markLabel)?T:L.markLabel,eB=null!=(E=null==en?void 0:en.input)?E:L.input,eW=(0,l1.default)({elementType:eE,getSlotProps:ec,externalSlotProps:eO,externalForwardedProps:ea,additionalProps:(0,W.default)({},(!eE||!(0,l2.default)(eE))&&{as:O}),ownerState:(0,W.default)({},el,null==eO?void 0:eO.ownerState),className:[eT.root,j]}),eq=(0,l1.default)({elementType:ek,externalSlotProps:eD,ownerState:el,className:eT.rail}),ez=(0,l1.default)({elementType:eS,externalSlotProps:eL,additionalProps:{style:(0,W.default)({},eh[em].offset(ew),eh[em].leap(eC))},ownerState:(0,W.default)({},el,null==eL?void 0:eL.ownerState),className:eT.track}),e$=(0,l1.default)({elementType:ex,getSlotProps:ed,externalSlotProps:eM,ownerState:(0,W.default)({},el,null==eM?void 0:eM.ownerState),className:eT.thumb}),eH=(0,l1.default)({elementType:eP,externalSlotProps:eF,ownerState:(0,W.default)({},el,null==eF?void 0:eF.ownerState),className:eT.valueLabel}),eV=(0,l1.default)({elementType:eR,externalSlotProps:ej,ownerState:el,className:eT.mark}),eK=(0,l1.default)({elementType:eN,externalSlotProps:eU,ownerState:el,className:eT.markLabel}),eG=(0,l1.default)({elementType:eA,getSlotProps:eu,externalSlotProps:eB,ownerState:el});return(0,k.jsxs)(eE,(0,W.default)({},eW,{children:[(0,k.jsx)(ek,(0,W.default)({},eq)),(0,k.jsx)(eS,(0,W.default)({},ez)),ey.filter(e=>e.value>=J&&e.value<=Y).map((e,t)=>{let n,i=(e.value-J)*100/(Y-J),r=eh[em].offset(i);return n=!1===er?-1!==eb.indexOf(e.value):"normal"===er&&(e_?e.value>=eb[0]&&e.value<=eb[eb.length-1]:e.value<=eb[0])||"inverted"===er&&(e_?e.value<=eb[0]||e.value>=eb[eb.length-1]:e.value>=eb[0]),(0,k.jsxs)(S.Fragment,{children:[(0,k.jsx)(eR,(0,W.default)({"data-index":t},eV,!(0,l2.default)(eR)&&{markActive:n},{style:(0,W.default)({},r,eV.style),className:(0,z.default)(eV.className,n&&eT.markActive)})),null!=e.label?(0,k.jsx)(eN,(0,W.default)({"aria-hidden":!0,"data-index":t},eK,!(0,l2.default)(eN)&&{markLabelActive:n},{style:(0,W.default)({},r,eK.style),className:(0,z.default)(eT.markLabel,eK.className,n&&eT.markLabelActive),children:e.label})):null]},t)}),eb.map((e,t)=>{let n=(e-J)*100/(Y-J),i=eh[em].offset(n),r="off"===es?hI:eP;return(0,k.jsx)(r,(0,W.default)({},!(0,l2.default)(r)&&{valueLabelFormat:eo,valueLabelDisplay:es,value:"function"==typeof eo?eo(et(e),t):eo,index:t,open:ep===t||ef===t||"on"===es,disabled:B},eH,{children:(0,k.jsx)(ex,(0,W.default)({"data-index":t},e$,{className:(0,z.default)(eT.thumb,e$.className,ef===t&&eT.active,eg===t&&eT.focusVisible),style:(0,W.default)({},i,eI(t),e$.style),children:(0,k.jsx)(eA,(0,W.default)({"data-index":t,"aria-label":H?H(t):R,"aria-valuenow":et(e),"aria-labelledby":A,"aria-valuetext":K?K(et(e),t):N,value:eb[t]},eG))}))}),t)})]}))});var hE=e.i(55047),hk=e.i(35463),hS=e.i(20562),hx=e.i(91508),hP=e.i(94544),hR=e.i(83944),hN=e.i(35499);let hA=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFFFFF"];function hO({currentTool:e,onToolChange:t,currentColor:n,onColorChange:i,strokeWidth:r,onStrokeWidthChange:s}){let{actions:o}=lj();return(0,k.jsxs)(D.Paper,{elevation:3,sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:200,maxWidth:250},children:[(0,k.jsxs)(P.Box,{children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:"Tools"}),(0,k.jsxs)(lZ,{orientation:"vertical",fullWidth:!0,children:[(0,k.jsx)(lW.Tooltip,{title:"Pen",placement:"right",children:(0,k.jsx)(O.Button,{variant:"pen"===e?"contained":"outlined",onClick:()=>t("pen"),startIcon:(0,k.jsx)(hE.default,{}),children:"Pen"})}),(0,k.jsx)(lW.Tooltip,{title:"Rectangle",placement:"right",children:(0,k.jsx)(O.Button,{variant:"rectangle"===e?"contained":"outlined",onClick:()=>t("rectangle"),startIcon:(0,k.jsx)(hk.default,{}),children:"Rectangle"})}),(0,k.jsx)(lW.Tooltip,{title:"Circle",placement:"right",children:(0,k.jsx)(O.Button,{variant:"circle"===e?"contained":"outlined",onClick:()=>t("circle"),startIcon:(0,k.jsx)(hS.default,{}),children:"Circle"})}),(0,k.jsx)(lW.Tooltip,{title:"Line",placement:"right",children:(0,k.jsx)(O.Button,{variant:"line"===e?"contained":"outlined",onClick:()=>t("line"),startIcon:(0,k.jsx)(hx.default,{}),children:"Line"})})]})]}),(0,k.jsx)(lq.Divider,{}),(0,k.jsxs)(P.Box,{children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:"Color"}),(0,k.jsx)(P.Box,{sx:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:.5},children:hA.map(e=>(0,k.jsx)(lW.Tooltip,{title:e,children:(0,k.jsx)(F.IconButton,{onClick:()=>i(e),sx:{width:36,height:36,bgcolor:e,border:n===e?"3px solid #000":"1px solid #ccc","&:hover":{bgcolor:e,opacity:.8}}})},e))})]}),(0,k.jsx)(lq.Divider,{}),(0,k.jsxs)(P.Box,{children:[(0,k.jsxs)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:["Stroke Width: ",r,"px"]}),(0,k.jsx)(hT,{value:r,onChange:(e,t)=>s(t),min:1,max:20,step:1,marks:!0,valueLabelDisplay:"auto"})]}),(0,k.jsx)(lq.Divider,{}),(0,k.jsxs)(P.Box,{children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",gutterBottom:!0,children:"Actions"}),(0,k.jsxs)(lZ,{orientation:"vertical",fullWidth:!0,children:[(0,k.jsx)(lW.Tooltip,{title:"Undo",placement:"right",children:(0,k.jsx)(O.Button,{onClick:o.undo,startIcon:(0,k.jsx)(hR.default,{}),children:"Undo"})}),(0,k.jsx)(lW.Tooltip,{title:"Redo",placement:"right",children:(0,k.jsx)(O.Button,{onClick:o.redo,startIcon:(0,k.jsx)(hN.default,{}),children:"Redo"})}),(0,k.jsx)(lW.Tooltip,{title:"Clear Board",placement:"right",children:(0,k.jsx)(O.Button,{onClick:o.clearBoard,startIcon:(0,k.jsx)(hP.default,{}),color:"error",children:"Clear"})})]})]})]})}var hD=e.i(42281),hL=e.i(50333),hM=e.i(7200),hF=e.i(52059),hj=e.i(62992),hU=e.i(1051),hB=e.i(58395),hW=e.i(21530);function hq(){let{presence:e,isConnected:t}=lj(),n=e=>{let t=(e=>{switch(e){case"active":return"success";case"idle":return"warning";default:return"action"}})(e);return(0,k.jsx)(hW.default,{sx:{fontSize:12},color:t})},i=Array.from(e.values()).filter(e=>"active"===e.status),r=Array.from(e.values()).filter(e=>"idle"===e.status);return Array.from(e.values()).filter(e=>"offline"===e.status),(0,k.jsxs)(D.Paper,{elevation:3,sx:{p:2,display:"flex",flexDirection:"column",gap:2,minWidth:250,maxWidth:300,maxHeight:"100%",overflow:"auto"},children:[(0,k.jsxs)(P.Box,{sx:{display:"flex",alignItems:"center",gap:1},children:[(0,k.jsx)(N.Typography,{variant:"subtitle2",children:"Presence"}),(0,k.jsx)(hU.Chip,{label:t?"Connected":"Disconnected",size:"small",color:t?"success":"error",icon:(0,k.jsx)(hS.default,{})})]}),i.length>0&&(0,k.jsxs)(P.Box,{children:[(0,k.jsxs)(N.Typography,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:["Active (",i.length,")"]}),(0,k.jsx)(hD.List,{dense:!0,children:i.map(e=>(0,k.jsxs)(hL.ListItem,{sx:{px:0},children:[(0,k.jsx)(hM.ListItemAvatar,{children:(0,k.jsx)(hB.Badge,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:n(e.status),children:(0,k.jsx)(hj.Avatar,{src:e.avatar,alt:e.name,sx:{width:32,height:32},children:e.name.charAt(0).toUpperCase()})})}),(0,k.jsx)(hF.ListItemText,{primary:e.name,secondary:e.cursor?`(${Math.round(e.cursor.x)}, ${Math.round(e.cursor.y)})`:"Active",primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"}})]},e.userId))})]}),r.length>0&&(0,k.jsxs)(P.Box,{children:[(0,k.jsxs)(N.Typography,{variant:"caption",color:"text.secondary",gutterBottom:!0,children:["Idle (",r.length,")"]}),(0,k.jsx)(hD.List,{dense:!0,children:r.map(e=>(0,k.jsxs)(hL.ListItem,{sx:{px:0},children:[(0,k.jsx)(hM.ListItemAvatar,{children:(0,k.jsx)(hB.Badge,{overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:n(e.status),children:(0,k.jsx)(hj.Avatar,{src:e.avatar,alt:e.name,sx:{width:32,height:32,opacity:.6},children:e.name.charAt(0).toUpperCase()})})}),(0,k.jsx)(hF.ListItemText,{primary:e.name,secondary:"Idle",primaryTypographyProps:{variant:"body2"},secondaryTypographyProps:{variant:"caption"},sx:{opacity:.6}})]},e.userId))})]}),0===e.size&&(0,k.jsx)(P.Box,{sx:{textAlign:"center",py:4},children:(0,k.jsx)(N.Typography,{variant:"body2",color:"text.secondary",children:"No other users online"})})]})}var hz=e.i(27121),h$=e.i(23353);function hH(){let{notifications:e}=lj(),{addNotification:t}=(0,h$.useNotifications)(),[n,i]=(0,S.useState)(null),r=(0,S.useRef)(new Set);(0,S.useEffect)(()=>{if(e.length>0){let n=e[e.length-1];if(!r.current.has(n.id)){r.current.add(n.id),i(n),t({type:"board",title:(e=>{switch(e){case"join":return"User Joined";case"leave":return"User Left";case"update":return"Board Updated";case"milestone":return"Milestone Reached";default:return"Board Notification"}})(n.type),message:n.message,metadata:{link:"/labs",actor:n.actor?{id:n.actor.userId,name:n.actor.name}:void 0}}).catch(e=>console.error("Failed to add notification:",e));let e=setTimeout(()=>{i(null)},5e3);return()=>clearTimeout(e)}}},[e,t]);let s=()=>{i(null)};return(0,k.jsx)(k.Fragment,{children:(0,k.jsx)(hz.Snackbar,{open:!!n,autoHideDuration:5e3,onClose:s,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:n&&(0,k.jsxs)(U.Alert,{onClose:s,severity:(e=>{switch(e){case"critical":return"error";case"warning":return"warning";default:return"info"}})(n.severity),sx:{width:"100%",maxWidth:400},children:[(0,k.jsx)(Z,{children:(e=>{switch(e){case"join":return"User Joined";case"leave":return"User Left";case"update":return"Board Updated";case"milestone":return"Milestone Reached";default:return"Board Notification"}})(n.type)}),(0,k.jsx)(N.Typography,{variant:"body2",children:n.message}),n.actor&&(0,k.jsxs)(N.Typography,{variant:"caption",color:"text.secondary",children:["by ",n.actor.name]})]})})})}function hV(){let{presence:e}=lj(),t=Array.from(e.values()).filter(e=>"active"===e.status&&e.cursor);return(0,k.jsx)(P.Box,{sx:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",zIndex:1e3},children:t.map(e=>(0,k.jsxs)(P.Box,{sx:{position:"absolute",left:e.cursor?.x||0,top:e.cursor?.y||0,transform:"translate(-50%, -50%)",transition:"all 0.1s ease-out"},children:[(0,k.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",style:{filter:"drop-shadow(0 2px 4px rgba(0,0,0,0.3))"},children:(0,k.jsx)("path",{d:"M5.5 3.21V20.8L9.5 16.8L12.5 24L14.5 23L11.5 15.8L16.5 15.3L5.5 3.21Z",fill:`hsl(${137.5*e.userId.charCodeAt(0)%360}, 70%, 50%)`,stroke:"white",strokeWidth:"1"})}),(0,k.jsx)(P.Box,{sx:{position:"absolute",top:20,left:10,bgcolor:`hsl(${137.5*e.userId.charCodeAt(0)%360}, 70%, 50%)`,color:"white",px:1,py:.5,borderRadius:1,fontSize:"0.75rem",fontWeight:"bold",whiteSpace:"nowrap",boxShadow:1},children:e.name})]},e.userId))})}function hK({onClose:e}){let{boardId:t,isLoading:n,isConnected:i,error:r}=lj(),[s,o]=(0,S.useState)("pen"),[a,l]=(0,S.useState)("#000000"),[h,c]=(0,S.useState)(2),[u,d]=(0,S.useState)({width:1200,height:700});return(0,S.useEffect)(()=>{let e=()=>{d({width:Math.min(window.innerWidth-600,1600),height:Math.min(window.innerHeight-200,900)})};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,k.jsxs)(P.Box,{sx:{height:"100vh",display:"flex",flexDirection:"column",bgcolor:"background.default"},children:[(0,k.jsx)(L.AppBar,{position:"static",elevation:1,children:(0,k.jsxs)(M.Toolbar,{children:[(0,k.jsxs)(N.Typography,{variant:"h6",sx:{flexGrow:1},children:["Collaboration Board ",t&&`- ${t}`]}),!i&&(0,k.jsx)(U.Alert,{severity:"warning",icon:(0,k.jsx)(et.default,{}),sx:{mr:2},action:(0,k.jsx)(O.Button,{size:"small",color:"inherit",onClick:()=>window.location.reload(),children:"Reconnect"}),children:"Using offline mode - changes may not sync"}),e&&(0,k.jsx)(F.IconButton,{edge:"end",color:"inherit",onClick:e,children:(0,k.jsx)(ee.default,{})})]})}),r&&(0,k.jsxs)(U.Alert,{severity:"error",sx:{m:2},action:(0,k.jsx)(F.IconButton,{size:"small",onClick:()=>window.location.reload(),children:(0,k.jsx)(en.default,{})}),children:[(0,k.jsx)(Z,{children:"Connection Error"}),r]}),n&&!t&&(0,k.jsxs)(P.Box,{sx:{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:1},children:[(0,k.jsx)(j.CircularProgress,{}),(0,k.jsx)(N.Typography,{sx:{ml:2},children:"Loading board..."})]}),!n&&(0,k.jsxs)(P.Box,{sx:{display:"flex",flexGrow:1,overflow:"hidden",position:"relative"},children:[(0,k.jsx)(P.Box,{sx:{p:2,bgcolor:"background.paper",borderRight:1,borderColor:"divider"},children:(0,k.jsx)(hO,{currentTool:s,onToolChange:o,currentColor:a,onColorChange:l,strokeWidth:h,onStrokeWidthChange:c})}),(0,k.jsxs)(P.Box,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",position:"relative",overflow:"auto"},children:[(0,k.jsx)(lB,{width:u.width,height:u.height,currentTool:s,currentColor:a,strokeWidth:h}),(0,k.jsx)(hV,{})]}),(0,k.jsx)(P.Box,{sx:{p:2,bgcolor:"background.paper",borderLeft:1,borderColor:"divider"},children:(0,k.jsx)(hq,{})})]}),(0,k.jsx)(hH,{})]})}function hG({boardId:e,userId:t,userName:n,onClose:i}){return(0,k.jsx)(lU,{userId:t,userName:n,children:(0,k.jsx)(hY,{boardId:e,onClose:i})})}function hY({boardId:e,onClose:t}){let{actions:n}=lj();return(0,S.useEffect)(()=>(n.setBoardId(e),n.broadcastNotification({type:"join",message:"joined the board",severity:"info",actor:{userId:"",name:""}}),()=>{n.broadcastNotification({type:"leave",message:"left the board",severity:"info",actor:{userId:"",name:""}}),n.updatePresence("offline")}),[e,n]),(0,k.jsx)(hK,{onClose:t})}var hJ=e.i(15254);function hX(){let e=(0,x.useRouter)(),{boardId:t}=e.query,{user:n}=(0,hJ.useAuth)(),[i,r]=(0,S.useState)(""),[s,o]=(0,S.useState)(!1),a=t||i,l=()=>{i.trim()&&(o(!0),e.push(`/board?boardId=${i}`,void 0,{shallow:!0}))};return(s||t)&&a?(0,k.jsx)(hG,{boardId:a,userId:n?.id||"anonymous",userName:n?.name||"Anonymous User",onClose:()=>{o(!1),r(""),e.push("/board",void 0,{shallow:!0})}}):(0,k.jsx)(R.Container,{maxWidth:"sm",sx:{mt:8},children:(0,k.jsxs)(D.Paper,{sx:{p:4},children:[(0,k.jsx)(N.Typography,{variant:"h4",gutterBottom:!0,children:"Collaboration Board"}),(0,k.jsx)(N.Typography,{variant:"body1",color:"text.secondary",paragraph:!0,children:"Create a new board or join an existing one to collaborate in real-time."}),(0,k.jsxs)(P.Box,{sx:{mt:4,display:"flex",flexDirection:"column",gap:2},children:[(0,k.jsx)(O.Button,{variant:"contained",size:"large",onClick:()=>{let t=`board_${Date.now()}`;r(t),o(!0),e.push(`/board?boardId=${t}`,void 0,{shallow:!0})},fullWidth:!0,children:"Create New Board"}),(0,k.jsx)(N.Typography,{variant:"body2",textAlign:"center",color:"text.secondary",children:"- OR -"}),(0,k.jsx)(A.TextField,{label:"Board ID",variant:"outlined",fullWidth:!0,value:i,onChange:e=>r(e.target.value),placeholder:"Enter board ID to join",onKeyPress:e=>{"Enter"===e.key&&l()}}),(0,k.jsx)(O.Button,{variant:"outlined",size:"large",onClick:l,disabled:!i.trim(),fullWidth:!0,children:"Join Existing Board"})]}),!n&&(0,k.jsx)(P.Box,{sx:{mt:3,p:2,bgcolor:"info.light",borderRadius:1},children:(0,k.jsx)(N.Typography,{variant:"body2",color:"info.contrastText",children:" Tip: Log in to save your boards and see your collaboration history."})})]})})}e.s(["default",()=>hX],1277)},58665,(e,t,n)=>{let i="/board";(window.__NEXT_P=window.__NEXT_P||[]).push([i,()=>e.r(1277)]),t.hot&&t.hot.dispose(function(){window.__NEXT_P.push([i])})}]);